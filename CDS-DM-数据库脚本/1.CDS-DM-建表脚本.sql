/*==============================================================*/
/* DBMS name:      ORACLE Version 11g                           */
/* Created on:     2014/10/16 13:43:03                          */
/*==============================================================*/


create sequence SEQUENCE_JOBPARAM
increment by 1
start with 1
 maxvalue 999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQUENCE_JOB_SCHEDULE
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQUENCE_LOG
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQUENCE_SCHEDULE
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQUENCE_SYSCONFIG
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQUENCE_T_JOB
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_BASE_ID
increment by 1
start with 1
 maxvalue 9999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_BZGF_ID
increment by 1
start with 100
 maxvalue 9999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_BZGF_JYGZ_ID
increment by 1
start with 3
 maxvalue 9999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_BZGF_JYJG_ID
increment by 1
start with 1
 maxvalue 9999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_BZGF_JYPZ_ID
increment by 1
start with 1
 maxvalue 9999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_BZGF_JYXQ_ID
increment by 1
start with 1
 maxvalue 9999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_BZGF_JY_ID
increment by 1
start with 1
 maxvalue 9999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_BZGF_ZDPZ_ID
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_BZGF_ZDPZ_JYJG_ID
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_BZGF_ZDPZ_JYXQ_ID
increment by 1
start with 1
 maxvalue 999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_BZGF_ZDPZ_JY_ID
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_BZGF_ZDPZ_WPP_ID
increment by 1
start with 1
 maxvalue 9999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_CHECK_COL_ID
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_CHECK_ID
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_CHECK_TBL_ID
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_COLID
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_DS_ID
increment by 1
start with 2
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_GGZYGF_ID
increment by 1
start with 150
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_GGZYLB_ID
increment by 1
start with 1500
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_GGZY_ID
increment by 1
start with 10000
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_JCSJY_ID
increment by 1
start with 10000
 maxvalue 9999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_LOG_CZPZ_CG_ID
increment by 1
start with 1
 maxvalue 9999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_LOG_CZPZ_YJ_ID
increment by 1
start with 1
 maxvalue 9999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_LOG_CZRZ_CG_ID
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_LOG_CZRZ_YJ_ID
increment by 1
start with 1
 maxvalue 999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_LOG_USER_VISIT_ID
increment by 1
start with 1
 maxvalue 999999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_PXSLJG_ID
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_PXSL_CWRZ
increment by 1
start with 1
 maxvalue 999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_PXSL_ID
increment by 1
start with 1
 maxvalue 99999999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_QBTJ_NUM
increment by 1
start with 1
 maxvalue 9999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_SJYFL_ID
increment by 1
start with 1000
 maxvalue 9999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_SYSTEM_ID
increment by 1
start with 2
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_TABLESPACE_ID
increment by 1
start with 1
 maxvalue 999999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_TBLID
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_TBLCLASS_ID
minvalue 1
maxvalue 99999999999999999999999
start with 10
increment by 1
cache 20
/

create sequence SEQ_TBLRELATION_ID
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_XYFX_ID
increment by 1
start with 1
 nomaxvalue
 minvalue 1
 cache 20
/

create sequence SEQ_XYFX_PZ_ID
increment by 1
start with 1
 nomaxvalue
 minvalue 1
 cache 20
/

create sequence SEQ_ZDY_PXSLJG_ID
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_ZDY_PXSL_CWRZ
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_ZDY_PXSL_ID
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_ZLPG_ID
increment by 1
start with 1
 maxvalue 99999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_ZLPG_JG_ID
increment by 1
start with 1
 maxvalue 9999999999999999999999
 minvalue 1
 cache 20
/

create sequence SEQ_ZLPG_PXSL_ID
increment by 1
start with 1
 maxvalue 99999999999999999999999999
 minvalue 1
 cache 20
/

/*==============================================================*/
/* Table: TMP_ALL_COLS                                          */
/*==============================================================*/
create table TMP_ALL_COLS 
(
   ID                   INTEGER,
   DS_ID                INTEGER,
   COLUMN_NAME          VARCHAR2(50),
   REMARK               VARCHAR2(500),
   DATA_TYPE            VARCHAR2(50),
   DATA_LENGTH          VARCHAR2(50),
   COLUMN_ID            INTEGER,
   NULLABLE             CHAR(1),
   OWNER                VARCHAR2(50),
   TABLE_NAME           VARCHAR2(100),
   DATA_SCALE           INTEGER
)
/

comment on table TMP_ALL_COLS is
'字段同步临时表'
/

comment on column TMP_ALL_COLS.ID is
'ID'
/

comment on column TMP_ALL_COLS.DS_ID is
'DS_ID'
/

comment on column TMP_ALL_COLS.COLUMN_NAME is
'字段名称'
/

comment on column TMP_ALL_COLS.REMARK is
'字段备注'
/

comment on column TMP_ALL_COLS.DATA_TYPE is
'字段类型'
/

comment on column TMP_ALL_COLS.DATA_LENGTH is
'字段长度'
/

comment on column TMP_ALL_COLS.COLUMN_ID is
'字段序号'
/

comment on column TMP_ALL_COLS.NULLABLE is
'是否可空'
/

comment on column TMP_ALL_COLS.OWNER is
'所属数据库用户'
/

comment on column TMP_ALL_COLS.TABLE_NAME is
'表名称'
/

comment on column TMP_ALL_COLS.DATA_SCALE is
'字段小数位'
/

/*==============================================================*/
/* Index: TMP_ALL_COLS                                          */
/*==============================================================*/
create index TMP_ALL_COLS on TMP_ALL_COLS (
   ID ASC
)
/

/*==============================================================*/
/* Table: TMP_ALL_COLS_JY                                       */
/*==============================================================*/
create table TMP_ALL_COLS_JY 
(
   ID                   INTEGER,
   DS_ID                INTEGER,
   COLUMN_NAME          VARCHAR2(50),
   REMARK               VARCHAR2(500),
   DATA_TYPE            VARCHAR2(50),
   DATA_LENGTH          VARCHAR2(50),
   COLUMN_ID            INTEGER,
   NULLABLE             CHAR(1),
   OWNER                VARCHAR2(50),
   TABLE_NAME           VARCHAR2(100),
   DATA_SCALE           INTEGER
)
/

comment on table TMP_ALL_COLS_JY is
'字段同步临时表_校验'
/

comment on column TMP_ALL_COLS_JY.ID is
'ID'
/

comment on column TMP_ALL_COLS_JY.DS_ID is
'DS_ID'
/

comment on column TMP_ALL_COLS_JY.COLUMN_NAME is
'字段名称'
/

comment on column TMP_ALL_COLS_JY.REMARK is
'字段备注'
/

comment on column TMP_ALL_COLS_JY.DATA_TYPE is
'字段类型'
/

comment on column TMP_ALL_COLS_JY.DATA_LENGTH is
'字段长度'
/

comment on column TMP_ALL_COLS_JY.COLUMN_ID is
'字段序号'
/

comment on column TMP_ALL_COLS_JY.NULLABLE is
'是否可空'
/

comment on column TMP_ALL_COLS_JY.OWNER is
'所属数据库用户'
/

comment on column TMP_ALL_COLS_JY.TABLE_NAME is
'表名称'
/

comment on column TMP_ALL_COLS_JY.DATA_SCALE is
'字段小数位'
/

/*==============================================================*/
/* Index: TMP_ALL_COLS2                                         */
/*==============================================================*/
create index TMP_ALL_COLS2 on TMP_ALL_COLS_JY (
   ID ASC
)
/

/*==============================================================*/
/* Table: TMP_ALL_TBL                                           */
/*==============================================================*/
create table TMP_ALL_TBL 
(
   TBL_ID               INTEGER,
   DS_ID                INTEGER,
   TBL_VERSION          VARCHAR2(20),
   DS_VERSION           VARCHAR2(20),
   TBL_NAME             VARCHAR2(50),
   TBL_DETAIL           VARCHAR2(500),
   CLASS_ID             INTEGER              default 1,
   SCHEMA               VARCHAR2(50),
   MODIFY_USER          VARCHAR2(50)
)
/

comment on table TMP_ALL_TBL is
'表同步临时表'
/

comment on column TMP_ALL_TBL.TBL_ID is
'TBL_ID'
/

comment on column TMP_ALL_TBL.DS_ID is
'DS_ID'
/

comment on column TMP_ALL_TBL.TBL_VERSION is
'表版本号'
/

comment on column TMP_ALL_TBL.DS_VERSION is
'数据源版本号'
/

comment on column TMP_ALL_TBL.TBL_NAME is
'表名称'
/

comment on column TMP_ALL_TBL.TBL_DETAIL is
'表描述'
/

comment on column TMP_ALL_TBL.CLASS_ID is
'表所属类别'
/

comment on column TMP_ALL_TBL.SCHEMA is
'所属数据库用户'
/

comment on column TMP_ALL_TBL.MODIFY_USER is
'修改人'
/

/*==============================================================*/
/* Index: TMP_ALL_TBL                                           */
/*==============================================================*/
create index TMP_ALL_TBL on TMP_ALL_TBL (
   TBL_ID ASC
)
/

/*==============================================================*/
/* Table: TMP_ALL_TBL_JY                                        */
/*==============================================================*/
create table TMP_ALL_TBL_JY 
(
   TBL_ID               INTEGER,
   DS_ID                INTEGER,
   TBL_VERSION          VARCHAR2(20),
   DS_VERSION           VARCHAR2(20),
   TBL_NAME             VARCHAR2(50),
   TBL_DETAIL           VARCHAR2(500),
   CLASS_ID             INTEGER              default 1,
   SCHEMA               VARCHAR2(50),
   MODIFY_USER          VARCHAR2(50)
)
/

comment on table TMP_ALL_TBL_JY is
'表同步临时表_校验'
/

comment on column TMP_ALL_TBL_JY.TBL_ID is
'TBL_ID'
/

comment on column TMP_ALL_TBL_JY.DS_ID is
'DS_ID'
/

comment on column TMP_ALL_TBL_JY.TBL_VERSION is
'表版本号'
/

comment on column TMP_ALL_TBL_JY.DS_VERSION is
'数据源版本号'
/

comment on column TMP_ALL_TBL_JY.TBL_NAME is
'表名称'
/

comment on column TMP_ALL_TBL_JY.TBL_DETAIL is
'表描述'
/

comment on column TMP_ALL_TBL_JY.CLASS_ID is
'表所属类别'
/

comment on column TMP_ALL_TBL_JY.SCHEMA is
'所属数据库用户'
/

comment on column TMP_ALL_TBL_JY.MODIFY_USER is
'修改人'
/

/*==============================================================*/
/* Index: TMP_ALL_TBL2                                          */
/*==============================================================*/
create index TMP_ALL_TBL2 on TMP_ALL_TBL_JY (
   TBL_ID ASC
)
/

/*==============================================================*/
/* Table: TMP_CHECK_TABLE                                       */
/*==============================================================*/
create table TMP_CHECK_TABLE 
(
   CHECK_TBL_ID         INTEGER,
   CHECK_ID             INTEGER,
   TBL_NAME             VARCHAR2(50),
   SCHEMA               VARCHAR2(50),
   RESULT_TYPE          CHAR(1),
   TBL_ID               INTEGER,
   TBLID                INTEGER
)
/

comment on table TMP_CHECK_TABLE is
'校验一致表临时表'
/

comment on column TMP_CHECK_TABLE.CHECK_TBL_ID is
'CHECK_TBL_ID'
/

comment on column TMP_CHECK_TABLE.CHECK_ID is
'校验ID'
/

comment on column TMP_CHECK_TABLE.TBL_NAME is
'数据源表名称'
/

comment on column TMP_CHECK_TABLE.SCHEMA is
'所属数据库用户'
/

comment on column TMP_CHECK_TABLE.RESULT_TYPE is
'校验结果类型'
/

comment on column TMP_CHECK_TABLE.TBL_ID is
'对应基线表ID'
/

comment on column TMP_CHECK_TABLE.TBLID is
'同步对应表ID'
/

/*==============================================================*/
/* Index: TMP_CHECK_TABLE                                       */
/*==============================================================*/
create index TMP_CHECK_TABLE on TMP_CHECK_TABLE (
   CHECK_TBL_ID ASC
)
/

/*==============================================================*/
/* Table: TMP_T_META_COLUMN                                     */
/*==============================================================*/
create table TMP_T_META_COLUMN 
(
   ID                   INTEGER,
   COL_NAME             VARCHAR2(30),
   REMARK               VARCHAR2(500),
   DATA_TYPE            VARCHAR2(50),
   DATA_LENGTH          INTEGER,
   COL_SEQ              INTEGER,
   NULLABLE             CHAR(1),
   TBL_ID               INTEGER,
   DATA_SCALE           INTEGER
)
/

comment on table TMP_T_META_COLUMN is
'校验字段信息临时表'
/

comment on column TMP_T_META_COLUMN.ID is
'ID'
/

comment on column TMP_T_META_COLUMN.COL_NAME is
'字段名称'
/

comment on column TMP_T_META_COLUMN.REMARK is
'字段备注'
/

comment on column TMP_T_META_COLUMN.DATA_TYPE is
'字段类型'
/

comment on column TMP_T_META_COLUMN.DATA_LENGTH is
'字段长度'
/

comment on column TMP_T_META_COLUMN.COL_SEQ is
'字段序号'
/

comment on column TMP_T_META_COLUMN.NULLABLE is
'是否可空'
/

comment on column TMP_T_META_COLUMN.TBL_ID is
'所属表'
/

comment on column TMP_T_META_COLUMN.DATA_SCALE is
'字段小数位'
/

/*==============================================================*/
/* Index: TMP_T_META_COLUMN                                     */
/*==============================================================*/
create index TMP_T_META_COLUMN on TMP_T_META_COLUMN (
   ID ASC
)
/

/*==============================================================*/
/* Table: TMP_T_META_TABLE                                      */
/*==============================================================*/
create table TMP_T_META_TABLE 
(
   TBL_ID               INTEGER,
   TBL_VERSION          VARCHAR2(20),
   DS_ID                INTEGER,
   DS_VERSION           VARCHAR2(20),
   TBL_NAME             VARCHAR2(50),
   TBL_DETAIL           VARCHAR2(500),
   CLASS_ID             INTEGER              default 1,
   SCHEMA               VARCHAR2(50),
   MODIFY_USER          VARCHAR2(50)
)
/

comment on table TMP_T_META_TABLE is
'校验数据表信息临时表'
/

comment on column TMP_T_META_TABLE.TBL_ID is
'TBL_ID'
/

comment on column TMP_T_META_TABLE.TBL_VERSION is
'表版本号'
/

comment on column TMP_T_META_TABLE.DS_ID is
'DS_ID'
/

comment on column TMP_T_META_TABLE.DS_VERSION is
'数据源版本号'
/

comment on column TMP_T_META_TABLE.TBL_NAME is
'表名称'
/

comment on column TMP_T_META_TABLE.TBL_DETAIL is
'表描述'
/

comment on column TMP_T_META_TABLE.CLASS_ID is
'表所属类别'
/

comment on column TMP_T_META_TABLE.SCHEMA is
'所属数据库用户'
/

comment on column TMP_T_META_TABLE.MODIFY_USER is
'修改人'
/

/*==============================================================*/
/* Index: TMP_T_META_TABLE                                      */
/*==============================================================*/
create index TMP_T_META_TABLE on TMP_T_META_TABLE (
   TBL_ID ASC
)
/

/*==============================================================*/
/* Table: TMP_T_META_TBLRELATION                                */
/*==============================================================*/
create table TMP_T_META_TBLRELATION 
(
   RELATION_TYPE        CHAR(1),
   REMARK               VARCHAR2(500),
   CONSTRAINT_NAME      VARCHAR2(200),
   FK_OWNER             VARCHAR2(50),
   FK_TABLE             VARCHAR2(100),
   FK_COLUMN            VARCHAR2(100),
   PK_OWNER             VARCHAR2(50),
   PK_TABLE             VARCHAR2(100),
   PK_COLUMN            VARCHAR2(100)
)
/

comment on table TMP_T_META_TBLRELATION is
'主外键数据临时表'
/

comment on column TMP_T_META_TBLRELATION.RELATION_TYPE is
'关联类型'
/

comment on column TMP_T_META_TBLRELATION.REMARK is
'关联关系备注'
/

comment on column TMP_T_META_TBLRELATION.CONSTRAINT_NAME is
'约束名称'
/

comment on column TMP_T_META_TBLRELATION.FK_OWNER is
'外键拥有者'
/

comment on column TMP_T_META_TBLRELATION.FK_TABLE is
'外键表'
/

comment on column TMP_T_META_TBLRELATION.FK_COLUMN is
'外键列'
/

comment on column TMP_T_META_TBLRELATION.PK_OWNER is
'主键拥有者'
/

comment on column TMP_T_META_TBLRELATION.PK_TABLE is
'主键表'
/

comment on column TMP_T_META_TBLRELATION.PK_COLUMN is
'主键列'
/


/*==============================================================*/
/* Table: T_BZGF                                                */
/*==============================================================*/
create table T_BZGF 
(
   ID                   INTEGER              not null,
   BZGFMC               VARCHAR2(200),
   BZGFDM               VARCHAR2(50),
   SSLB                 CHAR(1),
   BZGFMS               VARCHAR2(500),
   CJR                  VARCHAR2(50),
   CJSJ                 DATE,
   ZHXGR                VARCHAR2(50),
   ZHXGSJ               DATE,
   constraint PK_T_BZGF primary key (ID)
)
/

comment on table T_BZGF is
'标准规范表'
/

comment on column T_BZGF.ID is
'ID'
/

comment on column T_BZGF.BZGFMC is
'标准规范名称'
/

comment on column T_BZGF.BZGFDM is
'标准规范代码'
/

comment on column T_BZGF.SSLB is
'所属类别'
/

comment on column T_BZGF.BZGFMS is
'标准规范描述'
/

comment on column T_BZGF.CJR is
'创建人'
/

comment on column T_BZGF.CJSJ is
'创建时间'
/

comment on column T_BZGF.ZHXGR is
'最后修改人'
/

comment on column T_BZGF.ZHXGSJ is
'最后修改时间'
/

/*==============================================================*/
/* Table: T_BZGF_JY                                             */
/*==============================================================*/
create table T_BZGF_JY 
(
   ID                   INTEGER              not null,
   JYMC                 VARCHAR2(100),
   CJR                  VARCHAR2(20),
   CJSJ                 DATE,
   SFFSDX               CHAR(1),
   ZDPZ_ID              INTEGER              default 0,
   constraint PK_T_BZGF_JY primary key (ID)
)
/

comment on table T_BZGF_JY is
'标准规范校验表'
/

comment on column T_BZGF_JY.ID is
'ID'
/

comment on column T_BZGF_JY.JYMC is
'校验名称'
/

comment on column T_BZGF_JY.CJR is
'创建人'
/

comment on column T_BZGF_JY.CJSJ is
'创建时间'
/

comment on column T_BZGF_JY.SFFSDX is
'是否发送短信'
/

comment on column T_BZGF_JY.ZDPZ_ID is
'自动配置ID'
/

/*==============================================================*/
/* Table: T_BZGF_JYGZ                                           */
/*==============================================================*/
create table T_BZGF_JYGZ 
(
   ID                   INTEGER              not null,
   JYGZ                 CHAR(1),
   QZ                   NUMBER(5,2),
   QJHGL                NUMBER(5,2),
   CDJYGZ               CHAR(1),
   ZDPPGZ               CHAR(1),
   constraint PK_T_BZGF_JYGZ primary key (ID)
)
/

comment on table T_BZGF_JYGZ is
'标准规范校验规则表'
/

comment on column T_BZGF_JYGZ.ID is
'ID'
/

comment on column T_BZGF_JYGZ.JYGZ is
'校验规则'
/

comment on column T_BZGF_JYGZ.QZ is
'权重'
/

comment on column T_BZGF_JYGZ.QJHGL is
'全局合格率'
/

comment on column T_BZGF_JYGZ.CDJYGZ is
'长度校验规则'
/

comment on column T_BZGF_JYGZ.ZDPPGZ is
'自动匹配规则'
/

/*==============================================================*/
/* Table: T_BZGF_JYJG                                           */
/*==============================================================*/
create table T_BZGF_JYJG 
(
   ID                   INTEGER              not null,
   BZGF_JY_ID           INTEGER,
   LXHGL                NUMBER(5,2),
   CDHGL                NUMBER(5,2),
   ZHGL                 NUMBER(5,2),
   JYRQ                 DATE,
   LXQZ                 NUMBER(5,2),
   CDQZ                 NUMBER(5,2),
   HGLFZ                NUMBER(5,2),
   ZDPPGZ               VARCHAR2(50),
   constraint PK_T_BZGF_JYJG primary key (ID)
)
/

comment on table T_BZGF_JYJG is
'标准规范校验结果表'
/

comment on column T_BZGF_JYJG.ID is
'ID'
/

comment on column T_BZGF_JYJG.BZGF_JY_ID is
'标准规范校验ID'
/

comment on column T_BZGF_JYJG.LXHGL is
'类型合格率'
/

comment on column T_BZGF_JYJG.CDHGL is
'长度合格率'
/

comment on column T_BZGF_JYJG.ZHGL is
'总合格率'
/

comment on column T_BZGF_JYJG.JYRQ is
'校验日期'
/

comment on column T_BZGF_JYJG.LXQZ is
'类型校验权重'
/

comment on column T_BZGF_JYJG.CDQZ is
'长度校验权重'
/

comment on column T_BZGF_JYJG.HGLFZ is
'合格率阀值'
/

comment on column T_BZGF_JYJG.ZDPPGZ is
'自动匹配规则'
/

/*==============================================================*/
/* Table: T_BZGF_JYPZ                                           */
/*==============================================================*/
create table T_BZGF_JYPZ 
(
   ID                   INTEGER              not null,
   BZGF_JY_ID           INTEGER,
   BZGF_ID              INTEGER,
   SJYFL_ID             INTEGER,
   JCSJY_ID             INTEGER,
   DS_ID                INTEGER,
   TBL_ID               INTEGER,
   COL_ID               INTEGER,
   ZDPZ_ID              INTEGER              default 0,
   constraint PK_T_BZGF_JYPZ primary key (ID)
)
/

comment on table T_BZGF_JYPZ is
'标准规范校验配置表'
/

comment on column T_BZGF_JYPZ.ID is
'ID'
/

comment on column T_BZGF_JYPZ.BZGF_JY_ID is
'标准规范校验ID'
/

comment on column T_BZGF_JYPZ.BZGF_ID is
'标准规范ID'
/

comment on column T_BZGF_JYPZ.SJYFL_ID is
'规范表'
/

comment on column T_BZGF_JYPZ.JCSJY_ID is
'规范表字段'
/

comment on column T_BZGF_JYPZ.DS_ID is
'目标数据源ID'
/

comment on column T_BZGF_JYPZ.TBL_ID is
'目标表ID'
/

comment on column T_BZGF_JYPZ.COL_ID is
'目标字段ID'
/

comment on column T_BZGF_JYPZ.ZDPZ_ID is
'自动配置ID'
/

/*==============================================================*/
/* Table: T_BZGF_JYXQ                                           */
/*==============================================================*/
create table T_BZGF_JYXQ 
(
   ID                   INTEGER              not null,
   BZGF_JYJG_ID         INTEGER,
   BZGFMC               VARCHAR2(200),
   SJYFLMC              VARCHAR2(200),
   JCSJYMC              VARCHAR2(200),
   MBSJYMC              VARCHAR2(200),
   MBBMC                VARCHAR2(200),
   MBZDMC               VARCHAR2(200),
   LXHGBS               CHAR(1),
   CDHGBS               CHAR(1),
   JCSJYLX              VARCHAR2(500),
   JCSJYCD              VARCHAR2(500),
   MBZDLX               VARCHAR2(500),
   MBZDCD               VARCHAR2(500),
   MBZDBZ               VARCHAR2(500),
   JYSJ                 DATE,
   JCSJYDM              VARCHAR2(50),
   constraint PK_T_BZGF_JYXQ primary key (ID)
)
/

comment on table T_BZGF_JYXQ is
'标准规范校验详情表'
/

comment on column T_BZGF_JYXQ.ID is
'ID'
/

comment on column T_BZGF_JYXQ.BZGF_JYJG_ID is
'标准规范校验结果ID'
/

comment on column T_BZGF_JYXQ.BZGFMC is
'标准规范名称'
/

comment on column T_BZGF_JYXQ.SJYFLMC is
'数据元分类名称'
/

comment on column T_BZGF_JYXQ.JCSJYMC is
'基础数据元名称'
/

comment on column T_BZGF_JYXQ.MBSJYMC is
'目标数据源名称'
/

comment on column T_BZGF_JYXQ.MBBMC is
'目标表名称'
/

comment on column T_BZGF_JYXQ.MBZDMC is
'目标字段名称'
/

comment on column T_BZGF_JYXQ.LXHGBS is
'类型合格标识'
/

comment on column T_BZGF_JYXQ.CDHGBS is
'长度合格标识'
/

comment on column T_BZGF_JYXQ.JCSJYLX is
'数据元类型'
/

comment on column T_BZGF_JYXQ.JCSJYCD is
'数据元长度'
/

comment on column T_BZGF_JYXQ.MBZDLX is
'目标字段类型'
/

comment on column T_BZGF_JYXQ.MBZDCD is
'目标字段长度'
/

comment on column T_BZGF_JYXQ.MBZDBZ is
'目标字段备注'
/

comment on column T_BZGF_JYXQ.JYSJ is
'校验时间'
/

comment on column T_BZGF_JYXQ.JCSJYDM is
'基础数据元代码'
/

/*==============================================================*/
/* Table: T_BZGF_ZDPZ                                           */
/*==============================================================*/
create table T_BZGF_ZDPZ 
(
   ID                   INTEGER              not null,
   DS_ID                INTEGER,
   BZGF_ID              INTEGER,
   PZSJ                 DATE,
   constraint PK_T_BZGF_ZDPZ primary key (ID)
)
/

comment on table T_BZGF_ZDPZ is
'标准规范自动配置表'
/

comment on column T_BZGF_ZDPZ.ID is
'ID'
/

comment on column T_BZGF_ZDPZ.DS_ID is
'数据源ID'
/

comment on column T_BZGF_ZDPZ.BZGF_ID is
'标准规范ID'
/

comment on column T_BZGF_ZDPZ.PZSJ is
'配置时间'
/

/*==============================================================*/
/* Table: T_CODE_JOBTYPE                                        */
/*==============================================================*/
create table T_CODE_JOBTYPE 
(
   TYPE_ID              CHAR(1)              not null,
   TYPE_NAME            VARCHAR2(100),
   分类描述                 VARCHAR2(500),
   备注                   VARCHAR2(500),
   constraint PK_T_CODE_JOBTYPE primary key (TYPE_ID)
)
/

comment on table T_CODE_JOBTYPE is
'JOB类型编码表'
/

comment on column T_CODE_JOBTYPE.TYPE_ID is
'TYPE_ID'
/

comment on column T_CODE_JOBTYPE.TYPE_NAME is
'分类名称'
/

comment on column T_CODE_JOBTYPE.分类描述 is
'分类描述'
/

comment on column T_CODE_JOBTYPE.备注 is
'备注'
/

/*==============================================================*/
/* Table: T_DMLB                                                */
/*==============================================================*/
create table T_DMLB 
(
   ID                   INTEGER              not null,
   DMLBMC               VARCHAR2(100),
   constraint PK_T_DMLB primary key (ID)
)
/

comment on table T_DMLB is
'代码类别'
/

comment on column T_DMLB.ID is
'ID'
/

comment on column T_DMLB.DMLBMC is
'代码类别名称'
/

/*==============================================================*/
/* Table: T_DMLB_GGDM                                           */
/*==============================================================*/
create table T_DMLB_GGDM 
(
   ID                   INTEGER              not null,
   DMLB_ID              INTEGER,
   DMBH                 INTEGER,
   DMMC                 VARCHAR2(200),
   DMBZ                 VARCHAR2(200),
   constraint PK_T_DMLB_GGDM primary key (ID)
)
/

comment on table T_DMLB_GGDM is
'公共代码表'
/

comment on column T_DMLB_GGDM.ID is
'ID'
/

comment on column T_DMLB_GGDM.DMLB_ID is
'代码类别ID'
/

comment on column T_DMLB_GGDM.DMBH is
'代码编号'
/

comment on column T_DMLB_GGDM.DMMC is
'代码名称'
/

comment on column T_DMLB_GGDM.DMBZ is
'代码备注'
/

/*==============================================================*/
/* Table: T_GGZY                                                */
/*==============================================================*/
create table T_GGZY 
(
   ID                   INTEGER              not null,
   ZYLB_ID              INTEGER,
   ZYBH                 VARCHAR2(50),
   ZYMC                 VARCHAR2(200),
   ZYBZ                 VARCHAR2(4000),
   constraint PK_T_GGZY primary key (ID)
)
/

comment on table T_GGZY is
'字典代码'
/

comment on column T_GGZY.ID is
'ID'
/

comment on column T_GGZY.ZYLB_ID is
'公共值域类别ID'
/

comment on column T_GGZY.ZYBH is
'公共值域编号'
/

comment on column T_GGZY.ZYMC is
'公共值域名称'
/

comment on column T_GGZY.ZYBZ is
'公共值域备注'
/

/*==============================================================*/
/* Index: T_GGZY                                                */
/*==============================================================*/
create index T_GGZY on T_GGZY (
   ZYLB_ID ASC,
   ZYBH ASC,
   ZYMC ASC,
   ZYBZ ASC
)
/

/*==============================================================*/
/* Table: T_GGZYGF                                              */
/*==============================================================*/
create table T_GGZYGF 
(
   ID                   INTEGER              not null,
   ZYGFMC               VARCHAR2(200),
   ZYGFDM               VARCHAR2(50),
   ZYGFMS               VARCHAR2(4000),
   CJR                  VARCHAR2(50),
   CJSJ                 DATE,
   ZHXGR                VARCHAR2(50),
   ZHXGSJ               DATE,
   SSLB                 CHAR(1),
   constraint PK_T_GGZYGF primary key (ID)
)
/

comment on table T_GGZYGF is
'字典规范'
/

comment on column T_GGZYGF.ID is
'ID'
/

comment on column T_GGZYGF.ZYGFMC is
'公共值域规范名称'
/

comment on column T_GGZYGF.ZYGFDM is
'公共值域规范代码'
/

comment on column T_GGZYGF.ZYGFMS is
'公共值域规范描述'
/

comment on column T_GGZYGF.CJR is
'创建人'
/

comment on column T_GGZYGF.CJSJ is
'创建时间'
/

comment on column T_GGZYGF.ZHXGR is
'最后修改人'
/

comment on column T_GGZYGF.ZHXGSJ is
'最后修改时间'
/

comment on column T_GGZYGF.SSLB is
'所属类别'
/

/*==============================================================*/
/* Table: T_GGZYLB                                              */
/*==============================================================*/
create table T_GGZYLB 
(
   ID                   INTEGER              not null,
   ZYLBMC               VARCHAR2(200),
   ZYGF_ID              INTEGER,
   ZYLBDM               VARCHAR2(50),
   CJR                  VARCHAR2(50),
   CJSJ                 DATE,
   ZHXGR                VARCHAR2(50),
   ZHXGSJ               DATE,
   constraint PK_T_GGZYLB primary key (ID)
)
/

comment on table T_GGZYLB is
'字典类别'
/

comment on column T_GGZYLB.ID is
'ID'
/

comment on column T_GGZYLB.ZYLBMC is
'公共值域类别名称'
/

comment on column T_GGZYLB.ZYGF_ID is
'公共值域规范ID'
/

comment on column T_GGZYLB.ZYLBDM is
'公共值域类别代码'
/

comment on column T_GGZYLB.CJR is
'创建人'
/

comment on column T_GGZYLB.CJSJ is
'创建时间'
/

comment on column T_GGZYLB.ZHXGR is
'最后修改人'
/

comment on column T_GGZYLB.ZHXGSJ is
'最后修改时间'
/

/*==============================================================*/
/* Table: T_JCSJY                                               */
/*==============================================================*/
create table T_JCSJY 
(
   ID                   INTEGER              not null,
   SJYFL_ID             INTEGER,
   SJYMC                VARCHAR2(200),
   SJYDM                VARCHAR2(50),
   SJYDY                VARCHAR2(1000),
   ZWQP                 VARCHAR2(500),
   YWMC                 VARCHAR2(500),
   SJGS                 CHAR(1),
   CD                   NUMBER(10),
   XSWS                 NUMBER(10),
   SFWK                 CHAR(1),
   SFZJ                 CHAR(1),
   BB                   VARCHAR2(50),
   ZCJG                 VARCHAR2(50),
   ZY                   VARCHAR2(50),
   ZT                   VARCHAR2(50),
   JLDW                 VARCHAR2(50),
   BZ                   VARCHAR2(4000),
   constraint PK_T_JCSJY primary key (ID)
)
/

comment on table T_JCSJY is
'基础数据元表'
/

comment on column T_JCSJY.ID is
'ID'
/

comment on column T_JCSJY.SJYFL_ID is
'数据元分类ID'
/

comment on column T_JCSJY.SJYMC is
'数据元名称'
/

comment on column T_JCSJY.SJYDM is
'数据元代码'
/

comment on column T_JCSJY.SJYDY is
'数据元定义'
/

comment on column T_JCSJY.ZWQP is
'中文全拼'
/

comment on column T_JCSJY.YWMC is
'英文名称'
/

comment on column T_JCSJY.SJGS is
'数据格式'
/

comment on column T_JCSJY.CD is
'长度'
/

comment on column T_JCSJY.XSWS is
'小数位数'
/

comment on column T_JCSJY.SFWK is
'是否为空'
/

comment on column T_JCSJY.SFZJ is
'是否主键'
/

comment on column T_JCSJY.BB is
'版本'
/

comment on column T_JCSJY.ZCJG is
'注册机构'
/

comment on column T_JCSJY.ZY is
'值域'
/

comment on column T_JCSJY.ZT is
'状态'
/

comment on column T_JCSJY.JLDW is
'计量单位'
/

comment on column T_JCSJY.BZ is
'备注'
/

/*==============================================================*/
/* Table: T_JOB_CURRENT                                         */
/*==============================================================*/
create table T_JOB_CURRENT 
(
   JOB_ID               INTEGER,
   JOB_NAME             VARCHAR2(255),
   BUSI_JOB_NAME        VARCHAR2(100),
   JOB_TYPE             CHAR(1)              default '0',
   IS_MANUAL            CHAR(1)              default '1',
   JOB_STAT             CHAR(1)              default '0',
   LOG_ID               INTEGER,
   LAST_STARTTIME       TIMESTAMP,
   LAST_ENDTIME         TIMESTAMP,
   IS_SHOW              CHAR(1)              default '1',
   KETTLEIDENTIFICATION INTEGER,
   RESOURCE_PATH        VARCHAR2(300)
)
/

comment on table T_JOB_CURRENT is
'JOB运行状态监控表'
/

comment on column T_JOB_CURRENT.JOB_ID is
'JOB编号'
/

comment on column T_JOB_CURRENT.JOB_NAME is
'JOB名称'
/

comment on column T_JOB_CURRENT.BUSI_JOB_NAME is
'JOB业务名称'
/

comment on column T_JOB_CURRENT.JOB_TYPE is
'所属分类'
/

comment on column T_JOB_CURRENT.IS_MANUAL is
'能否手动执行'
/

comment on column T_JOB_CURRENT.JOB_STAT is
'当前状态'
/

comment on column T_JOB_CURRENT.LOG_ID is
'上一次执行日志ID'
/

comment on column T_JOB_CURRENT.LAST_STARTTIME is
'执行开始时间'
/

comment on column T_JOB_CURRENT.LAST_ENDTIME is
'执行结束时间'
/

comment on column T_JOB_CURRENT.IS_SHOW is
'是否显示'
/

comment on column T_JOB_CURRENT.KETTLEIDENTIFICATION is
'KETTLEIDENTIFICATION'
/

comment on column T_JOB_CURRENT.RESOURCE_PATH is
'RESOURCE_PATH'
/

/*==============================================================*/
/* Table: T_JOB_DEFINE                                          */
/*==============================================================*/
create table T_JOB_DEFINE 
(
   JOB_ID               INTEGER              not null,
   JOB_NAME             VARCHAR2(255),
   BUSI_JOB_NAME        VARCHAR2(200),
   RESOURCE_PATH        VARCHAR2(200),
   JOB_TYPE             CHAR(1)              default '0',
   IS_MANUAL            CHAR(1)              default '1',
   IS_MAIN              CHAR(1)              default '1',
   IS_SHOW              CHAR(1)              default '1',
   JOB_STAT             CHAR(1)              default '0',
   REMARK               VARCHAR2(500),
   JOB_VERSION          VARCHAR2(200),
   CREATE_DATE          DATE,
   OPERID               INTEGER,
   UPTIME               DATE,
   KETTLEIDENTIFICATION INTEGER,
   constraint PK_T_JOB_DEFINE primary key (JOB_ID)
)
/

comment on table T_JOB_DEFINE is
'JOB基本信息表'
/

comment on column T_JOB_DEFINE.JOB_ID is
'JOB_ID'
/

comment on column T_JOB_DEFINE.JOB_NAME is
'JOB名称'
/

comment on column T_JOB_DEFINE.BUSI_JOB_NAME is
'JOB业务描述'
/

comment on column T_JOB_DEFINE.RESOURCE_PATH is
'JOB资源库路径'
/

comment on column T_JOB_DEFINE.JOB_TYPE is
'所属分类'
/

comment on column T_JOB_DEFINE.IS_MANUAL is
'能否手动执行'
/

comment on column T_JOB_DEFINE.IS_MAIN is
'是否主任务'
/

comment on column T_JOB_DEFINE.IS_SHOW is
'是否监控显示'
/

comment on column T_JOB_DEFINE.JOB_STAT is
'使用状态'
/

comment on column T_JOB_DEFINE.REMARK is
'备注'
/

comment on column T_JOB_DEFINE.JOB_VERSION is
'JOB的版本号'
/

comment on column T_JOB_DEFINE.CREATE_DATE is
'JOB创建时间'
/

comment on column T_JOB_DEFINE.OPERID is
'最新修改人'
/

comment on column T_JOB_DEFINE.UPTIME is
'最新修改日期'
/

comment on column T_JOB_DEFINE.KETTLEIDENTIFICATION is
'KETTLEIDENTIFICATION'
/

/*==============================================================*/
/* Table: T_JOB_LOG                                             */
/*==============================================================*/
create table T_JOB_LOG 
(
   LOG_ID               INTEGER              not null,
   JOB_ID               INTEGER,
   START_TIME           TIMESTAMP,
   END_TIME             TIMESTAMP,
   EXEC_STAT            CHAR(1),
   EXEC_TYPE            CHAR(1),
   SCHEDULE_ID          INTEGER,
   EXEC_DETAIL          VARCHAR2(500),
   ERROR_TYPE           INTEGER,
   ERROR_PATH           VARCHAR2(500),
   LOG_DAY              VARCHAR2(100),
   LOG_MONTH            INTEGER,
   constraint PK_T_JOB_LOG primary key (LOG_ID)
)
/

comment on table T_JOB_LOG is
'JOB运行历史日志表'
/

comment on column T_JOB_LOG.LOG_ID is
'日志ID'
/

comment on column T_JOB_LOG.JOB_ID is
'JOB_ID'
/

comment on column T_JOB_LOG.START_TIME is
'执行开始时间'
/

comment on column T_JOB_LOG.END_TIME is
'执行结束时间'
/

comment on column T_JOB_LOG.EXEC_STAT is
'执行状态'
/

comment on column T_JOB_LOG.EXEC_TYPE is
'执行类型'
/

comment on column T_JOB_LOG.SCHEDULE_ID is
'所属调度ID'
/

comment on column T_JOB_LOG.EXEC_DETAIL is
'其他执行信息'
/

comment on column T_JOB_LOG.ERROR_TYPE is
'错误类型'
/

comment on column T_JOB_LOG.ERROR_PATH is
'错误日志地址'
/

comment on column T_JOB_LOG.LOG_DAY is
'记录日期'
/

comment on column T_JOB_LOG.LOG_MONTH is
'记录月'
/

/*==============================================================*/
/* Table: T_JOB_PARAM                                           */
/*==============================================================*/
create table T_JOB_PARAM 
(
   PARAM_ID             INTEGER              not null,
   JOB_ID               INTEGER,
   PARAM_NAME           VARCHAR2(50),
   BUSI_PARAM_NAME      VARCHAR2(100),
   REMARK               VARCHAR2(200),
   PARAM_ORDER          INTEGER,
   constraint PK_T_JOB_PARAM primary key (PARAM_ID)
)
/

comment on table T_JOB_PARAM is
'JOB业务参数表'
/

comment on column T_JOB_PARAM.PARAM_ID is
'参数ID'
/

comment on column T_JOB_PARAM.JOB_ID is
'JOB编号'
/

comment on column T_JOB_PARAM.PARAM_NAME is
'参数名'
/

comment on column T_JOB_PARAM.BUSI_PARAM_NAME is
'参数业务名'
/

comment on column T_JOB_PARAM.REMARK is
'备注'
/

comment on column T_JOB_PARAM.PARAM_ORDER is
'参数顺序'
/

/*==============================================================*/
/* Table: T_JOB_PARAM_LOG                                       */
/*==============================================================*/
create table T_JOB_PARAM_LOG 
(
   LOG_ID               INTEGER              not null,
   JOB_ID               INTEGER              not null,
   PARAM_NAME           VARCHAR2(50)         not null,
   PARAM_VALUE          VARCHAR2(100),
   LOG_MONTH            INTEGER,
   constraint PK_T_JOB_PARAM_LOG primary key (LOG_ID, JOB_ID, PARAM_NAME)
)
/

comment on table T_JOB_PARAM_LOG is
'JOB运行历史参数表'
/

comment on column T_JOB_PARAM_LOG.LOG_ID is
'日志ID'
/

comment on column T_JOB_PARAM_LOG.JOB_ID is
'JOB_ID'
/

comment on column T_JOB_PARAM_LOG.PARAM_NAME is
'参数名'
/

comment on column T_JOB_PARAM_LOG.PARAM_VALUE is
'参数值'
/

comment on column T_JOB_PARAM_LOG.LOG_MONTH is
'记录月'
/

/*==============================================================*/
/* Table: T_JOB_SCHEDULE_RELATION                               */
/*==============================================================*/
create table T_JOB_SCHEDULE_RELATION 
(
   RELATION_ID          INTEGER              not null,
   SCHEDULE_ID          INTEGER,
   JOB_ID               INTEGER,
   constraint PK_T_JOB_SCHEDULE_RELATION primary key (RELATION_ID)
)
/

comment on table T_JOB_SCHEDULE_RELATION is
'任务调度关联表'
/

comment on column T_JOB_SCHEDULE_RELATION.RELATION_ID is
'RELATION_ID'
/

comment on column T_JOB_SCHEDULE_RELATION.SCHEDULE_ID is
'SCHEDULE_ID'
/

comment on column T_JOB_SCHEDULE_RELATION.JOB_ID is
'JOB_ID'
/

/*==============================================================*/
/* Table: T_JOB_TASKMESSAGE                                     */
/*==============================================================*/
create table T_JOB_TASKMESSAGE 
(
   SCHEDULE_JOB_ID      INTEGER,
   JOB_ID               INTEGER,
   JOB_NAME             VARCHAR2(200),
   START_TIME           DATE,
   VALIT_TIME_START     DATE,
   VALIT_TIME_END       DATE,
   UNIT                 INTEGER,
   SCHEDULE_ID          INTEGER
)
/

comment on table T_JOB_TASKMESSAGE is
'跨日任务消息表'
/

comment on column T_JOB_TASKMESSAGE.SCHEDULE_JOB_ID is
'SCHEDULE_JOB_ID'
/

comment on column T_JOB_TASKMESSAGE.JOB_ID is
'JOB_ID'
/

comment on column T_JOB_TASKMESSAGE.JOB_NAME is
'JOB_NAME'
/

comment on column T_JOB_TASKMESSAGE.START_TIME is
'START_TIME'
/

comment on column T_JOB_TASKMESSAGE.VALIT_TIME_START is
'VALIT_TIME_START'
/

comment on column T_JOB_TASKMESSAGE.VALIT_TIME_END is
'VALIT_TIME_END'
/

comment on column T_JOB_TASKMESSAGE.UNIT is
'UNIT'
/

comment on column T_JOB_TASKMESSAGE.SCHEDULE_ID is
'SCHEDULE_ID'
/

/*==============================================================*/
/* Table: T_LOG_CZPZ_CG                                         */
/*==============================================================*/
create table T_LOG_CZPZ_CG 
(
   ID                   INTEGER              not null,
   DS_ID                INTEGER,
   YHM                  VARCHAR2(30),
   SQL_SELECT           CHAR(1),
   SQL_INSERT           CHAR(1),
   SQL_UPDATE           CHAR(1),
   SQL_DELETE           CHAR(1),
   IP                   CHAR(1),
   constraint PK_T_LOG_CZPZ_CG primary key (ID)
)
/

comment on table T_LOG_CZPZ_CG is
'常规操作配置'
/

comment on column T_LOG_CZPZ_CG.ID is
'ID'
/

comment on column T_LOG_CZPZ_CG.DS_ID is
'数据源ID'
/

comment on column T_LOG_CZPZ_CG.YHM is
'用户名'
/

comment on column T_LOG_CZPZ_CG.SQL_SELECT is
'SELECT'
/

comment on column T_LOG_CZPZ_CG.SQL_INSERT is
'INSERT'
/

comment on column T_LOG_CZPZ_CG.SQL_UPDATE is
'UPDATE'
/

comment on column T_LOG_CZPZ_CG.SQL_DELETE is
'DELETE'
/

comment on column T_LOG_CZPZ_CG.IP is
'IP'
/

/*==============================================================*/
/* Table: T_LOG_CZPZ_YJ                                         */
/*==============================================================*/
create table T_LOG_CZPZ_YJ 
(
   ID                   INTEGER              not null,
   DS_ID                INTEGER,
   YHM                  VARCHAR2(30),
   SQL_CREATE           CHAR(1),
   SQL_DROP             CHAR(1),
   SQL_ALTER            CHAR(1),
   SQL_TRUNCATE         CHAR(1),
   constraint PK_T_LOG_CZPZ_YJ primary key (ID)
)
/

comment on table T_LOG_CZPZ_YJ is
'预警操作配置'
/

comment on column T_LOG_CZPZ_YJ.ID is
'ID'
/

comment on column T_LOG_CZPZ_YJ.DS_ID is
'数据源ID'
/

comment on column T_LOG_CZPZ_YJ.YHM is
'用户名'
/

comment on column T_LOG_CZPZ_YJ.SQL_CREATE is
'CREATE'
/

comment on column T_LOG_CZPZ_YJ.SQL_DROP is
'DROP'
/

comment on column T_LOG_CZPZ_YJ.SQL_ALTER is
'ALTER'
/

comment on column T_LOG_CZPZ_YJ.SQL_TRUNCATE is
'TRUNCATE'
/

/*==============================================================*/
/* Table: T_LOG_CZRZ_CG                                         */
/*==============================================================*/
create table T_LOG_CZRZ_CG 
(
   ID                   NUMBER(12)           not null,
   SQL                  CLOB,
   CZYH                 VARCHAR2(50),
   FSSJ                 DATE,
   CZDX                 VARCHAR2(50),
   CZLX                 VARCHAR2(50),
   IP                   VARCHAR2(50),
   constraint PK_T_LOG_CZRZ_CG primary key (ID)
)
/

comment on table T_LOG_CZRZ_CG is
'常规操作日志'
/

comment on column T_LOG_CZRZ_CG.ID is
'ID'
/

comment on column T_LOG_CZRZ_CG.SQL is
'操作语句'
/

comment on column T_LOG_CZRZ_CG.CZYH is
'操作用户'
/

comment on column T_LOG_CZRZ_CG.FSSJ is
'发生时间'
/

comment on column T_LOG_CZRZ_CG.CZDX is
'操作对象'
/

comment on column T_LOG_CZRZ_CG.CZLX is
'操作类型'
/

comment on column T_LOG_CZRZ_CG.IP is
'IP'
/

/*==============================================================*/
/* Table: T_LOG_CZRZ_YJ                                         */
/*==============================================================*/
create table T_LOG_CZRZ_YJ 
(
   ID                   NUMBER(12)           not null,
   SQL                  CLOB,
   CZYH                 VARCHAR2(50),
   FSSJ                 DATE,
   CZDX                 VARCHAR2(50),
   CZLX                 VARCHAR2(50),
   IP                   VARCHAR2(50),
   constraint PK_T_LOG_CZRZ_YJ primary key (ID)
)
/

comment on table T_LOG_CZRZ_YJ is
'预警操作日志'
/

comment on column T_LOG_CZRZ_YJ.ID is
'ID'
/

comment on column T_LOG_CZRZ_YJ.SQL is
'操作语句'
/

comment on column T_LOG_CZRZ_YJ.CZYH is
'操作用户'
/

comment on column T_LOG_CZRZ_YJ.FSSJ is
'发生时间'
/

comment on column T_LOG_CZRZ_YJ.CZDX is
'操作对象'
/

comment on column T_LOG_CZRZ_YJ.CZLX is
'操作类型'
/

comment on column T_LOG_CZRZ_YJ.IP is
'IP'
/

/*==============================================================*/
/* Table: T_LOG_USER_VISIT                                      */
/*==============================================================*/
create table T_LOG_USER_VISIT 
(
   ID                   NUMBER(12)           not null,
   YHM                  VARCHAR2(50),
   IP                   VARCHAR2(50),
   DLLX                 CHAR(1),
   FSSJ                 DATE,
   constraint PK_T_LOG_USER_VISIT primary key (ID)
)
/

comment on table T_LOG_USER_VISIT is
'用户登陆日志'
/

comment on column T_LOG_USER_VISIT.ID is
'ID'
/

comment on column T_LOG_USER_VISIT.YHM is
'用户名称'
/

comment on column T_LOG_USER_VISIT.IP is
'IP'
/

comment on column T_LOG_USER_VISIT.DLLX is
'登陆类型'
/

comment on column T_LOG_USER_VISIT.FSSJ is
'发生时间'
/

/*==============================================================*/
/* Table: T_META_CHECK_COLUMN                                   */
/*==============================================================*/
create table T_META_CHECK_COLUMN 
(
   ID                   INTEGER              not null,
   COL_NAME             VARCHAR2(30)         not null,
   REMARK               VARCHAR2(500),
   DATA_TYPE            VARCHAR2(50),
   DATA_LENGTH          INTEGER,
   COL_SEQ              INTEGER,
   NULLABLE             CHAR(1),
   CHECK_TBL_ID         INTEGER,
   DATA_SCALE           INTEGER,
   constraint PK_T_META_CHECK_COLUMN primary key (ID)
)
/

comment on table T_META_CHECK_COLUMN is
'校验目标数据源字段信息'
/

comment on column T_META_CHECK_COLUMN.ID is
'ID'
/

comment on column T_META_CHECK_COLUMN.COL_NAME is
'字段名称'
/

comment on column T_META_CHECK_COLUMN.REMARK is
'字段备注'
/

comment on column T_META_CHECK_COLUMN.DATA_TYPE is
'字段类型'
/

comment on column T_META_CHECK_COLUMN.DATA_LENGTH is
'字段长度'
/

comment on column T_META_CHECK_COLUMN.COL_SEQ is
'字段序号'
/

comment on column T_META_CHECK_COLUMN.NULLABLE is
'是否可空'
/

comment on column T_META_CHECK_COLUMN.CHECK_TBL_ID is
'所属校验表ID'
/

comment on column T_META_CHECK_COLUMN.DATA_SCALE is
'字段小数位'
/

/*==============================================================*/
/* Table: T_META_CHECK_TABLE                                    */
/*==============================================================*/
create table T_META_CHECK_TABLE 
(
   CHECK_TBL_ID         INTEGER              not null,
   CHECK_ID             INTEGER,
   TBL_NAME             VARCHAR2(50),
   SCHEMA               VARCHAR2(50)         not null,
   RESULT_TYPE          CHAR(1)              not null,
   TBL_ID               INTEGER,
   constraint PK_T_META_CHECK_TABLE primary key (CHECK_TBL_ID)
)
/

comment on table T_META_CHECK_TABLE is
'校验不一致表信息'
/

comment on column T_META_CHECK_TABLE.CHECK_TBL_ID is
'CHECK_TBL_ID'
/

comment on column T_META_CHECK_TABLE.CHECK_ID is
'校验ID'
/

comment on column T_META_CHECK_TABLE.TBL_NAME is
'数据源表名称'
/

comment on column T_META_CHECK_TABLE.SCHEMA is
'所属数据库用户'
/

comment on column T_META_CHECK_TABLE.RESULT_TYPE is
'校验结果类型'
/

comment on column T_META_CHECK_TABLE.TBL_ID is
'对应基线表ID'
/

/*==============================================================*/
/* Table: T_META_COLUMN                                         */
/*==============================================================*/
create table T_META_COLUMN 
(
   ID                   INTEGER              not null,
   COL_NAME             VARCHAR2(30)         not null,
   REMARK               VARCHAR2(500),
   DATA_TYPE            VARCHAR2(50),
   DATA_LENGTH          INTEGER,
   COL_SEQ              INTEGER,
   NULLABLE             CHAR(1),
   TBL_ID               INTEGER              not null,
   DATA_SCALE           INTEGER,
   constraint PK_T_META_COLUMN primary key (ID)
)
/

comment on table T_META_COLUMN is
'字段信息'
/

comment on column T_META_COLUMN.ID is
'ID'
/

comment on column T_META_COLUMN.COL_NAME is
'字段名称'
/

comment on column T_META_COLUMN.REMARK is
'字段备注'
/

comment on column T_META_COLUMN.DATA_TYPE is
'字段类型'
/

comment on column T_META_COLUMN.DATA_LENGTH is
'字段长度'
/

comment on column T_META_COLUMN.COL_SEQ is
'字段序号'
/

comment on column T_META_COLUMN.NULLABLE is
'是否可空'
/

comment on column T_META_COLUMN.TBL_ID is
'所属表'
/

comment on column T_META_COLUMN.DATA_SCALE is
'字段小数位'
/

/*==============================================================*/
/* Table: T_META_COLUMN_ZS                                      */
/*==============================================================*/
create table T_META_COLUMN_ZS 
(
   ID                   INTEGER              not null,
   COL_NAME             VARCHAR2(30),
   REMARK               VARCHAR2(500),
   DATA_TYPE            VARCHAR2(50),
   DATA_LENGTH          INTEGER,
   COL_SEQ              INTEGER,
   NULLABLE             CHAR(1),
   TBL_ID               INTEGER,
   DATA_SCALE           INTEGER,
   constraint PK_T_META_COLUMN_ZS primary key (ID)
)
/

comment on table T_META_COLUMN_ZS is
'字段信息展示'
/

comment on column T_META_COLUMN_ZS.ID is
'ID'
/

comment on column T_META_COLUMN_ZS.COL_NAME is
'字段名称'
/

comment on column T_META_COLUMN_ZS.REMARK is
'字段备注'
/

comment on column T_META_COLUMN_ZS.DATA_TYPE is
'字段类型'
/

comment on column T_META_COLUMN_ZS.DATA_LENGTH is
'字段长度'
/

comment on column T_META_COLUMN_ZS.COL_SEQ is
'字段序号'
/

comment on column T_META_COLUMN_ZS.NULLABLE is
'是否可空'
/

comment on column T_META_COLUMN_ZS.TBL_ID is
'所属表'
/

comment on column T_META_COLUMN_ZS.DATA_SCALE is
'字段小数位'
/

/*==============================================================*/
/* Table: T_META_DATASOURCE                                     */
/*==============================================================*/
create table T_META_DATASOURCE 
(
   DS_ID                INTEGER              not null,
   DS_NAME              VARCHAR2(50)         not null,
   DS_DETAIL            VARCHAR2(200),
   DS_BELONG            CHAR(1),
   DS_TYPE              INTEGER,
   SYSTEM_ID            INTEGER,
   CONNECT_TYPE         CHAR(1),
   CONNECT_IP           VARCHAR2(20),
   SID_NAME             VARCHAR2(50),
   CONNECT_PORT         VARCHAR2(10),
   CONNECT_USER         VARCHAR2(30),
   CONNECT_PWD          VARCHAR2(30),
   ODBC_NAME            VARCHAR2(50),
   JNDI_NAME            VARCHAR2(50),
   STAT                 CHAR(1),
   VERSION              VARCHAR2(20)         not null,
   MODIFY_USER          VARCHAR2(50),
   MAINTAIN_TYPE        CHAR(1)              default '1',
   USER_TYPE            CHAR(1),
   RAC_SID_NAME         VARCHAR2(50),
   constraint PK_T_META_DATASOURCE primary key (DS_ID, VERSION)
)
/

comment on table T_META_DATASOURCE is
'数据源信息'
/

comment on column T_META_DATASOURCE.DS_ID is
'DS_ID'
/

comment on column T_META_DATASOURCE.DS_NAME is
'数据源名称'
/

comment on column T_META_DATASOURCE.DS_DETAIL is
'数据源描述'
/

comment on column T_META_DATASOURCE.DS_BELONG is
'数据源归属'
/

comment on column T_META_DATASOURCE.DS_TYPE is
'数据源类型'
/

comment on column T_META_DATASOURCE.SYSTEM_ID is
'所属系统'
/

comment on column T_META_DATASOURCE.CONNECT_TYPE is
'访问方式'
/

comment on column T_META_DATASOURCE.CONNECT_IP is
'访问IP'
/

comment on column T_META_DATASOURCE.SID_NAME is
'数据库实例名称'
/

comment on column T_META_DATASOURCE.CONNECT_PORT is
'连接端口号'
/

comment on column T_META_DATASOURCE.CONNECT_USER is
'连接用户名'
/

comment on column T_META_DATASOURCE.CONNECT_PWD is
'连接密码'
/

comment on column T_META_DATASOURCE.ODBC_NAME is
'ODBC源名称'
/

comment on column T_META_DATASOURCE.JNDI_NAME is
'JNDI名称'
/

comment on column T_META_DATASOURCE.STAT is
'状态'
/

comment on column T_META_DATASOURCE.VERSION is
'版本号'
/

comment on column T_META_DATASOURCE.MODIFY_USER is
'修改人'
/

comment on column T_META_DATASOURCE.MAINTAIN_TYPE is
'数据维护类型'
/

comment on column T_META_DATASOURCE.USER_TYPE is
'用户类型'
/

comment on column T_META_DATASOURCE.RAC_SID_NAME is
'RAC实例名'
/

/*==============================================================*/
/* Table: T_META_DSTBL_BASELINE                                 */
/*==============================================================*/
create table T_META_DSTBL_BASELINE 
(
   BASE_ID              INTEGER              not null,
   BASE_DETAIL          VARCHAR2(200),
   BASE_STAT            CHAR(1)              default '0',
   BASE_VERSION         VARCHAR2(20),
   REMARK               VARCHAR2(500),
   APPLY_USER           VARCHAR2(50),
   APPLY_DATE           DATE,
   constraint PK_T_META_DSTBL_BASELINE primary key (BASE_ID)
)
/

comment on table T_META_DSTBL_BASELINE is
'数据源库表结构基线信息'
/

comment on column T_META_DSTBL_BASELINE.BASE_ID is
'基线ID'
/

comment on column T_META_DSTBL_BASELINE.BASE_DETAIL is
'基线描述'
/

comment on column T_META_DSTBL_BASELINE.BASE_STAT is
'基线状态'
/

comment on column T_META_DSTBL_BASELINE.BASE_VERSION is
'基线版本号'
/

comment on column T_META_DSTBL_BASELINE.REMARK is
'备注'
/

comment on column T_META_DSTBL_BASELINE.APPLY_USER is
'申请人'
/

comment on column T_META_DSTBL_BASELINE.APPLY_DATE is
'申请日期'
/

/*==============================================================*/
/* Table: T_META_DSTBL_CHECK                                    */
/*==============================================================*/
create table T_META_DSTBL_CHECK 
(
   CHECK_ID             INTEGER              not null,
   DS_ID                INTEGER,
   DS_VERSION           VARCHAR2(20),
   CHECK_DETAIL         VARCHAR2(200),
   CHECK_DATE           DATE,
   CHECK_USER           VARCHAR2(50),
   RESULT_STAT          CHAR(1),
   constraint PK_T_META_DSTBL_CHECK primary key (CHECK_ID)
)
/

comment on table T_META_DSTBL_CHECK is
'数据源库表校验信息'
/

comment on column T_META_DSTBL_CHECK.CHECK_ID is
'校验ID'
/

comment on column T_META_DSTBL_CHECK.DS_ID is
'DS_ID'
/

comment on column T_META_DSTBL_CHECK.DS_VERSION is
'版本号'
/

comment on column T_META_DSTBL_CHECK.CHECK_DETAIL is
'校验描述'
/

comment on column T_META_DSTBL_CHECK.CHECK_DATE is
'校验时间'
/

comment on column T_META_DSTBL_CHECK.CHECK_USER is
'校验人'
/

comment on column T_META_DSTBL_CHECK.RESULT_STAT is
'校验结果状态'
/

/*==============================================================*/
/* Table: T_META_JOB_RELATION                                   */
/*==============================================================*/
create table T_META_JOB_RELATION 
(
   ID                   INTEGER,
   MTBL_ID              INTEGER,
   JOB_ID               INTEGER,
   REMARK               VARCHAR2(200)
)
/

comment on table T_META_JOB_RELATION is
'元数据与自动获取任务关联表'
/

comment on column T_META_JOB_RELATION.ID is
'ID'
/

comment on column T_META_JOB_RELATION.MTBL_ID is
'元数据表编号'
/

comment on column T_META_JOB_RELATION.JOB_ID is
'任务编号'
/

comment on column T_META_JOB_RELATION.REMARK is
'备注'
/

/*==============================================================*/
/* Table: T_META_PXSL                                           */
/*==============================================================*/
create table T_META_PXSL 
(
   ID                   INTEGER              not null,
   DS_ID                INTEGER,
   TBL_NAME             VARCHAR2(100),
   COL_NAME             VARCHAR2(100),
   KPI_ID               INTEGER,
   PXSLMC               VARCHAR2(200),
   ZYLB_ID              INTEGER,
   PXCS_MIN             VARCHAR2(500),
   PXCS_MAX             VARCHAR2(500),
   constraint PK_T_META_PXSL primary key (ID)
)
/

comment on table T_META_PXSL is
'剖析实例表'
/

comment on column T_META_PXSL.ID is
'ID'
/

comment on column T_META_PXSL.DS_ID is
'数据源ID'
/

comment on column T_META_PXSL.TBL_NAME is
'表名称'
/

comment on column T_META_PXSL.COL_NAME is
'字段名'
/

comment on column T_META_PXSL.KPI_ID is
'剖析类型'
/

comment on column T_META_PXSL.PXSLMC is
'剖析实例名称'
/

comment on column T_META_PXSL.ZYLB_ID is
'值域类别ID'
/

comment on column T_META_PXSL.PXCS_MIN is
'剖析参数1'
/

comment on column T_META_PXSL.PXCS_MAX is
'剖析参数2'
/

/*==============================================================*/
/* Table: T_META_PXSL_CWRZ                                      */
/*==============================================================*/
create table T_META_PXSL_CWRZ 
(
   ID                   VARCHAR2(50)         not null,
   GXSJ                 DATE,
   PXSL_ID              INTEGER,
   KPI_ID               INTEGER,
   ERROR_MSG            VARCHAR2(500),
   ERROR_NUM            NUMBER(12),
   ERROR_LINE           VARCHAR2(500),
   constraint PK_T_META_PXSL_CWRZ primary key (ID)
)
/

comment on table T_META_PXSL_CWRZ is
'剖析实例错误日志'
/

comment on column T_META_PXSL_CWRZ.ID is
'ID'
/

comment on column T_META_PXSL_CWRZ.GXSJ is
'更新时间'
/

comment on column T_META_PXSL_CWRZ.PXSL_ID is
'剖析实例ID'
/

comment on column T_META_PXSL_CWRZ.KPI_ID is
'剖析类型'
/

comment on column T_META_PXSL_CWRZ.ERROR_MSG is
'错误详细信息'
/

comment on column T_META_PXSL_CWRZ.ERROR_NUM is
'错误编号'
/

comment on column T_META_PXSL_CWRZ.ERROR_LINE is
'错误行号'
/

/*==============================================================*/
/* Table: T_META_PXSL_ZXJG                                      */
/*==============================================================*/
create table T_META_PXSL_ZXJG 
(
   ID                   INTEGER              not null,
   PXSL_ID              INTEGER,
   PXZL                 NUMBER,
   PXWTGL               NUMBER,
   PXDBL                NUMBER(5,2),
   PXSJ                 DATE,
   constraint PK_T_META_PXSL_ZXJG primary key (ID)
)
/

comment on table T_META_PXSL_ZXJG is
'剖析实例执行结果表'
/

comment on column T_META_PXSL_ZXJG.ID is
'ID'
/

comment on column T_META_PXSL_ZXJG.PXSL_ID is
'剖析实例ID'
/

comment on column T_META_PXSL_ZXJG.PXZL is
'剖析总量'
/

comment on column T_META_PXSL_ZXJG.PXWTGL is
'剖析未通过量'
/

comment on column T_META_PXSL_ZXJG.PXDBL is
'剖析达标率'
/

comment on column T_META_PXSL_ZXJG.PXSJ is
'剖析时间'
/

/*==============================================================*/
/* Table: T_META_QBTJ_NUM                                       */
/*==============================================================*/
create table T_META_QBTJ_NUM 
(
   ID                   INTEGER              not null,
   DS_ID                INTEGER,
   TBL_NAME             VARCHAR2(100),
   JLS                  VARCHAR2(100),
   JLSJ                 DATE,
   constraint PK_T_META_QBTJ_NUM primary key (ID)
)
/

comment on table T_META_QBTJ_NUM is
'表记录数统计'
/

comment on column T_META_QBTJ_NUM.ID is
'ID'
/

comment on column T_META_QBTJ_NUM.DS_ID is
'数据源ID'
/

comment on column T_META_QBTJ_NUM.TBL_NAME is
'表名称'
/

comment on column T_META_QBTJ_NUM.JLS is
'记录数'
/

comment on column T_META_QBTJ_NUM.JLSJ is
'记录时间'
/

/*==============================================================*/
/* Table: T_META_SOURCETYPE                                     */
/*==============================================================*/
create table T_META_SOURCETYPE 
(
   CODE                 INTEGER              not null,
   TYPE_NAME            VARCHAR2(100),
   REMARK               VARCHAR2(200),
   constraint PK_T_META_SOURCETYPE primary key (CODE)
)
/

comment on table T_META_SOURCETYPE is
'数据源类型'
/

comment on column T_META_SOURCETYPE.CODE is
'CODE'
/

comment on column T_META_SOURCETYPE.TYPE_NAME is
'类型名称'
/

comment on column T_META_SOURCETYPE.REMARK is
'备注'
/

/*==============================================================*/
/* Table: T_META_SYSTEM                                         */
/*==============================================================*/
create table T_META_SYSTEM 
(
   SYSTEM_ID            INTEGER              not null,
   SYSTEM_NAME          VARCHAR2(50),
   SYSTEM_DETAIL        VARCHAR2(200),
   SYSTEM_STAT          CHAR(1),
   constraint PK_T_META_SYSTEM primary key (SYSTEM_ID)
)
/

comment on table T_META_SYSTEM is
'信息系统表'
/

comment on column T_META_SYSTEM.SYSTEM_ID is
'SYSTEM_ID'
/

comment on column T_META_SYSTEM.SYSTEM_NAME is
'系统名称'
/

comment on column T_META_SYSTEM.SYSTEM_DETAIL is
'系统描述'
/

comment on column T_META_SYSTEM.SYSTEM_STAT is
'系统状态'
/

/*==============================================================*/
/* Table: T_META_TABLE                                          */
/*==============================================================*/
create table T_META_TABLE 
(
   TBL_ID               INTEGER              not null,
   TBL_VERSION          VARCHAR2(20)         not null,
   DS_ID                INTEGER,
   DS_VERSION           VARCHAR2(20),
   TBL_NAME             VARCHAR2(50)         not null,
   TBL_DETAIL           VARCHAR2(500),
   CLASS_ID             INTEGER              default 1,
   SCHEMA               VARCHAR2(50)         not null,
   MODIFY_USER          VARCHAR2(50),
   constraint PK_T_META_TABLE primary key (TBL_ID)
)
/

comment on table T_META_TABLE is
'数据表信息'
/

comment on column T_META_TABLE.TBL_ID is
'TBL_ID'
/

comment on column T_META_TABLE.TBL_VERSION is
'表版本号'
/

comment on column T_META_TABLE.DS_ID is
'DS_ID'
/

comment on column T_META_TABLE.DS_VERSION is
'数据源版本号'
/

comment on column T_META_TABLE.TBL_NAME is
'表名称'
/

comment on column T_META_TABLE.TBL_DETAIL is
'表描述'
/

comment on column T_META_TABLE.CLASS_ID is
'表所属类别'
/

comment on column T_META_TABLE.SCHEMA is
'所属数据库用户'
/

comment on column T_META_TABLE.MODIFY_USER is
'修改人'
/

/*==============================================================*/
/* Table: T_META_TABLESPACE                                     */
/*==============================================================*/
create table T_META_TABLESPACE 
(
   ID                   INTEGER              not null,
   DS_ID                INTEGER,
   BKJMC                VARCHAR2(100),
   BKJDX                NUMBER,
   BKJCSZ               NUMBER,
   BKJYSY               NUMBER,
   BKJSYL               NUMBER(5,2),
   CXSJ                 DATE,
   VERSION              VARCHAR2(20),
   constraint PK_T_META_TABLESPACE primary key (ID)
)
/

comment on table T_META_TABLESPACE is
'表空间管理'
/

comment on column T_META_TABLESPACE.ID is
'ID'
/

comment on column T_META_TABLESPACE.DS_ID is
'数据源ID'
/

comment on column T_META_TABLESPACE.BKJMC is
'表空间名称'
/

comment on column T_META_TABLESPACE.BKJDX is
'表空间大小'
/

comment on column T_META_TABLESPACE.BKJCSZ is
'表空间初始值'
/

comment on column T_META_TABLESPACE.BKJYSY is
'表空间已使用大小'
/

comment on column T_META_TABLESPACE.BKJSYL is
'表空间使用率'
/

comment on column T_META_TABLESPACE.CXSJ is
'查询时间'
/

comment on column T_META_TABLESPACE.VERSION is
'数据源版本号'
/

/*==============================================================*/
/* Table: T_META_TABLE_ZS                                       */
/*==============================================================*/
create table T_META_TABLE_ZS 
(
   TBL_ID               INTEGER              not null,
   TBL_VERSION          VARCHAR2(20),
   DS_ID                INTEGER,
   DS_VERSION           VARCHAR2(20),
   TBL_NAME             VARCHAR2(50),
   TBL_DETAIL           VARCHAR2(500),
   CLASS_ID             INTEGER,
   SCHEMA               VARCHAR2(50),
   MODIFY_USER          VARCHAR2(50),
   TBL_COMMENTS         CHAR(1),
   COL_COMMENTS_Y       NUMBER,
   COL_COMMENTS_N       NUMBER,
   constraint PK_T_META_TABLE_ZS primary key (TBL_ID)
)
/

comment on table T_META_TABLE_ZS is
'数据表信息展示'
/

comment on column T_META_TABLE_ZS.TBL_ID is
'TBL_ID'
/

comment on column T_META_TABLE_ZS.TBL_VERSION is
'表版本号'
/

comment on column T_META_TABLE_ZS.DS_ID is
'DS_ID'
/

comment on column T_META_TABLE_ZS.DS_VERSION is
'数据源版本号'
/

comment on column T_META_TABLE_ZS.TBL_NAME is
'表名称'
/

comment on column T_META_TABLE_ZS.TBL_DETAIL is
'表描述'
/

comment on column T_META_TABLE_ZS.CLASS_ID is
'表所属类别'
/

comment on column T_META_TABLE_ZS.SCHEMA is
'所属数据库用户'
/

comment on column T_META_TABLE_ZS.MODIFY_USER is
'修改人'
/

comment on column T_META_TABLE_ZS.TBL_COMMENTS is
'是否存在表备注'
/

comment on column T_META_TABLE_ZS.COL_COMMENTS_Y is
'有字段备注'
/

comment on column T_META_TABLE_ZS.COL_COMMENTS_N is
'无字段备注'
/

/*==============================================================*/
/* Table: T_META_TBLCLASS                                       */
/*==============================================================*/
create table T_META_TBLCLASS 
(
   CLASS_ID             INTEGER              not null,
   CLASS_NAME           VARCHAR2(50),
   CLASS_DETAIL         VARCHAR2(200),
   CLASS_LEVEL          NUMBER(1),
   P_ID                 INTEGER,
   DS_ID                INTEGER,
   constraint PK_T_META_TBLCLASS primary key (CLASS_ID)
)
/

comment on table T_META_TBLCLASS is
'数据表类别
'
/

comment on column T_META_TBLCLASS.CLASS_ID is
'CLASS_ID'
/

comment on column T_META_TBLCLASS.CLASS_NAME is
'类别名'
/

comment on column T_META_TBLCLASS.CLASS_DETAIL is
'类别描述'
/

comment on column T_META_TBLCLASS.CLASS_LEVEL is
'类别层级'
/

comment on column T_META_TBLCLASS.P_ID is
'父类别ID'
/

comment on column T_META_TBLCLASS.DS_ID is
'DS_ID'
/

/*==============================================================*/
/* Table: T_META_TBLMAP                                         */
/*==============================================================*/
create table T_META_TBLMAP 
(
   ID                   INTEGER              not null,
   TBL_ID               INTEGER,
   SOURCE_ID            INTEGER,
   constraint PK_T_META_TBLMAP primary key (ID)
)
/

comment on table T_META_TBLMAP is
'表数据来源映射关系'
/

comment on column T_META_TBLMAP.ID is
'ID'
/

comment on column T_META_TBLMAP.TBL_ID is
'TBL_ID'
/

comment on column T_META_TBLMAP.SOURCE_ID is
'来源表ID'
/

/*==============================================================*/
/* Table: T_META_TBLRELATION                                    */
/*==============================================================*/
create table T_META_TBLRELATION 
(
   ID                   INTEGER              not null,
   DS_ID                INTEGER,
   DS_VERSION           VARCHAR2(100),
   RELATION_TYPE        CHAR(1),
   REMARK               VARCHAR2(500),
   CONSTRAINT_NAME      VARCHAR2(200),
   FK_OWNER             VARCHAR2(50),
   FK_TABLE             VARCHAR2(100),
   FK_COLUMN            VARCHAR2(100),
   PK_OWNER             VARCHAR2(50),
   PK_TABLE             VARCHAR2(100),
   PK_COLUMN            VARCHAR2(100),
   constraint PK_T_META_TBLRELATION primary key (ID)
)
/

comment on table T_META_TBLRELATION is
'表关联关系表'
/

comment on column T_META_TBLRELATION.ID is
'ID'
/

comment on column T_META_TBLRELATION.DS_ID is
'DS_ID'
/

comment on column T_META_TBLRELATION.DS_VERSION is
'数据源版本号'
/

comment on column T_META_TBLRELATION.RELATION_TYPE is
'关联类型'
/

comment on column T_META_TBLRELATION.REMARK is
'关联关系备注'
/

comment on column T_META_TBLRELATION.CONSTRAINT_NAME is
'约束名称'
/

comment on column T_META_TBLRELATION.FK_OWNER is
'外键拥有者'
/

comment on column T_META_TBLRELATION.FK_TABLE is
'外键表'
/

comment on column T_META_TBLRELATION.FK_COLUMN is
'外键列'
/

comment on column T_META_TBLRELATION.PK_OWNER is
'主键拥有者'
/

comment on column T_META_TBLRELATION.PK_TABLE is
'主键表'
/

comment on column T_META_TBLRELATION.PK_COLUMN is
'主键列'
/

/*==============================================================*/
/* Table: T_META_VERIFY_RELATION                                */
/*==============================================================*/
create table T_META_VERIFY_RELATION 
(
   ID                   INTEGER              not null,
   MTBL_ID              INTEGER,
   JOB_ID               INTEGER,
   constraint PK_T_META_VERIFY_RELATION primary key (ID)
)
/

comment on table T_META_VERIFY_RELATION is
'元数据验证规则关联关系'
/

comment on column T_META_VERIFY_RELATION.ID is
'ID'
/

comment on column T_META_VERIFY_RELATION.MTBL_ID is
'MTBL_ID'
/

comment on column T_META_VERIFY_RELATION.JOB_ID is
'JOB_ID'
/

/*==============================================================*/
/* Table: T_META_VERIFY_RESULT                                  */
/*==============================================================*/
create table T_META_VERIFY_RESULT 
(
   ID                   INTEGER              not null,
   JOB_ID               INTEGER,
   EXEC_PARM            VARCHAR2(100),
   STAT                 CHAR(1),
   TOTAL_NUM            INTEGER,
   PASS_NUM             INTEGER,
   RESULT_REPORT        VARCHAR2(2000),
   EXEC_TIME            DATE,
   EXEC_USER            VARCHAR2(50),
   constraint PK_T_META_VERIFY_RESULT primary key (ID)
)
/

comment on table T_META_VERIFY_RESULT is
'元数据验证结果'
/

comment on column T_META_VERIFY_RESULT.ID is
'ID'
/

comment on column T_META_VERIFY_RESULT.JOB_ID is
'所属验证规则'
/

comment on column T_META_VERIFY_RESULT.EXEC_PARM is
'验证输入参数'
/

comment on column T_META_VERIFY_RESULT.STAT is
'验证状态'
/

comment on column T_META_VERIFY_RESULT.TOTAL_NUM is
'验证总数据量'
/

comment on column T_META_VERIFY_RESULT.PASS_NUM is
'通过验证数据'
/

comment on column T_META_VERIFY_RESULT.RESULT_REPORT is
'验证结果报告'
/

comment on column T_META_VERIFY_RESULT.EXEC_TIME is
'执行时间'
/

comment on column T_META_VERIFY_RESULT.EXEC_USER is
'执行人'
/

/*==============================================================*/
/* Table: T_META_XYFX                                           */
/*==============================================================*/
create table T_META_XYFX 
(
   ID                   INTEGER              not null,
   XYFXMC               VARCHAR2(100),
   XYFXBZ               VARCHAR2(500),
   CJSJ                 DATE,
   CJR                  VARCHAR2(20),
   ZHXGSJ               DATE,
   ZHXGR                VARCHAR2(20),
   constraint PK_T_META_XYFX primary key (ID)
)
/

comment on table T_META_XYFX is
'血缘分析表'
/

comment on column T_META_XYFX.XYFXMC is
'血缘分析名称'
/

comment on column T_META_XYFX.XYFXBZ is
'血缘分析备注'
/

/*==============================================================*/
/* Table: T_META_XYFX_PZ                                        */
/*==============================================================*/
create table T_META_XYFX_PZ 
(
   ID                   INTEGER              not null,
   XYFX_ID              INTEGER,
   DS_ID                INTEGER,
   TBL_ID               INTEGER,
   P_DS_ID              INTEGER,
   P_TBL_ID             INTEGER,
   OFFSET_TOP           INTEGER,
   OFFSET_LEFT          INTEGER,
   P_OFFSET_TOP         INTEGER,
   P_OFFSET_LEFT        INTEGER,
   STROKE_COLOR         VARCHAR2(20),
   constraint PK_T_META_XYFX_PZ primary key (ID)
)
/

comment on table T_META_XYFX_PZ is
'血缘分析配置表'
/

comment on column T_META_XYFX_PZ.ID is
'ID'
/

comment on column T_META_XYFX_PZ.XYFX_ID is
'血缘分析ID'
/

comment on column T_META_XYFX_PZ.DS_ID is
'目标数据源ID'
/

comment on column T_META_XYFX_PZ.TBL_ID is
'目标表ID'
/

comment on column T_META_XYFX_PZ.P_DS_ID is
'来源数据源ID'
/

comment on column T_META_XYFX_PZ.P_TBL_ID is
'来源表ID'
/

comment on column T_META_XYFX_PZ.OFFSET_TOP is
'目标表顶部偏距'
/

comment on column T_META_XYFX_PZ.OFFSET_LEFT is
'目标表左部偏距'
/

comment on column T_META_XYFX_PZ.P_OFFSET_TOP is
'来源表顶部偏距'
/

comment on column T_META_XYFX_PZ.P_OFFSET_LEFT is
'来源表左部偏距'
/

/*==============================================================*/
/* Table: T_META_ZDY_PXSL                                       */
/*==============================================================*/
create table T_META_ZDY_PXSL 
(
   ID                   INTEGER              not null,
   DS_ID                INTEGER,
   PXSLMC               VARCHAR2(200),
   PXZLSQL              CLOB,
   PXBHGLSQL            CLOB,
   PXBZ                 VARCHAR2(500),
   constraint PK_T_META_ZDY_PXSL primary key (ID)
)
/

comment on table T_META_ZDY_PXSL is
'自定义剖析实例表'
/

comment on column T_META_ZDY_PXSL.ID is
'ID'
/

comment on column T_META_ZDY_PXSL.DS_ID is
'数据源ID'
/

comment on column T_META_ZDY_PXSL.PXSLMC is
'自定义剖析实例名称'
/

comment on column T_META_ZDY_PXSL.PXZLSQL is
'自定义剖析总数量SQL'
/

comment on column T_META_ZDY_PXSL.PXBHGLSQL is
'自定义剖析合格数据量SQL'
/

comment on column T_META_ZDY_PXSL.PXBZ is
'自定义剖析备注'
/

/*==============================================================*/
/* Table: T_META_ZDY_PXSL_CWRZ                                  */
/*==============================================================*/
create table T_META_ZDY_PXSL_CWRZ 
(
   ID                   INTEGER              not null,
   ZDY_PXSL_ID          INTEGER,
   GXSJ                 DATE,
   ERROR_MSG            VARCHAR2(500),
   ERROR_NUM            NUMBER(12),
   ERROR_LINE           VARCHAR2(500),
   constraint PK_T_META_ZDY_PXSL_CWRZ primary key (ID)
)
/

comment on table T_META_ZDY_PXSL_CWRZ is
'自定义剖析实例错误日志'
/

comment on column T_META_ZDY_PXSL_CWRZ.ID is
'ID'
/

comment on column T_META_ZDY_PXSL_CWRZ.ZDY_PXSL_ID is
'自定义剖析实例ID'
/

comment on column T_META_ZDY_PXSL_CWRZ.GXSJ is
'更新时间'
/

comment on column T_META_ZDY_PXSL_CWRZ.ERROR_MSG is
'错误详细信息'
/

comment on column T_META_ZDY_PXSL_CWRZ.ERROR_NUM is
'错误编号'
/

comment on column T_META_ZDY_PXSL_CWRZ.ERROR_LINE is
'错误行号'
/

/*==============================================================*/
/* Table: T_META_ZDY_PXSL_ZXJG                                  */
/*==============================================================*/
create table T_META_ZDY_PXSL_ZXJG 
(
   ID                   INTEGER              not null,
   ZDY_PXSL_ID          INTEGER,
   PXZL                 NUMBER,
   PXWTGL               NUMBER,
   PXDBL                NUMBER(5,2),
   PXSJ                 DATE,
   constraint PK_T_META_ZDY_PXSL_ZXJG primary key (ID)
)
/

comment on table T_META_ZDY_PXSL_ZXJG is
'自定义剖析实例执行结果'
/

comment on column T_META_ZDY_PXSL_ZXJG.ID is
'ID'
/

comment on column T_META_ZDY_PXSL_ZXJG.ZDY_PXSL_ID is
'自定义剖析实例ID'
/

comment on column T_META_ZDY_PXSL_ZXJG.PXZL is
'自定义剖析总量'
/

comment on column T_META_ZDY_PXSL_ZXJG.PXWTGL is
'自定义剖析通过量'
/

comment on column T_META_ZDY_PXSL_ZXJG.PXDBL is
'自定义剖析达标率'
/

comment on column T_META_ZDY_PXSL_ZXJG.PXSJ is
'自定义剖析时间'
/

/*==============================================================*/
/* Table: T_META_ZLPG_JBXX                                      */
/*==============================================================*/
create table T_META_ZLPG_JBXX 
(
   ID                   INTEGER              not null,
   PGMC                 VARCHAR2(100),
   PGJG                 NUMBER(5,2),
   FZ                   NUMBER(5,2),
   CJR                  VARCHAR2(50),
   CJSJ                 DATE,
   ZHXGR                VARCHAR2(50),
   ZHXGSJ               DATE,
   SFFSDX               CHAR(1),
   constraint PK_T_META_ZLPG_JBXX primary key (ID)
)
/

comment on table T_META_ZLPG_JBXX is
'质量评估基本信息'
/

comment on column T_META_ZLPG_JBXX.ID is
'ID'
/

comment on column T_META_ZLPG_JBXX.PGMC is
'评估名称'
/

comment on column T_META_ZLPG_JBXX.PGJG is
'评估结果'
/

comment on column T_META_ZLPG_JBXX.FZ is
'阀值'
/

comment on column T_META_ZLPG_JBXX.CJR is
'创建人'
/

comment on column T_META_ZLPG_JBXX.CJSJ is
'创建时间'
/

comment on column T_META_ZLPG_JBXX.ZHXGR is
'最后修改人'
/

comment on column T_META_ZLPG_JBXX.ZHXGSJ is
'最后修改时间'
/

comment on column T_META_ZLPG_JBXX.SFFSDX is
'是否发送短信'
/

/*==============================================================*/
/* Table: T_META_ZLPG_JG                                        */
/*==============================================================*/
create table T_META_ZLPG_JG 
(
   ID                   INTEGER              not null,
   ZLPG_ID              INTEGER,
   PGMC                 VARCHAR2(100),
   PGFS                 NUMBER(5,2),
   FZ                   NUMBER(5,2),
   PGSJ                 DATE,
   constraint PK_T_META_ZLPG_JG primary key (ID)
)
/

comment on table T_META_ZLPG_JG is
'质量评估结果'
/

comment on column T_META_ZLPG_JG.ID is
'ID'
/

comment on column T_META_ZLPG_JG.ZLPG_ID is
'质量评估ID'
/

comment on column T_META_ZLPG_JG.PGMC is
'评估名称'
/

comment on column T_META_ZLPG_JG.PGFS is
'评估分数'
/

comment on column T_META_ZLPG_JG.FZ is
'阀值'
/

comment on column T_META_ZLPG_JG.PGSJ is
'评估时间'
/

/*==============================================================*/
/* Table: T_META_ZLPG_PXSL_GL                                   */
/*==============================================================*/
create table T_META_ZLPG_PXSL_GL 
(
   ID                   INTEGER              not null,
   ZLPG_ID              INTEGER,
   PXSL_ID              INTEGER,
   QZ                   NUMBER(5,2),
   constraint PK_T_META_ZLPG_PXSL_GL primary key (ID)
)
/

comment on table T_META_ZLPG_PXSL_GL is
'质量评估与剖析实例关联表'
/

comment on column T_META_ZLPG_PXSL_GL.ID is
'ID'
/

comment on column T_META_ZLPG_PXSL_GL.ZLPG_ID is
'质量评估ID'
/

comment on column T_META_ZLPG_PXSL_GL.PXSL_ID is
'剖析实例ID'
/

comment on column T_META_ZLPG_PXSL_GL.QZ is
'权重'
/

/*==============================================================*/
/* Table: T_MODULE_METATABLE                                    */
/*==============================================================*/
create table T_MODULE_METATABLE 
(
   MTBL_ID              INTEGER              not null,
   MTBL_NAME            VARCHAR2(30),
   MTBL_DETAIL          VARCHAR2(200),
   SOURCE_TYPE          CHAR(1),
   CLASS_ID             INTEGER,
   DS_ID                INTEGER,
   VERSION              VARCHAR2(20),
   STAT                 CHAR(1),
   URL                  VARCHAR2(100),
   constraint PK_T_MODULE_METATABLE primary key (MTBL_ID)
)
/

comment on table T_MODULE_METATABLE is
'元数据表基本信息'
/

comment on column T_MODULE_METATABLE.MTBL_ID is
'MTBL_ID'
/

comment on column T_MODULE_METATABLE.MTBL_NAME is
'表名'
/

comment on column T_MODULE_METATABLE.MTBL_DETAIL is
'表描述'
/

comment on column T_MODULE_METATABLE.SOURCE_TYPE is
'表来源'
/

comment on column T_MODULE_METATABLE.CLASS_ID is
'所属分类'
/

comment on column T_MODULE_METATABLE.DS_ID is
'DS_ID'
/

comment on column T_MODULE_METATABLE.VERSION is
'版本号'
/

comment on column T_MODULE_METATABLE.STAT is
'状态标记'
/

comment on column T_MODULE_METATABLE.URL is
'URL'
/

/*==============================================================*/
/* Table: T_MODULE_MTBLCLASS                                    */
/*==============================================================*/
create table T_MODULE_MTBLCLASS 
(
   CLASS_ID             INTEGER              not null,
   CLASS_NAME           VARCHAR2(50),
   CLASS_DETAIL         VARCHAR2(200),
   CLASS_LEVEL          NUMBER(1),
   P_ID                 INTEGER,
   constraint PK_T_MODULE_MTBLCLASS primary key (CLASS_ID)
)
/

comment on table T_MODULE_MTBLCLASS is
'元数据表类别'
/

comment on column T_MODULE_MTBLCLASS.CLASS_ID is
'CLASS_ID'
/

comment on column T_MODULE_MTBLCLASS.CLASS_NAME is
'类别名'
/

comment on column T_MODULE_MTBLCLASS.CLASS_DETAIL is
'类别描述'
/

comment on column T_MODULE_MTBLCLASS.CLASS_LEVEL is
'类别层级'
/

comment on column T_MODULE_MTBLCLASS.P_ID is
'父类别ID'
/

/*==============================================================*/
/* Table: T_MONITOR_DS_CONNINFO                                 */
/*==============================================================*/
create table T_MONITOR_DS_CONNINFO 
(
   DS_ID                INTEGER              not null,
   SESSION_ID           INTEGER              not null,
   STAT                 VARCHAR(8),
   USERNAME             VARCHAR(50),
   MACHINE              VARCHAR(100),
   LOGON_TIME           TIMESTAMP(6),
   constraint PK_T_MONITOR_DS_CONNINFO primary key (DS_ID, SESSION_ID)
)
/

comment on table T_MONITOR_DS_CONNINFO is
'数据源连接信息表'
/

comment on column T_MONITOR_DS_CONNINFO.DS_ID is
'DS_ID'
/

comment on column T_MONITOR_DS_CONNINFO.SESSION_ID is
'会话ID'
/

comment on column T_MONITOR_DS_CONNINFO.STAT is
'会话状态'
/

comment on column T_MONITOR_DS_CONNINFO.USERNAME is
'连接用户名'
/

comment on column T_MONITOR_DS_CONNINFO.MACHINE is
'连接终端机器名'
/

comment on column T_MONITOR_DS_CONNINFO.LOGON_TIME is
'连接时间'
/

/*==============================================================*/
/* Table: T_MONITOR_DS_STAT                                     */
/*==============================================================*/
create table T_MONITOR_DS_STAT 
(
   DS_ID                INTEGER              not null,
   CONN_STAT            INTEGER,
   USER_CONN_NUM        INTEGER,
   RECORD_TIME          TIMESTAMP,
   constraint PK_T_MONITOR_DS_STAT primary key (DS_ID)
)
/

comment on table T_MONITOR_DS_STAT is
'数据源状态表'
/

comment on column T_MONITOR_DS_STAT.DS_ID is
'DS_ID'
/

comment on column T_MONITOR_DS_STAT.CONN_STAT is
'数据源连通状态'
/

comment on column T_MONITOR_DS_STAT.USER_CONN_NUM is
'用户会话连接数'
/

comment on column T_MONITOR_DS_STAT.RECORD_TIME is
'记录时间'
/

/*==============================================================*/
/* Table: T_MONITOR_DS_SYNC_AUDIT                               */
/*==============================================================*/
create table T_MONITOR_DS_SYNC_AUDIT 
(
   ID                   INTEGER              not null,
   DS_ID                INTEGER,
   SYNC_TBL             VARCHAR(30),
   SYNC_STAT            CHAR(1),
   SYNC_TIME            TIMESTAMP,
   constraint PK_T_MONITOR_DS_SYNC_AUDIT primary key (ID)
)
/

comment on table T_MONITOR_DS_SYNC_AUDIT is
'数据源监控信息同步审计表'
/

comment on column T_MONITOR_DS_SYNC_AUDIT.ID is
'ID'
/

comment on column T_MONITOR_DS_SYNC_AUDIT.DS_ID is
'DS_ID'
/

comment on column T_MONITOR_DS_SYNC_AUDIT.SYNC_TBL is
'同步表'
/

comment on column T_MONITOR_DS_SYNC_AUDIT.SYNC_STAT is
'同步状态'
/

comment on column T_MONITOR_DS_SYNC_AUDIT.SYNC_TIME is
'同步时间'
/


/*==============================================================*/
/* Table: T_R_JOBRELATION                                       */
/*==============================================================*/
create table T_R_JOBRELATION 
(
   ID                   INTEGER              not null,
   R_JOB_ID             INTEGER,
   T_JOB_SEQUENCE       INTEGER,
   constraint PK_T_R_JOBRELATION primary key (ID)
)
/

comment on table T_R_JOBRELATION is
'RJOB与TJOB的ID关联表'
/

comment on column T_R_JOBRELATION.ID is
'ID'
/

comment on column T_R_JOBRELATION.R_JOB_ID is
'R_JOB_ID'
/

comment on column T_R_JOBRELATION.T_JOB_SEQUENCE is
'T_JOB_SEQUENCE'
/

/*==============================================================*/
/* Table: T_SCHEDULE_DEFINE                                     */
/*==============================================================*/
create table T_SCHEDULE_DEFINE 
(
   SCHEDULE_ID          INTEGER              not null,
   SCHEDULE_NAME        VARCHAR2(100)        not null,
   BEGIN_DATE           DATE,
   END_DATE             DATE,
   PRIORITY             INTEGER,
   DESCRIBE             VARCHAR2(200),
   IS_REPEAT            CHAR(1),
   UNIT_TYPE            CHAR(1),
   SEC_INTERVAL         INTEGER,
   MIN_INTERVAL         INTEGER,
   HOUR_INTERVAL        INTEGER,
   EXEC_MIN             INTEGER,
   EXEC_HOUR            INTEGER,
   EXEC_DAY             INTEGER,
   EXEC_WEEK            INTEGER,
   EXEC_MONTH           INTEGER,
   CREATE_DATE          DATE,
   UPTIME               DATE,
   constraint PK_T_SCHEDULE_DEFINE primary key (SCHEDULE_ID)
)
/

comment on table T_SCHEDULE_DEFINE is
'调度信息表'
/

comment on column T_SCHEDULE_DEFINE.SCHEDULE_ID is
'SCHEDULE_ID'
/

comment on column T_SCHEDULE_DEFINE.SCHEDULE_NAME is
'调度名称'
/

comment on column T_SCHEDULE_DEFINE.BEGIN_DATE is
'调度生效时间'
/

comment on column T_SCHEDULE_DEFINE.END_DATE is
'调度失效时间'
/

comment on column T_SCHEDULE_DEFINE.PRIORITY is
'调度优先级'
/

comment on column T_SCHEDULE_DEFINE.DESCRIBE is
'调度描述'
/

comment on column T_SCHEDULE_DEFINE.IS_REPEAT is
'是否重复任务'
/

comment on column T_SCHEDULE_DEFINE.UNIT_TYPE is
'调度频率类别'
/

comment on column T_SCHEDULE_DEFINE.SEC_INTERVAL is
'以秒计算的间隔'
/

comment on column T_SCHEDULE_DEFINE.MIN_INTERVAL is
'以分钟计算的间隔'
/

comment on column T_SCHEDULE_DEFINE.HOUR_INTERVAL is
'以小时计算的间隔'
/

comment on column T_SCHEDULE_DEFINE.EXEC_MIN is
'执行时间（分钟）'
/

comment on column T_SCHEDULE_DEFINE.EXEC_HOUR is
'执行时间（小时）'
/

comment on column T_SCHEDULE_DEFINE.EXEC_DAY is
'执行时间（天）'
/

comment on column T_SCHEDULE_DEFINE.EXEC_WEEK is
'执行时间（星期）'
/

comment on column T_SCHEDULE_DEFINE.EXEC_MONTH is
'执行时间（月）'
/

comment on column T_SCHEDULE_DEFINE.CREATE_DATE is
'创建时间'
/

comment on column T_SCHEDULE_DEFINE.UPTIME is
'更新时间'
/

/*==============================================================*/
/* Table: T_SJYFL                                               */
/*==============================================================*/
create table T_SJYFL 
(
   ID                   INTEGER              not null,
   BZGF_ID              INTEGER,
   SJYFLMC              VARCHAR2(200),
   SJYFLDM              VARCHAR2(50),
   SJYFLMS              VARCHAR2(500),
   CJR                  VARCHAR2(50),
   CJSJ                 DATE,
   ZHXGR                VARCHAR2(50),
   ZHXGSJ               DATE,
   constraint PK_T_SJYFL primary key (ID)
)
/

comment on table T_SJYFL is
'数据元分类表'
/

comment on column T_SJYFL.ID is
'ID'
/

comment on column T_SJYFL.BZGF_ID is
'标准规范ID'
/

comment on column T_SJYFL.SJYFLMC is
'数据元分类名称'
/

comment on column T_SJYFL.SJYFLDM is
'数据元分类代码'
/

comment on column T_SJYFL.SJYFLMS is
'数据元分类描述'
/

comment on column T_SJYFL.CJR is
'创建人'
/

comment on column T_SJYFL.CJSJ is
'创建时间'
/

comment on column T_SJYFL.ZHXGR is
'最后修改人'
/

comment on column T_SJYFL.ZHXGSJ is
'最后修改时间'
/

/*==============================================================*/
/* Table: T_SYS_CONFIG                                          */
/*==============================================================*/
create table T_SYS_CONFIG 
(
   ID                   INTEGER              not null,
   PARAM_NAME           VARCHAR2(100),
   PARAM_DETAIL         VARCHAR2(500),
   PARAM_VALUE          VARCHAR2(50),
   FACTORY_VALUE        VARCHAR2(50),
   OPERID               INTEGER,
   UPTIME               DATE,
   constraint PK_T_SYS_CONFIG primary key (ID)
)
/

comment on table T_SYS_CONFIG is
'系统参数表'
/

comment on column T_SYS_CONFIG.ID is
'ID'
/

comment on column T_SYS_CONFIG.PARAM_NAME is
'参数名称'
/

comment on column T_SYS_CONFIG.PARAM_DETAIL is
'参数描述'
/

comment on column T_SYS_CONFIG.PARAM_VALUE is
'参数设定值'
/

comment on column T_SYS_CONFIG.FACTORY_VALUE is
'参数初始默认值'
/

comment on column T_SYS_CONFIG.OPERID is
'最新修改人'
/

comment on column T_SYS_CONFIG.UPTIME is
'最新修改日期'
/



/*==============================================================*/
/* Table: T_ZDPZ_BZGF_JY                                        */
/*==============================================================*/
create table T_ZDPZ_BZGF_JY 
(
   ID                   INTEGER              not null,
   DS_ID                NUMBER,
   BZGF_ID              VARCHAR2(200),
   CJR                  VARCHAR2(20),
   CJSJ                 DATE,
   constraint PK_T_ZDPZ_BZGF_JY primary key (ID)
)
/

comment on table T_ZDPZ_BZGF_JY is
'字段标准规范校验表'
/

comment on column T_ZDPZ_BZGF_JY.ID is
'ID'
/

comment on column T_ZDPZ_BZGF_JY.DS_ID is
'数据源ID'
/

comment on column T_ZDPZ_BZGF_JY.BZGF_ID is
'标准规范ID'
/

comment on column T_ZDPZ_BZGF_JY.CJR is
'创建人'
/

comment on column T_ZDPZ_BZGF_JY.CJSJ is
'创建时间'
/

/*==============================================================*/
/* Table: T_ZDPZ_BZGF_JYJG                                      */
/*==============================================================*/
create table T_ZDPZ_BZGF_JYJG 
(
   ID                   INTEGER              not null,
   ZDPZ_BZGF_JY_ID      NUMBER,
   ZDPZ_BZGFMC          VARCHAR2(4000),
   VERSION              VARCHAR2(20),
   LXHGL                NUMBER(5,2),
   CDHGL                NUMBER(5,2),
   ZHGL                 NUMBER(5,2),
   JYRQ                 DATE,
   LXQZ                 NUMBER(5,2),
   CDQZ                 NUMBER(5,2),
   HGLFZ                NUMBER(5,2),
   ZDPPGZ               CHAR(1),
   CDJYGZ               CHAR(1),
   constraint PK_T_ZDPZ_BZGF_JYJG primary key (ID)
)
/

comment on table T_ZDPZ_BZGF_JYJG is
'字段标准规范校验结果表'
/

comment on column T_ZDPZ_BZGF_JYJG.ID is
'ID'
/

comment on column T_ZDPZ_BZGF_JYJG.ZDPZ_BZGF_JY_ID is
'标准规范校验ID'
/

comment on column T_ZDPZ_BZGF_JYJG.ZDPZ_BZGFMC is
'标准规范名称'
/

comment on column T_ZDPZ_BZGF_JYJG.VERSION is
'版本号'
/

comment on column T_ZDPZ_BZGF_JYJG.LXHGL is
'类型合格率'
/

comment on column T_ZDPZ_BZGF_JYJG.CDHGL is
'长度合格率'
/

comment on column T_ZDPZ_BZGF_JYJG.ZHGL is
'总合格率'
/

comment on column T_ZDPZ_BZGF_JYJG.JYRQ is
'校验日期'
/

comment on column T_ZDPZ_BZGF_JYJG.LXQZ is
'类型校验权重'
/

comment on column T_ZDPZ_BZGF_JYJG.CDQZ is
'长度校验权重'
/

comment on column T_ZDPZ_BZGF_JYJG.HGLFZ is
'合格率阀值'
/

comment on column T_ZDPZ_BZGF_JYJG.ZDPPGZ is
'自动匹配规则'
/

comment on column T_ZDPZ_BZGF_JYJG.CDJYGZ is
'长度校验规则'
/

/*==============================================================*/
/* Table: T_ZDPZ_BZGF_JYXQ                                      */
/*==============================================================*/
create table T_ZDPZ_BZGF_JYXQ 
(
   ID                   INTEGER              not null,
   ZDPZ_BZGF_JYJG_ID    INTEGER,
   BZGFMC               VARCHAR2(200),
   SJYFLMC              VARCHAR2(200),
   JCSJYMC              VARCHAR2(200),
   MBSJYMC              VARCHAR2(200),
   MBBMC                VARCHAR2(200),
   MBBMS                VARCHAR2(500),
   MBZDMC               VARCHAR2(200),
   LXHGBS               CHAR(1),
   CDHGBS               CHAR(1),
   JCSJYLX              VARCHAR2(500),
   JCSJYCD              VARCHAR2(500),
   MBZDLX               VARCHAR2(500),
   MBZDCD               VARCHAR2(500),
   MBZDBZ               VARCHAR2(500),
   JYSJ                 DATE,
   JCSJYXSWS            INTEGER,
   MBZDXSWS             INTEGER,
   VERSION              VARCHAR2(20),
   JCSJYDM              VARCHAR2(50),
   SJYFL_ID             INTEGER,
   JCSJY_ID             INTEGER,
   constraint PK_T_ZDPZ_BZGF_JYXQ primary key (ID)
)
/

comment on table T_ZDPZ_BZGF_JYXQ is
'字段标准规范校验详情表'
/

comment on column T_ZDPZ_BZGF_JYXQ.ID is
'ID'
/

comment on column T_ZDPZ_BZGF_JYXQ.ZDPZ_BZGF_JYJG_ID is
'标准规范校验结果ID'
/

comment on column T_ZDPZ_BZGF_JYXQ.BZGFMC is
'标准规范名称'
/

comment on column T_ZDPZ_BZGF_JYXQ.SJYFLMC is
'数据元分类名称'
/

comment on column T_ZDPZ_BZGF_JYXQ.JCSJYMC is
'基础数据元名称'
/

comment on column T_ZDPZ_BZGF_JYXQ.MBSJYMC is
'目标数据源名称'
/

comment on column T_ZDPZ_BZGF_JYXQ.MBBMC is
'目标表名称'
/

comment on column T_ZDPZ_BZGF_JYXQ.MBBMS is
'目标表描述'
/

comment on column T_ZDPZ_BZGF_JYXQ.MBZDMC is
'目标字段名称'
/

comment on column T_ZDPZ_BZGF_JYXQ.LXHGBS is
'类型合格标识'
/

comment on column T_ZDPZ_BZGF_JYXQ.CDHGBS is
'长度合格标识'
/

comment on column T_ZDPZ_BZGF_JYXQ.JCSJYLX is
'数据元类型'
/

comment on column T_ZDPZ_BZGF_JYXQ.JCSJYCD is
'数据元长度'
/

comment on column T_ZDPZ_BZGF_JYXQ.MBZDLX is
'目标字段类型'
/

comment on column T_ZDPZ_BZGF_JYXQ.MBZDCD is
'目标字段长度'
/

comment on column T_ZDPZ_BZGF_JYXQ.MBZDBZ is
'目标字段备注'
/

comment on column T_ZDPZ_BZGF_JYXQ.JYSJ is
'校验时间'
/

comment on column T_ZDPZ_BZGF_JYXQ.JCSJYXSWS is
'数据元小数位长度'
/

comment on column T_ZDPZ_BZGF_JYXQ.MBZDXSWS is
'目标字段小数位长度'
/

comment on column T_ZDPZ_BZGF_JYXQ.VERSION is
'版本号'
/

comment on column T_ZDPZ_BZGF_JYXQ.JCSJYDM is
'基础数据元代码'
/

comment on column T_ZDPZ_BZGF_JYXQ.SJYFL_ID is
'数据元分类ID'
/

comment on column T_ZDPZ_BZGF_JYXQ.JCSJY_ID is
'基础数据元ID'
/

/*==============================================================*/
/* Table: T_ZDPZ_BZGF_WPP                                       */
/*==============================================================*/
create table T_ZDPZ_BZGF_WPP 
(
   ID                   INTEGER              not null,
   ZDPZ_BZGF_JYJG_ID    INTEGER,
   TBL_NAME             VARCHAR2(500),
   COL_NAME             VARCHAR2(500),
   COL_REMARK           VARCHAR2(500),
   COL_TYPE             VARCHAR2(50),
   COL_LENGTH           INTEGER,
   COL_SCALE            INTEGER,
   VERSION              VARCHAR2(20),
   constraint PK_T_ZDPZ_BZGF_WPP primary key (ID)
)
/

comment on table T_ZDPZ_BZGF_WPP is
'字段标准规范不匹配表'
/

comment on column T_ZDPZ_BZGF_WPP.ID is
'ID'
/

comment on column T_ZDPZ_BZGF_WPP.ZDPZ_BZGF_JYJG_ID is
'标准规范校验结果ID'
/

comment on column T_ZDPZ_BZGF_WPP.TBL_NAME is
'目标表名称'
/

comment on column T_ZDPZ_BZGF_WPP.COL_NAME is
'字段名称'
/

comment on column T_ZDPZ_BZGF_WPP.COL_REMARK is
'字段备注'
/

comment on column T_ZDPZ_BZGF_WPP.COL_TYPE is
'字段类型'
/

comment on column T_ZDPZ_BZGF_WPP.COL_LENGTH is
'字段长度'
/

comment on column T_ZDPZ_BZGF_WPP.COL_SCALE is
'小数位长度'
/

comment on column T_ZDPZ_BZGF_WPP.VERSION is
'版本号'
/

/*==============================================================*/
/* View: V_APP                                                  */
/*==============================================================*/
create or replace view V_APP as
select appId,appName,userId,dirId,parentId,type,describe,keyword,fileName,moduleId,appType,visible,orderBy,picName,createUser,updateUser,createTime,updateTime,
CASE when exists (select t1.appId from T_APP t1 where t1.parentId = t.appId) then 'closed'
     else '' end STATE
from T_APP t
order by orderBy;
/

 comment on table V_APP is
'V_APP'
/

comment on column V_APP.APPID is
'APPID'
/

comment on column V_APP.APPNAME is
'APPNAME'
/

comment on column V_APP.USERID is
'USERID'
/

comment on column V_APP.DIRID is
'DIRID'
/

comment on column V_APP.PARENTID is
'PARENTID'
/

comment on column V_APP.TYPE is
'TYPE'
/

comment on column V_APP.DESCRIBE is
'DESCRIBE'
/

comment on column V_APP.KEYWORD is
'KEYWORD'
/

comment on column V_APP.FILENAME is
'FILENAME'
/

comment on column V_APP.MODULEID is
'MODULEID'
/

comment on column V_APP.APPTYPE is
'APPTYPE'
/

comment on column V_APP.VISIBLE is
'VISIBLE'
/

comment on column V_APP.ORDERBY is
'ORDERBY'
/

comment on column V_APP.PICNAME is
'PICNAME'
/

comment on column V_APP.CREATEUSER is
'CREATEUSER'
/

comment on column V_APP.UPDATEUSER is
'UPDATEUSER'
/

comment on column V_APP.CREATETIME is
'CREATETIME'
/

comment on column V_APP.UPDATETIME is
'UPDATETIME'
/

/*==============================================================*/
/* View: V_ONLY_ORGANIZATION                                    */
/*==============================================================*/
create or replace view V_ONLY_ORGANIZATION as
select ID,PARENTID,TYPE,STATUS,NAME,PASSWORD,PHONE,MOBILEPHONE,EMAIL,ADDRESS,CREATETIME,UPDATETIME,
CASE when exists (select t1.ID from T_ORGANIZATION t1 where t1.PARENTID = t.id) then 'closed'
     else '' end STATE
from T_ORGANIZATION t
order by ID;
/

 comment on table V_ONLY_ORGANIZATION is
'V_ONLY_ORGANIZATION'
/

comment on column V_ONLY_ORGANIZATION.ID is
'ID'
/

comment on column V_ONLY_ORGANIZATION.PARENTID is
'PARENTID'
/

comment on column V_ONLY_ORGANIZATION.TYPE is
'TYPE'
/

comment on column V_ONLY_ORGANIZATION.STATUS is
'STATUS'
/

comment on column V_ONLY_ORGANIZATION.NAME is
'NAME'
/

comment on column V_ONLY_ORGANIZATION.PASSWORD is
'PASSWORD'
/

comment on column V_ONLY_ORGANIZATION.PHONE is
'PHONE'
/

comment on column V_ONLY_ORGANIZATION.MOBILEPHONE is
'MOBILEPHONE'
/

comment on column V_ONLY_ORGANIZATION.EMAIL is
'EMAIL'
/

comment on column V_ONLY_ORGANIZATION.ADDRESS is
'ADDRESS'
/

comment on column V_ONLY_ORGANIZATION.CREATETIME is
'CREATETIME'
/

comment on column V_ONLY_ORGANIZATION.UPDATETIME is
'UPDATETIME'
/

comment on column V_ONLY_ORGANIZATION.STATE is
'STATE'
/

/*==============================================================*/
/* View: V_ORGANIZATION                                         */
/*==============================================================*/
create or replace view V_ORGANIZATION as
select ID,PARENTID,TYPE,STATUS,NAME,PASSWORD,PHONE,MOBILEPHONE,EMAIL,ADDRESS,CREATETIME,UPDATETIME,
CASE when exists (select t1.ID from T_ORGANIZATION t1 where t1.PARENTID = t.id) then 'closed'
     when exists (select t3.id from T_USER t3 where id in (select t2.userId from T_USER_ORGANIZATION t2 where t2.organizationId=t.id)) then 'closed'
     else '' end STATE
from T_ORGANIZATION t
order by ID;
/

 comment on table V_ORGANIZATION is
'V_ORGANIZATION'
/

comment on column V_ORGANIZATION.ID is
'ID'
/

comment on column V_ORGANIZATION.PARENTID is
'PARENTID'
/

comment on column V_ORGANIZATION.TYPE is
'TYPE'
/

comment on column V_ORGANIZATION.STATUS is
'STATUS'
/

comment on column V_ORGANIZATION.NAME is
'NAME'
/

comment on column V_ORGANIZATION.PASSWORD is
'PASSWORD'
/

comment on column V_ORGANIZATION.PHONE is
'PHONE'
/

comment on column V_ORGANIZATION.MOBILEPHONE is
'MOBILEPHONE'
/

comment on column V_ORGANIZATION.EMAIL is
'EMAIL'
/

comment on column V_ORGANIZATION.ADDRESS is
'ADDRESS'
/

comment on column V_ORGANIZATION.CREATETIME is
'CREATETIME'
/

comment on column V_ORGANIZATION.UPDATETIME is
'UPDATETIME'
/

comment on column V_ORGANIZATION.STATE is
'STATE'
/

/*==============================================================*/
/* View: V_RESOURCE                                             */
/*==============================================================*/
create or replace view V_RESOURCE as
select t.ID,t.PARENTID,t.NAME,t.STATUS,t.CREATETIME,t.UPDATETIME,t.NO,
CASE when exists (select t1.ID from t_resource t1 where t1.PARENTID = t.id) then 'closed'
     else '' end STATE
from t_resource t
order by ID;
/

 comment on table V_RESOURCE is
'V_RESOURCE'
/

comment on column V_RESOURCE.ID is
'ID'
/

comment on column V_RESOURCE.PARENTID is
'PARENTID'
/

comment on column V_RESOURCE.NAME is
'NAME'
/

comment on column V_RESOURCE.STATUS is
'STATUS'
/

comment on column V_RESOURCE.CREATETIME is
'CREATETIME'
/

comment on column V_RESOURCE.UPDATETIME is
'UPDATETIME'
/

comment on column V_RESOURCE.NO is
'NO'
/

comment on column V_RESOURCE.STATE is
'STATE'
/

/*==============================================================*/
/* View: V_ROLE                                                 */
/*==============================================================*/
create or replace view V_ROLE as
select t.ID,t.PARENTID,t.NAME,t.STATUS,t.CREATETIME,t.UPDATETIME,
CASE when exists (select t1.ID from t_role t1 where t1.PARENTID = t.id) then 'closed'
     else '' end STATE
from t_role t
order by ID;
/

 comment on table V_ROLE is
'V_ROLE'
/

comment on column V_ROLE.ID is
'ID'
/

comment on column V_ROLE.PARENTID is
'PARENTID'
/

comment on column V_ROLE.NAME is
'NAME'
/

comment on column V_ROLE.STATUS is
'STATUS'
/

comment on column V_ROLE.CREATETIME is
'CREATETIME'
/

comment on column V_ROLE.UPDATETIME is
'UPDATETIME'
/

comment on column V_ROLE.STATE is
'STATE'
/


CREATE OR REPLACE FUNCTION IS_DATE(PARMIN VARCHAR2)
RETURN NUMBER
IS
VAL DATE;
BEGIN
IF PARMIN IS NULL 
THEN 
RETURN 0;
ELSIF PARMIN IS NOT NULL
THEN
BEGIN
VAL := TO_DATE(PARMIN,'YYYY-MM-DD HH24:MI:SS');
RETURN 1;
EXCEPTION
WHEN OTHERS
THEN
RETURN 0;
END;
END IF;
END IS_DATE;
/


CREATE OR REPLACE FUNCTION IS_NUMBER(PARMIN VARCHAR2)
RETURN NUMBER
as
VAL number;
BEGIN
IF PARMIN IS NULL
THEN
RETURN 0;
ELSIF PARMIN IS NOT NULL
THEN
BEGIN
VAL:= TO_NUMBER(PARMIN);
RETURN 1;
EXCEPTION
WHEN OTHERS
THEN
RETURN 0;
END;
END IF;
END IS_NUMBER;
/


CREATE OR REPLACE PROCEDURE PRC_BKJ AS

--------表空间使用情况查询

CXSJ       VARCHAR2(4000);
VERSION    VARCHAR2(4000);
DSID       VARCHAR2(4000);
USERS      VARCHAR2(4000);
SQL1       VARCHAR2(4000);


CURSOR BKJ_SJY IS
  SELECT DS_ID,VERSION,CONNECT_USER FROM T_META_DATASOURCE WHERE USER_TYPE=2 AND STAT=1;
SJY BKJ_SJY%ROWTYPE;


BEGIN



OPEN BKJ_SJY;
LOOP
FETCH BKJ_SJY INTO SJY;
VERSION  :=SJY.VERSION;
DSID     :=SJY.DS_ID;
USERS    :=SJY.CONNECT_USER;
EXIT WHEN BKJ_SJY%NOTFOUND;

CXSJ :=to_char(SYSDATE,'yyyymmddhh24miss');

BEGIN
SQL1 :=
'INSERT INTO T_META_TABLESPACE(ID,DS_ID,VERSION,BKJMC,BKJDX,BKJCSZ,BKJYSY,BKJSYL,CXSJ)
SELECT SEQ_TABLESPACE_ID.NEXTVAL ID
       ,T.*
FROM (SELECT  '||DSID||' DS_ID
              ,'||VERSION||' VERSION
              ,UPPER(F.TABLESPACE_NAME) bkjmc
              ,D.TOT_GROOTTE_MB bkjdx
              ,D.MIXBYTES bkjcsz
              ,F.HAVE_USE_MB bkjysy
              ,TO_CHAR(ROUND(HAVE_USE_MB / D.TOT_GROOTTE_MB * 100,2),990.99) bkjsyb
              ,to_date('||CXSJ||',''yyyymmddhh24miss'') CXSJ
        FROM (select f.TABLESPACE_NAME
                    ,round(sum(e.bytes)/1024/1024,2) as HAVE_USE_MB
              from dba_extents@DB_LINK_'||USERS||' e
              join dba_data_files@DB_LINK_'||USERS||' f on e.file_id=f.file_id
              group by f.TABLESPACE_NAME) F
            ,(SELECT DD.TABLESPACE_NAME
                    ,SUM(DD.BYTES/1024/1024) MIXBYTES
                    ,ROUND(DECODE(SUM(DD.MAXBYTES/1024/1024)
                    ,0
                    ,SUM(DD.BYTES/1024/1024)
                    ,SUM(DD.MAXBYTES/1024/1024)),2) TOT_GROOTTE_MB
              FROM sys.dba_data_files@DB_LINK_'||USERS||' DD
              GROUP BY DD.TABLESPACE_NAME) D
        WHERE D.TABLESPACE_NAME = F.TABLESPACE_NAME
        ORDER BY bkjsyb DESC) T';
EXECUTE IMMEDIATE SQL1;
COMMIT;

END;
END LOOP;
CLOSE BKJ_SJY;

END;
/


CREATE OR REPLACE PROCEDURE PRC_BZGF_JY(BZGF_CS_ID VARCHAR2) AS
--------标准规范校验

JYGZ        CHAR(1);
CDJYGZ      CHAR(1);
JY_ID       INTEGER;
JYJG_ID     INTEGER;
BZGF_ID     INTEGER;----标准规范ID
SJYFL_ID    INTEGER;----数据元分类ID
JCSJY_ID    INTEGER;----基础数据元ID
DS_ID       INTEGER;----目标数据源ID
TBL_ID      INTEGER;----目标表ID
COL_ID      INTEGER;----目标字段ID
BZGFMC      VARCHAR2(2000);
SJYFLMC     VARCHAR2(2000);
JCSJYMC     VARCHAR2(2000);
MBSJYMC     VARCHAR2(2000);
MBBMC       VARCHAR2(2000);
MBZDMC      VARCHAR2(2000);
LXHGBS      VARCHAR2(2000);
CDHGBS      VARCHAR2(2000);
JCSJYLX     VARCHAR2(2000);
JCSJYCD     VARCHAR2(2000);
MBZDLX      VARCHAR2(2000);
MBZDCD      VARCHAR2(2000);
SJGS_DM     VARCHAR2(2000);
A_LXHGBS    VARCHAR2(2000);
B_LXHGBS    VARCHAR2(2000);
A_CDHGBS    VARCHAR2(2000);
B_CDHGBS    VARCHAR2(2000);
A_QZ        VARCHAR2(2000);
B_QZ        VARCHAR2(2000);
V_BZGFMC    VARCHAR2(2000);
V_SJYFLMC   VARCHAR2(2000);
V_JCSJYMC   VARCHAR2(2000);
V_MBSJYMC   VARCHAR2(2000);
V_MBBMC     VARCHAR2(2000);
V_MBZDMC    VARCHAR2(2000);
V_LXHGBS    VARCHAR2(2000);
V_CDHGBS    VARCHAR2(2000);
V_JCSJYLX   VARCHAR2(2000);
V_JCSJYCD   VARCHAR2(2000);
V_MBZDLX    VARCHAR2(2000);
V_MBZDCD    VARCHAR2(2000);
V_SJGS_DM   VARCHAR2(2000);
Y_LXHGBS    VARCHAR2(2000);
N_LXHGBS    VARCHAR2(2000);
Y_CDHGBS    VARCHAR2(2000);
N_CDHGBS    VARCHAR2(2000);
V1_QZ       VARCHAR2(2000);
V2_QZ       VARCHAR2(2000);
JG_LXHGBS   VARCHAR2(2000);
JG_CDHGBS   VARCHAR2(2000);
JG_ZHGL     VARCHAR2(2000);
MBZDLXDM    VARCHAR2(2000);
V_MBZDLXDM  VARCHAR2(2000);
MBZDBZ      VARCHAR2(2000);
V_MBZDBZ    VARCHAR2(2000);
JYPZ_NUM    VARCHAR2(2000);
V_JYPZ_NUM  VARCHAR2(2000);
DATATIME    DATE;
HGLFZ       VARCHAR2(2000);
HG_HGLFZ    VARCHAR2(2000);
XSWSCD      VARCHAR2(2000);
V_XSWSCD    VARCHAR2(2000);
MBXSWSCD    VARCHAR2(2000);
V_MBXSWSCD  VARCHAR2(2000);
JCSJYDM     VARCHAR2(2000);
V_JCSJYDM   VARCHAR2(2000);

/***********游标*********/

CURSOR BZGF_JY IS
  SELECT ID,JYMC,CJR,CJSJ FROM T_BZGF_JY;
 JY BZGF_JY%ROWTYPE;
-------标准规范校验表

CURSOR BZGF_JYGZ IS
  SELECT ID,JYGZ,QZ,QJHGL,CDJYGZ FROM T_BZGF_JYGZ;
GZ BZGF_JYGZ%ROWTYPE;
-------标准规范校验规则表

CURSOR BZGF_JYPZ(BZGFJY_ID NUMBER) IS
  SELECT ID,BZGF_JY_ID,BZGF_ID,SJYFL_ID,JCSJY_ID,DS_ID,TBL_ID,COL_ID FROM T_BZGF_JYPZ WHERE BZGF_JY_ID=BZGFJY_ID;
 PZ BZGF_JYPZ%ROWTYPE;
-------标准规范校验配置表


BEGIN
DATATIME :=SYSDATE;
IF BZGF_CS_ID ='KONG'
THEN
  BEGIN
    /*******标准规范校验表循环********/
    OPEN BZGF_JY;
     LOOP
       fetch BZGF_JY into JY;
       JY_ID   := JY.ID;
       SELECT SEQ_BZGF_JYJG_ID.NEXTVAL INTO JYJG_ID FROM DUAL;
       --JYJG_ID := SEQ_BZGF_JYJG_ID.NEXTVAL;
       exit when BZGF_JY%NOTFOUND;

       BEGIN
       INSERT INTO T_BZGF_JYJG(ID,BZGF_JY_ID)
       VALUES (JYJG_ID,JY_ID);
       END;
       COMMIT;



          BEGIN
          /********标准规范校验表循环*******/

          FOR PZ IN BZGF_JYPZ(JY_ID)
         LOOP

        JYPZ_NUM := 'SELECT COUNT(*) FROM T_BZGF_JYPZ WHERE BZGF_JY_ID='||JY_ID||'';
        EXECUTE IMMEDIATE JYPZ_NUM INTO V_JYPZ_NUM;

        IF V_JYPZ_NUM>0 THEN

              BZGF_ID  := PZ.BZGF_ID;----标准规范ID
              SJYFL_ID := PZ.SJYFL_ID;----数据元分类ID
              JCSJY_ID := PZ.JCSJY_ID;----基础数据元ID
              DS_ID    := PZ.DS_ID;----目标数据源ID
              TBL_ID   := PZ.TBL_ID;----目标表ID
              COL_ID   := PZ.COL_ID;----目标字段ID


              BZGFMC  :=  'SELECT  BZGFMC         FROM T_BZGF             WHERE ID='||BZGF_ID||'';--标准规范名称
              EXECUTE IMMEDIATE BZGFMC INTO V_BZGFMC;
              SJYFLMC :=  'SELECT  SJYFLMC        FROM T_SJYFL            WHERE ID='||SJYFL_ID||'';--数据元分类名称
              EXECUTE IMMEDIATE SJYFLMC INTO V_SJYFLMC;
              JCSJYMC :=  'SELECT  SJYMC          FROM T_JCSJY            WHERE ID='||JCSJY_ID||'';--基础数据元名称
              EXECUTE IMMEDIATE JCSJYMC INTO V_JCSJYMC;
              JCSJYDM :=  'SELECT  SJYDM          FROM T_JCSJY            WHERE ID='||JCSJY_ID||'';--基础数据源代码
              EXECUTE IMMEDIATE JCSJYDM INTO V_JCSJYDM;
              MBSJYMC :=  'SELECT  DS_NAME        FROM T_META_DATASOURCE  WHERE DS_ID='||DS_ID||' AND STAT= 1';--目标数据源名称
              EXECUTE IMMEDIATE MBSJYMC INTO V_MBSJYMC;
              MBBMC   :=  'SELECT  TBL_NAME       FROM T_META_TABLE       WHERE TBL_ID='||TBL_ID||'';--目标表名称
              EXECUTE IMMEDIATE MBBMC INTO V_MBBMC;
              MBZDMC  :=  'SELECT  COL_NAME       FROM T_META_COLUMN      WHERE ID='||COL_ID||'';--目标字段名称
              EXECUTE IMMEDIATE MBZDMC INTO V_MBZDMC;
              MBZDBZ  :=  'SELECT  REMARK         FROM T_META_COLUMN      WHERE ID='||COL_ID||'';--目标字段备注
              EXECUTE IMMEDIATE MBZDBZ INTO V_MBZDBZ;
              SJGS_DM :=  'SELECT  SJGS           FROM T_JCSJY            WHERE ID='||JCSJY_ID||'';--数据元类型代码
              EXECUTE IMMEDIATE SJGS_DM INTO V_SJGS_DM;
              JCSJYLX :=  'SELECT  T.DMBZ         FROM (SELECT * FROM T_DMLB A,T_DMLB_GGDM B WHERE A.DMLBMC=''数据格式'') T
                                                                            WHERE T.DMBH=('||V_SJGS_DM||')
                                                                            AND T.DMLB_ID=1';--数据元类型名称
              EXECUTE IMMEDIATE JCSJYLX INTO V_JCSJYLX;
              JCSJYCD :=  'SELECT  CD             FROM T_JCSJY            WHERE ID='||JCSJY_ID||'';--数据元长度
              EXECUTE IMMEDIATE JCSJYCD INTO V_JCSJYCD;

              ---------如果是DATA类型，长度为NULL，赋值为0
              IF V_JCSJYCD IS NULL THEN
                 V_JCSJYCD :=0;
              END IF;

              MBZDLX  :=  'SELECT  DATA_TYPE      FROM T_META_COLUMN      WHERE ID='||COL_ID||'';--目标字段类型
              EXECUTE IMMEDIATE MBZDLX INTO V_MBZDLX;
              MBZDLXDM:=  'SELECT  T.DMMC         FROM (SELECT * FROM T_DMLB A,T_DMLB_GGDM B WHERE A.DMLBMC=''数据格式'') T
                                                                            WHERE T.DMBH=('||V_SJGS_DM||')
                                                                            AND T.DMLB_ID=1';--规范表目标字段类型
              EXECUTE IMMEDIATE MBZDLXDM INTO V_MBZDLXDM;
              ---------如果目标字段类型为DATA，赋值长度为null
              IF V_MBZDLX='DATE' THEN
                 V_MBZDCD :=0;
              ELSIF V_MBZDLX !='DATA' THEN
              MBZDCD  :=  'SELECT  DATA_LENGTH    FROM T_META_COLUMN      WHERE ID='||COL_ID||'';--目标字段长度
              EXECUTE IMMEDIATE MBZDCD INTO V_MBZDCD;
              END IF;
              EXIT WHEN BZGF_JYPZ%NOTFOUND;
              ---------如果字段类型为number，判断是否有小数位
              XSWSCD  :=  'SELECT  XSWS           FROM T_JCSJY            WHERE ID='||JCSJY_ID||'';--数据元小数长度
              EXECUTE IMMEDIATE XSWSCD INTO V_XSWSCD;
              MBXSWSCD  :=  'SELECT  DATA_SCALE    FROM T_META_COLUMN      WHERE ID='||COL_ID||'';--目标字段小数长度
              EXECUTE IMMEDIATE MBXSWSCD INTO V_MBXSWSCD;
              IF V_MBXSWSCD IS NULL THEN
                 V_MBXSWSCD :=0;
              END IF;



              /*******标准规范校验规则表循环********/

              BEGIN
               OPEN BZGF_JYGZ;
                LOOP
                  fetch BZGF_JYGZ into GZ;
                  JYGZ   :=GZ.JYGZ;
                  CDJYGZ :=GZ.CDJYGZ;
                  exit when BZGF_JYGZ%NOTFOUND;

                  BEGIN

                      IF JYGZ=1 THEN  --1表示类型需要校验
                         IF V_MBZDLX = V_JCSJYLX
                         THEN V_LXHGBS :='1';
                         ELSE V_LXHGBS :='0';
                         END IF;
                      ELSIF JYGZ=2 THEN  --2表示长度需要校验
                         IF CDJYGZ=1 THEN
                             IF TO_NUMBER(V_MBZDCD)-TO_NUMBER(V_MBXSWSCD) < TO_NUMBER(V_JCSJYCD)-TO_NUMBER(V_XSWSCD) AND TO_NUMBER(V_MBXSWSCD) >= TO_NUMBER(V_XSWSCD)
                             THEN V_CDHGBS :='1';
                             ELSE V_CDHGBS :='0';
                             END IF;
                         ELSIF CDJYGZ=2 THEN
                             IF TO_NUMBER(V_MBZDCD)-TO_NUMBER(V_MBXSWSCD) <= TO_NUMBER(V_JCSJYCD)-TO_NUMBER(V_XSWSCD) AND TO_NUMBER(V_MBXSWSCD) >= TO_NUMBER(V_XSWSCD)
                             THEN V_CDHGBS :='1';
                             ELSE V_CDHGBS :='0';
                             END IF;
                         ELSIF CDJYGZ=3 THEN
                             IF TO_NUMBER(V_MBZDCD)-TO_NUMBER(V_MBXSWSCD) = TO_NUMBER(V_JCSJYCD)-TO_NUMBER(V_XSWSCD) AND TO_NUMBER(V_MBXSWSCD) >= TO_NUMBER(V_XSWSCD)
                             THEN V_CDHGBS :='1';
                             ELSE V_CDHGBS :='0';
                             END IF;
                         ELSIF CDJYGZ=4 THEN
                             IF TO_NUMBER(V_MBZDCD)-TO_NUMBER(V_MBXSWSCD) > TO_NUMBER(V_JCSJYCD)-TO_NUMBER(V_XSWSCD) AND TO_NUMBER(V_MBXSWSCD) >= TO_NUMBER(V_XSWSCD)
                             THEN V_CDHGBS :='1';
                             ELSE V_CDHGBS :='0';
                             END IF;
                         ELSIF CDJYGZ=5 THEN
                             IF TO_NUMBER(V_MBZDCD)-TO_NUMBER(V_MBXSWSCD) >= TO_NUMBER(V_JCSJYCD)-TO_NUMBER(V_XSWSCD) AND TO_NUMBER(V_MBXSWSCD) >= TO_NUMBER(V_XSWSCD)
                             THEN V_CDHGBS :='1';
                             ELSE V_CDHGBS :='0';
                             END IF;
                         END IF;
                      END IF;

                   END;
                  END LOOP;
                 CLOSE BZGF_JYGZ;
                 COMMIT;
                END;
              -----------DATE类型的字段长度插入时赋值为null
              IF V_MBZDLX='DATE' AND V_MBZDCD =0 THEN
                 V_MBZDCD :=NULL;
              -----------如果目标字段为number，并且小数位不为null
              ELSIF V_MBZDLX='NUMBER' AND V_MBXSWSCD !=0 THEN
                 V_MBZDCD :='(' || V_MBZDCD || ',' || V_MBXSWSCD || ')';
              ELSIF V_MBZDLX='NUMBER' AND V_MBXSWSCD =0 THEN
                 V_MBZDCD :=V_MBZDCD;
              END IF;
              IF V_MBZDLXDM='日期型(DATE)' AND V_JCSJYCD=0 THEN
                 V_JCSJYCD :=NULL;
              -----------如果规范字段为number，并且小数位不为null
              ELSIF V_MBZDLXDM='数值型(NUMBER)' AND V_XSWSCD !=0 THEN
                 V_JCSJYCD :='(' || V_JCSJYCD || ',' || V_XSWSCD || ')';
              ELSIF V_MBZDLXDM='数值型(NUMBER)' AND V_XSWSCD =0 THEN
                 V_JCSJYCD :=V_JCSJYCD;
              END IF;

              INSERT INTO T_BZGF_JYXQ(ID,BZGF_JYJG_ID,BZGFMC,SJYFLMC,JCSJYMC,MBSJYMC,MBBMC,MBZDMC,LXHGBS,CDHGBS,JCSJYLX,JCSJYCD,MBZDLX,MBZDCD,MBZDBZ,JYSJ,JCSJYDM)
              VALUES (SEQ_BZGF_JYXQ_ID.NEXTVAL,JYJG_ID,V_BZGFMC,V_SJYFLMC,V_JCSJYMC,V_MBSJYMC,V_MBBMC,V_MBZDMC,V_LXHGBS,V_CDHGBS,V_MBZDLXDM,V_JCSJYCD,V_MBZDLX,V_MBZDCD,V_MBZDBZ,DATATIME,V_JCSJYDM);
              COMMIT;




            OPEN BZGF_JYGZ;
            LOOP
              FETCH BZGF_JYGZ INTO GZ;
              JYGZ :=GZ.JYGZ;
              EXIT WHEN BZGF_JYGZ%NOTFOUND;

              IF JYGZ=1 THEN

                  A_LXHGBS :='SELECT COUNT(*)  FROM (SELECT * FROM T_BZGF_JYXQ Y WHERE Y.LXHGBS=1 AND Y.BZGF_JYJG_ID='||JYJG_ID||')';
                  execute immediate A_LXHGBS INTO Y_LXHGBS;
                  B_LXHGBS :='SELECT COUNT(*)  FROM (SELECT * FROM T_BZGF_JYXQ N WHERE N.LXHGBS=0 AND N.BZGF_JYJG_ID='||JYJG_ID||')';
                  execute immediate B_LXHGBS INTO N_LXHGBS;
                  A_QZ    :='SELECT QZ   FROM T_BZGF_JYGZ WHERE JYGZ=1';
                  execute immediate A_QZ INTO V1_QZ;
                  JG_LXHGBS := Y_LXHGBS/(Y_LXHGBS+N_LXHGBS);

              ELSIF JYGZ=2 THEN
                  A_CDHGBS :='SELECT COUNT(*)  FROM (SELECT * FROM T_BZGF_JYXQ Y WHERE Y.CDHGBS=1 AND Y.BZGF_JYJG_ID='||JYJG_ID||')';
                  execute immediate A_CDHGBS INTO Y_CDHGBS;
                  B_CDHGBS :='SELECT COUNT(*)  FROM (SELECT * FROM T_BZGF_JYXQ N WHERE N.CDHGBS=0 AND N.BZGF_JYJG_ID='||JYJG_ID||')';
                  execute immediate B_CDHGBS INTO N_CDHGBS;
                  B_QZ    :='SELECT QZ   FROM T_BZGF_JYGZ WHERE JYGZ=2';
                  execute immediate B_QZ INTO V2_QZ;
                  JG_CDHGBS := Y_CDHGBS/(Y_CDHGBS+N_CDHGBS);
             END IF;



            END LOOP;
             CLOSE BZGF_JYGZ;
             COMMIT;

            IF JG_LXHGBS IS NULL
             THEN JG_LXHGBS :=0;
            END IF;
            IF V1_QZ IS NULL
             THEN V1_QZ :=0;
            END IF;
            IF JG_CDHGBS IS NULL
             THEN JG_CDHGBS :=0;
            END IF;
            IF V2_QZ IS NULL
             THEN V2_QZ :=0;
            END IF;

            JG_ZHGL   := JG_LXHGBS*V1_QZ+JG_CDHGBS*V2_QZ;
            HGLFZ     :='SELECT QJHGL FROM T_BZGF_JYGZ WHERE ROWNUM<2';
            execute immediate HGLFZ INTO HG_HGLFZ;


            UPDATE T_BZGF_JYJG T1
            SET LXHGL=JG_LXHGBS*100,CDHGL=JG_CDHGBS*100,ZHGL=JG_ZHGL,JYRQ=DATATIME,LXQZ=V1_QZ,CDQZ=V2_QZ,HGLFZ=HG_HGLFZ
            WHERE T1.ID=JYJG_ID;

        END IF;


        END LOOP;
        COMMIT;
        END;

    END LOOP;
    CLOSE BZGF_JY;
    COMMIT;
  END;

ELSIF BZGF_CS_ID IS NOT NULL
THEN

BEGIN
/*******标准规范校验表循环********/

   JY_ID   := BZGF_CS_ID;
   SELECT SEQ_BZGF_JYJG_ID.NEXTVAL INTO JYJG_ID FROM DUAL;
   --JYJG_ID := SEQ_BZGF_JYJG_ID.NEXTVAL;


   begin
   INSERT INTO T_BZGF_JYJG(ID,BZGF_JY_ID)
   VALUES (JYJG_ID,JY_ID);
   end;
   commit;



      BEGIN
      /********标准规范校验表循环*******/

      FOR PZ IN BZGF_JYPZ(JY_ID)
     LOOP

    JYPZ_NUM := 'SELECT COUNT(*) FROM T_BZGF_JYPZ WHERE BZGF_JY_ID='||JY_ID||'';
    execute immediate JYPZ_NUM INTO V_JYPZ_NUM;

    IF V_JYPZ_NUM>0 THEN

          BZGF_ID  := PZ.BZGF_ID;----标准规范ID
          SJYFL_ID := PZ.SJYFL_ID;----数据元分类ID
          JCSJY_ID := PZ.JCSJY_ID;----基础数据元ID
          DS_ID    := PZ.DS_ID;----目标数据源ID
          TBL_ID   := PZ.TBL_ID;----目标表ID
          COL_ID   := PZ.COL_ID;----目标字段ID


          BZGFMC  :=  'SELECT  BZGFMC         FROM T_BZGF             WHERE ID='||BZGF_ID||'';--标准规范名称
          execute immediate BZGFMC INTO V_BZGFMC;
          SJYFLMC :=  'SELECT  SJYFLMC        FROM T_SJYFL            WHERE ID='||SJYFL_ID||'';--数据元分类名称
          execute immediate SJYFLMC INTO V_SJYFLMC;
          JCSJYMC :=  'SELECT  SJYMC          FROM T_JCSJY            WHERE ID='||JCSJY_ID||'';--基础数据元名称
          execute immediate JCSJYMC INTO V_JCSJYMC;
          MBSJYMC :=  'SELECT  DS_NAME        FROM T_META_DATASOURCE  WHERE DS_ID='||DS_ID||' AND STAT= 1';--目标数据源名称
          execute immediate MBSJYMC INTO V_MBSJYMC;
          MBBMC   :=  'SELECT  TBL_NAME       FROM T_META_TABLE       WHERE TBL_ID='||TBL_ID||'';--目标表名称
          execute immediate MBBMC INTO V_MBBMC;
          MBZDMC  :=  'SELECT  COL_NAME       FROM T_META_COLUMN      WHERE ID='||COL_ID||'';--目标字段名称
          execute immediate MBZDMC INTO V_MBZDMC;
          MBZDBZ  :=  'SELECT  REMARK         FROM T_META_COLUMN      WHERE ID='||COL_ID||'';--木表字段备注
          execute immediate MBZDBZ INTO V_MBZDBZ;
          SJGS_DM :=  'SELECT  SJGS           FROM T_JCSJY            WHERE ID='||JCSJY_ID||'';--数据元类型代码
          execute immediate SJGS_DM INTO V_SJGS_DM;
          JCSJYLX :=  'SELECT  T.DMBZ         FROM (SELECT * FROM T_DMLB A,T_DMLB_GGDM B WHERE A.DMLBMC=''数据格式'') T
                                                                        WHERE T.DMBH=('||V_SJGS_DM||')
                                                                        AND T.DMLB_ID=1';--数据元类型名称
          execute immediate JCSJYLX INTO V_JCSJYLX;
          JCSJYCD :=  'SELECT  CD             FROM T_JCSJY            WHERE ID='||JCSJY_ID||'';--数据元长度
          execute immediate JCSJYCD INTO V_JCSJYCD;
          ---------如果是DATA类型，长度为NULL，赋值为0
          IF V_JCSJYCD IS NULL THEN
             V_JCSJYCD :=0;
          END IF;

          MBZDLX  :=  'SELECT  DATA_TYPE      FROM T_META_COLUMN      WHERE ID='||COL_ID||'';--目标字段类型
          execute immediate MBZDLX INTO V_MBZDLX;
          MBZDLXDM:=  'SELECT  T.DMMC         FROM (SELECT * FROM T_DMLB A,T_DMLB_GGDM B WHERE A.DMLBMC=''数据格式'') T
                                                                        WHERE T.DMBH=('||V_SJGS_DM||')
                                                                        AND T.DMLB_ID=1';--规范表目标字段类型
          execute immediate MBZDLXDM INTO V_MBZDLXDM;
          ---------如果目标字段类型为DATA，赋值长度为null
          IF V_MBZDLX='DATE' THEN
             V_MBZDCD :=0;
          ELSIF V_MBZDLX !='DATA' THEN
          MBZDCD  :=  'SELECT  DATA_LENGTH    FROM T_META_COLUMN      WHERE ID='||COL_ID||'';--目标字段长度
          EXECUTE IMMEDIATE MBZDCD INTO V_MBZDCD;
          END IF;
          exit when BZGF_JYPZ%NOTFOUND;
          ---------如果字段类型为number，判断是否有小数位
          XSWSCD  :=  'SELECT  XSWS           FROM T_JCSJY            WHERE ID='||JCSJY_ID||'';--数据元小数长度
          EXECUTE IMMEDIATE XSWSCD INTO V_XSWSCD;
          MBXSWSCD  :=  'SELECT  DATA_SCALE    FROM T_META_COLUMN      WHERE ID='||COL_ID||'';--目标字段小数长度
          EXECUTE IMMEDIATE MBXSWSCD INTO V_MBXSWSCD;
          IF V_MBXSWSCD IS NULL THEN
             V_MBXSWSCD :=0;
          END IF;



          /*******标准规范校验规则表循环********/

          BEGIN
           OPEN BZGF_JYGZ;
            LOOP
              FETCH BZGF_JYGZ INTO GZ;
              JYGZ   :=GZ.JYGZ;
              CDJYGZ :=GZ.CDJYGZ;
              EXIT WHEN BZGF_JYGZ%NOTFOUND;

              BEGIN

                  IF JYGZ=1 THEN  --1表示类型需要校验
                         IF V_MBZDLX = V_JCSJYLX
                         THEN V_LXHGBS :='1';
                         ELSE V_LXHGBS :='0';
                         END IF;
                  ELSIF JYGZ=2 THEN  --2表示长度需要校验
                     IF CDJYGZ=1 THEN
                         IF TO_NUMBER(V_MBZDCD)-TO_NUMBER(V_MBXSWSCD) < TO_NUMBER(V_JCSJYCD)-TO_NUMBER(V_XSWSCD) AND TO_NUMBER(V_MBXSWSCD) >= TO_NUMBER(V_XSWSCD)
                         THEN V_CDHGBS :='1';
                         ELSE V_CDHGBS :='0';
                         END IF;
                     ELSIF CDJYGZ=2 THEN
                         IF TO_NUMBER(V_MBZDCD)-TO_NUMBER(V_MBXSWSCD) <= TO_NUMBER(V_JCSJYCD)-TO_NUMBER(V_XSWSCD) AND TO_NUMBER(V_MBXSWSCD) >= TO_NUMBER(V_XSWSCD)
                         THEN V_CDHGBS :='1';
                         ELSE V_CDHGBS :='0';
                         END IF;
                     ELSIF CDJYGZ=3 THEN
                         IF TO_NUMBER(V_MBZDCD)-TO_NUMBER(V_MBXSWSCD) = TO_NUMBER(V_JCSJYCD)-TO_NUMBER(V_XSWSCD) AND TO_NUMBER(V_MBXSWSCD) >= TO_NUMBER(V_XSWSCD)
                         THEN V_CDHGBS :='1';
                         ELSE V_CDHGBS :='0';
                         END IF;
                     ELSIF CDJYGZ=4 THEN
                         IF TO_NUMBER(V_MBZDCD)-TO_NUMBER(V_MBXSWSCD) > TO_NUMBER(V_JCSJYCD)-TO_NUMBER(V_XSWSCD) AND TO_NUMBER(V_MBXSWSCD) >= TO_NUMBER(V_XSWSCD)
                         THEN V_CDHGBS :='1';
                         ELSE V_CDHGBS :='0';
                         END IF;
                     ELSIF CDJYGZ=5 THEN
                         IF TO_NUMBER(V_MBZDCD)-TO_NUMBER(V_MBXSWSCD) >= TO_NUMBER(V_JCSJYCD)-TO_NUMBER(V_XSWSCD) AND TO_NUMBER(V_MBXSWSCD) >= TO_NUMBER(V_XSWSCD)
                         THEN V_CDHGBS :='1';
                         ELSE V_CDHGBS :='0';
                         END IF;
                     END IF;
                  END IF;

               END;
              END LOOP;
             CLOSE BZGF_JYGZ;
             COMMIT;
            END;
          -----------DATE类型的字段长度插入时赋值为null
          IF V_MBZDLX='DATE' AND V_MBZDCD =0 THEN
             V_MBZDCD :=NULL;
          -----------如果目标字段为number，并且小数位不为null
          ELSIF V_MBZDLX='NUMBER' AND V_MBXSWSCD !=0 THEN
             V_MBZDCD :='(' || V_MBZDCD || ',' || V_MBXSWSCD || ')';
          ELSIF V_MBZDLX='NUMBER' AND V_MBXSWSCD =0 THEN
             V_MBZDCD :=V_MBZDCD;
          END IF;
          IF V_MBZDLXDM='日期型(DATE)' AND V_JCSJYCD=0 THEN
             V_JCSJYCD :=NULL;
          -----------如果规范字段为number，并且小数位不为null
          ELSIF V_MBZDLXDM='数值型(NUMBER)' AND V_XSWSCD !=0 THEN
             V_JCSJYCD :='(' || V_JCSJYCD || ',' || V_XSWSCD || ')';
          ELSIF V_MBZDLXDM='数值型(NUMBER)' AND V_XSWSCD =0 THEN
             V_JCSJYCD :=V_JCSJYCD;
          END IF;

          INSERT INTO T_BZGF_JYXQ(ID,BZGF_JYJG_ID,BZGFMC,SJYFLMC,JCSJYMC,MBSJYMC,MBBMC,MBZDMC,LXHGBS,CDHGBS,JCSJYLX,JCSJYCD,MBZDLX,MBZDCD,MBZDBZ,JYSJ)
          VALUES (SEQ_BZGF_JYXQ_ID.NEXTVAL,JYJG_ID,V_BZGFMC,V_SJYFLMC,V_JCSJYMC,V_MBSJYMC,V_MBBMC,V_MBZDMC,V_LXHGBS,V_CDHGBS,V_MBZDLXDM,V_JCSJYCD,V_MBZDLX,V_MBZDCD,V_MBZDBZ,DATATIME);
          COMMIT;




        OPEN BZGF_JYGZ;
        LOOP
          fetch BZGF_JYGZ into GZ;
          JYGZ :=GZ.JYGZ;
          exit when BZGF_JYGZ%NOTFOUND;

          IF JYGZ=1 THEN

              A_LXHGBS :='SELECT COUNT(*)  FROM (SELECT * FROM T_BZGF_JYXQ Y WHERE Y.LXHGBS=1 AND Y.BZGF_JYJG_ID='||JYJG_ID||')';
              EXECUTE IMMEDIATE A_LXHGBS INTO Y_LXHGBS;
              B_LXHGBS :='SELECT COUNT(*)  FROM (SELECT * FROM T_BZGF_JYXQ N WHERE N.LXHGBS=0 AND N.BZGF_JYJG_ID='||JYJG_ID||')';
              EXECUTE IMMEDIATE B_LXHGBS INTO N_LXHGBS;
              A_QZ    :='SELECT QZ   FROM T_BZGF_JYGZ WHERE JYGZ=1';
              EXECUTE IMMEDIATE A_QZ INTO V1_QZ;
              JG_LXHGBS := Y_LXHGBS/(Y_LXHGBS+N_LXHGBS);

          ELSIF JYGZ=2 THEN
              A_CDHGBS :='SELECT COUNT(*)  FROM (SELECT * FROM T_BZGF_JYXQ Y WHERE Y.CDHGBS=1 AND Y.BZGF_JYJG_ID='||JYJG_ID||')';
              EXECUTE IMMEDIATE A_CDHGBS INTO Y_CDHGBS;
              B_CDHGBS :='SELECT COUNT(*)  FROM (SELECT * FROM T_BZGF_JYXQ N WHERE N.CDHGBS=0 AND N.BZGF_JYJG_ID='||JYJG_ID||')';
              EXECUTE IMMEDIATE B_CDHGBS INTO N_CDHGBS;
              B_QZ    :='SELECT QZ   FROM T_BZGF_JYGZ WHERE JYGZ=2';
              EXECUTE IMMEDIATE B_QZ INTO V2_QZ;
              JG_CDHGBS := Y_CDHGBS/(Y_CDHGBS+N_CDHGBS);
         END IF;



        END LOOP;
         CLOSE BZGF_JYGZ;
         COMMIT;

        IF JG_LXHGBS IS NULL
         THEN JG_LXHGBS :=0;
        END IF;
        IF V1_QZ IS NULL
         THEN V1_QZ :=0;
        END IF;
        IF JG_CDHGBS IS NULL
         THEN JG_CDHGBS :=0;
        END IF;
        IF V2_QZ IS NULL
         THEN V2_QZ :=0;
        END IF;


        JG_ZHGL   := JG_LXHGBS*V1_QZ+JG_CDHGBS*V2_QZ;
        HGLFZ     :='SELECT QJHGL FROM T_BZGF_JYGZ WHERE ROWNUM<2';
        execute immediate HGLFZ INTO HG_HGLFZ;


        UPDATE T_BZGF_JYJG T1
        SET LXHGL=JG_LXHGBS*100,CDHGL=JG_CDHGBS*100,ZHGL=JG_ZHGL,JYRQ=DATATIME,LXQZ=V1_QZ,CDQZ=V2_QZ,HGLFZ=HG_HGLFZ
        WHERE T1.ID=JYJG_ID;

    END IF;


    END LOOP;
    COMMIT;
    END;


END;

END IF;
COMMIT;
END;
/


CREATE OR REPLACE PROCEDURE PRC_BZGF_ZDPZ_JY(DS_ID VARCHAR2,CS_ID VARCHAR2) AS
--------标准规范校验_自动配置

JYGZ        CHAR(1);
CDJYGZ      CHAR(1);
JYJG_ID     INTEGER;
BZGFMC      VARCHAR2(2000);
SJYFLMC     VARCHAR2(2000);
JCSJYMC     VARCHAR2(2000);
MBSJYMC     VARCHAR2(2000);
MBBMC       VARCHAR2(2000);
MBZDMC      VARCHAR2(2000);
LXHGBS      VARCHAR2(2000);
CDHGBS      VARCHAR2(2000);
JCSJYLX     VARCHAR2(2000);
JCSJYCD     VARCHAR2(2000);
MBZDLX      VARCHAR2(2000);
MBZDCD      VARCHAR2(2000);
A_LXHGBS    VARCHAR2(2000);
B_LXHGBS    VARCHAR2(2000);
A_CDHGBS    VARCHAR2(2000);
B_CDHGBS    VARCHAR2(2000);
A_QZ        VARCHAR2(2000);
B_QZ        VARCHAR2(2000);
V_LXHGBS    VARCHAR2(2000);
V_CDHGBS    VARCHAR2(2000);
V_JCSJYLX   VARCHAR2(2000);
V_JCSJYCD   VARCHAR2(2000);
V_MBZDLX    VARCHAR2(2000);
V_MBZDCD    VARCHAR2(2000);
Y_LXHGBS    VARCHAR2(2000);
N_LXHGBS    VARCHAR2(2000);
Y_CDHGBS    VARCHAR2(2000);
N_CDHGBS    VARCHAR2(2000);
V1_QZ       VARCHAR2(2000);
V2_QZ       VARCHAR2(2000);
JG_LXHGBS   VARCHAR2(2000);
JG_CDHGBS   VARCHAR2(2000);
JG_ZHGL     VARCHAR2(2000);
DATATIME    DATE;
HGLFZ       VARCHAR2(2000);
HG_HGLFZ    VARCHAR2(2000);
V_XSWSCD    VARCHAR2(2000);
V_MBXSWSCD  VARCHAR2(2000);
BZGF_ZDPZ_JYXQ_ID  VARCHAR2(2000);
BANBENHAO   VARCHAR2(2000);
CSID        VARCHAR2(2000);
SQL1        VARCHAR2(4000);
--SQL2        VARCHAR2(4000);
SQL3        VARCHAR2(4000);
PZ_NUM      VARCHAR2(4000);
V_BZGFMC    VARCHAR2(4000);
VBZGFMC     VARCHAR2(4000);
BZGFID      VARCHAR2(4000);
V_VBZGFMC   VARCHAR2(4000);
VERSION     VARCHAR2(4000);
ZDPPGZ      VARCHAR2(4000);
MBBMS       VARCHAR2(4000);
MBZDBZ      VARCHAR2(4000);
MBZDXSWS    VARCHAR2(4000);
--JYXQ_ID     VARCHAR2(4000);
JCSJYXSWS   VARCHAR2(4000);
JCSJYDM     VARCHAR2(4000);
SJYFLID     VARCHAR2(4000);
JCSJYID     VARCHAR2(4000);
/***********游标*********/


CURSOR BZGF_JYGZ IS
  SELECT ID,JYGZ,QZ,QJHGL,CDJYGZ,ZDPPGZ FROM T_BZGF_JYGZ;
GZ BZGF_JYGZ%ROWTYPE;
-------标准规范校验规则表

CURSOR ZDPZ_BZGF_JYXQ(BANBENHAO VARCHAR2) IS
  SELECT ID,BZGFMC,SJYFLMC,JCSJYMC,MBSJYMC,MBBMC,MBZDMC,LXHGBS,CDHGBS,JCSJYLX,JCSJYCD,MBZDLX,MBZDCD,MBZDBZ,JCSJYXSWS,MBZDXSWS
  FROM T_ZDPZ_BZGF_JYXQ WHERE VERSION=BANBENHAO;
 XQ ZDPZ_BZGF_JYXQ%ROWTYPE;
-------标准规范校验详情

CURSOR BZGF(CS_ID VARCHAR2) IS
with temp0 as (select LEVEL lv from dual CONNECT BY LEVEL <= 100)
select id,substr(t.vals,instr(t.vals, ',', 1, tv.lv) + 1,
                instr(t.vals, ',', 1, tv.lv + 1) -(instr(t.vals, ',', 1, tv.lv) + 1)) AS GF
from (select id,',' || bzgf_id || ',' AS vals,
      length(bzgf_id || ',') - nvl(length(REPLACE(bzgf_id, ',')), 0) AS cnt
       from t_zdpz_bzgf_jy where id=CS_ID) t join temp0 tv  on  tv.lv <= t.cnt;
 GF BZGF%ROWTYPE;
-------分割标准规范ID

CURSOR KBSJ(BANBENHAO VARCHAR2) IS
SELECT A.COL_NAME,A.REMARK,A.DATA_TYPE,A.DATA_LENGTH,A.TBL_ID,A.DATA_SCALE,B.TBL_NAME,B.TBL_DETAIL,C.DS_NAME
FROM T_META_COLUMN A,T_META_TABLE B,T_META_DATASOURCE C
WHERE A.TBL_ID = B.TBL_ID
AND B.DS_VERSION=C.VERSION
AND C.VERSION=BANBENHAO;
KB KBSJ%ROWTYPE;
-------库表同步数据

CURSOR BZGFSJ(BZGFID VARCHAR2) IS
SELECT A.ID,A.SJYFL_ID,A.SJYMC,D.DMBZ,A.CD,A.XSWS,C.BZGFMC,B.SJYFLMC,A.SJYDM
FROM T_JCSJY A,T_SJYFL B,T_BZGF C,T_DMLB_GGDM D
WHERE A.SJYFL_ID=B.ID
AND B.BZGF_ID=C.ID
AND D.DMBH=A.SJGS
AND D.DMLB_ID=1
AND C.ID =BZGFID;
GFSJ BZGFSJ%ROWTYPE;
-------标准规范数据



BEGIN

BEGIN
PRC_KBTB(DS_ID,VERSION);
DBMS_OUTPUT.put_line(VERSION);
END;

DATATIME :=SYSDATE;
BANBENHAO :=VERSION;
SELECT SEQ_BZGF_ZDPZ_JYJG_ID.NEXTVAL INTO JYJG_ID FROM DUAL;
SELECT BZGF_ID INTO CSID  FROM T_ZDPZ_BZGF_JY WHERE ID=CS_ID;

-------插入匹配字段
BEGIN

<<BZGF_JYGZ_LOOP>>
FOR GZ IN BZGF_JYGZ
LOOP
ZDPPGZ  :=GZ.ZDPPGZ;
CDJYGZ  :=GZ.CDJYGZ;
EXIT WHEN BZGF_JYGZ%NOTFOUND;
IF ZDPPGZ='1' THEN ----CODE匹配

<<KBSJ_LOOP>>
FOR KB IN KBSJ(BANBENHAO)
LOOP
MBSJYMC    :=KB.DS_NAME;
MBBMC      :=KB.TBL_NAME;
MBBMS      :=KB.TBL_DETAIL;
MBZDMC     :=KB.COL_NAME;
MBZDLX     :=KB.DATA_TYPE;
MBZDCD     :=KB.DATA_LENGTH;
MBZDBZ     :=KB.REMARK;
MBZDXSWS   :=KB.DATA_SCALE;
EXIT WHEN KBSJ%NOTFOUND;

   <<BZGF_LOOP>>
   FOR GF IN BZGF(CS_ID)
   LOOP
   BZGFID :=GF.GF;
   EXIT WHEN BZGF%NOTFOUND;
         <<BZGFSJ_LOOP>>
         FOR GFSJ IN BZGFSJ(BZGFID)
         LOOP
         BZGFMC     :=GFSJ.BZGFMC;
         SJYFLMC    :=GFSJ.SJYFLMC;
         JCSJYMC    :=GFSJ.SJYMC;
         JCSJYLX    :=GFSJ.DMBZ;
         JCSJYCD    :=GFSJ.CD;
         JCSJYXSWS  :=GFSJ.XSWS;
         JCSJYDM    :=GFSJ.SJYDM;
         SJYFLID    :=GFSJ.SJYFL_ID;
         JCSJYID    :=GFSJ.ID;
         EXIT WHEN BZGFSJ%NOTFOUND;

         IF MBZDMC = JCSJYDM THEN 
            INSERT INTO T_ZDPZ_BZGF_JYXQ(ID,ZDPZ_BZGF_JYJG_ID,BZGFMC,SJYFLMC,JCSJYMC,MBSJYMC,MBBMC,MBBMS,MBZDMC,LXHGBS,CDHGBS,JCSJYLX,JCSJYCD,MBZDLX,MBZDCD,MBZDBZ,JYSJ,JCSJYXSWS,MBZDXSWS,VERSION,JCSJYDM,SJYFL_ID,JCSJY_ID)
            VALUES(SEQ_BZGF_ZDPZ_JYXQ_ID.NEXTVAL,JYJG_ID,BZGFMC,SJYFLMC,JCSJYMC,MBSJYMC,MBBMC,MBBMS,MBZDMC,NULL,NULL,JCSJYLX,JCSJYCD,MBZDLX,MBZDCD,MBZDBZ,DATATIME,JCSJYXSWS,MBZDXSWS,BANBENHAO,JCSJYDM,SJYFLID,JCSJYID);
            COMMIT;
         --EXIT BZGFSJ_LOOP;
         EXIT BZGF_LOOP;
         --EXIT BZGF_JYGZ_LOOP;
         --EXIT KBSJ_LOOP;
         END IF;
         END LOOP;
   END LOOP;
END LOOP;
-------插入未匹配字段
SQL1  :=   'INSERT INTO T_ZDPZ_BZGF_WPP(ID,ZDPZ_BZGF_JYJG_ID,TBL_NAME,COL_NAME,COL_REMARK,COL_TYPE,COL_LENGTH,COL_SCALE,VERSION)
            SELECT SEQ_BZGF_ZDPZ_JYXQ_ID.NEXTVAL,'||JYJG_ID||',B.TBL_NAME,A.COL_NAME,A.REMARK,A.DATA_TYPE,A.DATA_LENGTH,A.DATA_SCALE,'''||BANBENHAO||'''
            FROM T_META_COLUMN A,T_META_TABLE B,T_META_DATASOURCE C
            WHERE A.TBL_ID = B.TBL_ID
            AND B.DS_VERSION=C.VERSION
            AND C.VERSION='''||BANBENHAO||'''
            AND (A.COL_NAME IS NULL
              OR A.COL_NAME NOT IN (SELECT MBZDMC FROM T_ZDPZ_BZGF_JYXQ WHERE ZDPZ_BZGF_JYJG_ID='||JYJG_ID||'))';
EXECUTE IMMEDIATE SQL1;
COMMIT;
ELSIF ZDPPGZ='2' THEN ----名称匹配

<<KBSJ_LOOP>>
FOR KB IN KBSJ(BANBENHAO)
LOOP
MBSJYMC    :=KB.DS_NAME;
MBBMC      :=KB.TBL_NAME;
MBBMS      :=KB.TBL_DETAIL;
MBZDMC     :=KB.COL_NAME;
MBZDLX     :=KB.DATA_TYPE;
MBZDCD     :=KB.DATA_LENGTH;
MBZDBZ     :=KB.REMARK;
MBZDXSWS   :=KB.DATA_SCALE;
EXIT WHEN KBSJ%NOTFOUND;

   <<BZGF_LOOP>>
   FOR GF IN BZGF(CS_ID)
   LOOP
   BZGFID :=GF.GF;
   EXIT WHEN BZGF%NOTFOUND;
         <<BZGFSJ_LOOP>>
         FOR GFSJ IN BZGFSJ(BZGFID)
         LOOP
         BZGFMC     :=GFSJ.BZGFMC;
         SJYFLMC    :=GFSJ.SJYFLMC;
         JCSJYMC    :=GFSJ.SJYMC;
         JCSJYLX    :=GFSJ.DMBZ;
         JCSJYCD    :=GFSJ.CD;
         JCSJYXSWS  :=GFSJ.XSWS;
         JCSJYDM    :=GFSJ.SJYDM;
         SJYFLID    :=GFSJ.SJYFL_ID;
         JCSJYID    :=GFSJ.ID;
         EXIT WHEN BZGFSJ%NOTFOUND;

         IF MBZDBZ = JCSJYMC THEN 
            INSERT INTO T_ZDPZ_BZGF_JYXQ(ID,ZDPZ_BZGF_JYJG_ID,BZGFMC,SJYFLMC,JCSJYMC,MBSJYMC,MBBMC,MBBMS,MBZDMC,LXHGBS,CDHGBS,JCSJYLX,JCSJYCD,MBZDLX,MBZDCD,MBZDBZ,JYSJ,JCSJYXSWS,MBZDXSWS,VERSION,JCSJYDM,SJYFL_ID,JCSJY_ID)
            VALUES(SEQ_BZGF_ZDPZ_JYXQ_ID.NEXTVAL,JYJG_ID,BZGFMC,SJYFLMC,JCSJYMC,MBSJYMC,MBBMC,MBBMS,MBZDMC,NULL,NULL,JCSJYLX,JCSJYCD,MBZDLX,MBZDCD,MBZDBZ,DATATIME,JCSJYXSWS,MBZDXSWS,BANBENHAO,JCSJYDM,SJYFLID,JCSJYID);
            COMMIT;
         --EXIT BZGFSJ_LOOP;
         EXIT BZGF_LOOP;
         --EXIT BZGF_JYGZ_LOOP;
         --EXIT KBSJ_LOOP;
         END IF;
         END LOOP;
   END LOOP;
END LOOP;
-------插入未匹配字段
SQL1  :=   'INSERT INTO T_ZDPZ_BZGF_WPP(ID,ZDPZ_BZGF_JYJG_ID,TBL_NAME,COL_NAME,COL_REMARK,COL_TYPE,COL_LENGTH,COL_SCALE,VERSION)
            SELECT SEQ_BZGF_ZDPZ_JYXQ_ID.NEXTVAL,'||JYJG_ID||',B.TBL_NAME,A.COL_NAME,A.REMARK,A.DATA_TYPE,A.DATA_LENGTH,A.DATA_SCALE,'''||BANBENHAO||'''
            FROM T_META_COLUMN A,T_META_TABLE B,T_META_DATASOURCE C
            WHERE A.TBL_ID = B.TBL_ID
            AND B.DS_VERSION=C.VERSION
            AND C.VERSION='''||BANBENHAO||'''
            AND (A.REMARK IS NULL
              OR A.REMARK NOT IN (SELECT MBZDBZ FROM T_ZDPZ_BZGF_JYXQ WHERE ZDPZ_BZGF_JYJG_ID='||JYJG_ID||'))';
EXECUTE IMMEDIATE SQL1;
COMMIT;
ELSIF ZDPPGZ='3' THEN ----CODE和名称都匹配

<<KBSJ_LOOP>>
FOR KB IN KBSJ(BANBENHAO)
LOOP
MBSJYMC    :=KB.DS_NAME;
MBBMC      :=KB.TBL_NAME;
MBBMS      :=KB.TBL_DETAIL;
MBZDMC     :=KB.COL_NAME;
MBZDLX     :=KB.DATA_TYPE;
MBZDCD     :=KB.DATA_LENGTH;
MBZDBZ     :=KB.REMARK;
MBZDXSWS   :=KB.DATA_SCALE;
EXIT WHEN KBSJ%NOTFOUND;

   <<BZGF_LOOP>>
   FOR GF IN BZGF(CS_ID)
   LOOP
   BZGFID :=GF.GF;
   EXIT WHEN BZGF%NOTFOUND;
         <<BZGFSJ_LOOP>>
         FOR GFSJ IN BZGFSJ(BZGFID)
         LOOP
         BZGFMC     :=GFSJ.BZGFMC;
         SJYFLMC    :=GFSJ.SJYFLMC;
         JCSJYMC    :=GFSJ.SJYMC;
         JCSJYLX    :=GFSJ.DMBZ;
         JCSJYCD    :=GFSJ.CD;
         JCSJYXSWS  :=GFSJ.XSWS;
         JCSJYDM    :=GFSJ.SJYDM;
         SJYFLID    :=GFSJ.SJYFL_ID;
         JCSJYID    :=GFSJ.ID;
         EXIT WHEN BZGFSJ%NOTFOUND;

         IF MBZDBZ = JCSJYMC AND MBZDMC = JCSJYDM THEN 
            INSERT INTO T_ZDPZ_BZGF_JYXQ(ID,ZDPZ_BZGF_JYJG_ID,BZGFMC,SJYFLMC,JCSJYMC,MBSJYMC,MBBMC,MBBMS,MBZDMC,LXHGBS,CDHGBS,JCSJYLX,JCSJYCD,MBZDLX,MBZDCD,MBZDBZ,JYSJ,JCSJYXSWS,MBZDXSWS,VERSION,JCSJYDM,SJYFL_ID,JCSJY_ID)
            VALUES(SEQ_BZGF_ZDPZ_JYXQ_ID.NEXTVAL,JYJG_ID,BZGFMC,SJYFLMC,JCSJYMC,MBSJYMC,MBBMC,MBBMS,MBZDMC,NULL,NULL,JCSJYLX,JCSJYCD,MBZDLX,MBZDCD,MBZDBZ,DATATIME,JCSJYXSWS,MBZDXSWS,BANBENHAO,JCSJYDM,SJYFLID,JCSJYID);
            COMMIT;
         --EXIT BZGFSJ_LOOP;
         EXIT BZGF_LOOP;
         --EXIT BZGF_JYGZ_LOOP;
         --EXIT KBSJ_LOOP;
         END IF;
         END LOOP;
   END LOOP;
END LOOP;
-------插入未匹配字段
SQL1  :=   'INSERT INTO T_ZDPZ_BZGF_WPP(ID,ZDPZ_BZGF_JYJG_ID,TBL_NAME,COL_NAME,COL_REMARK,COL_TYPE,COL_LENGTH,COL_SCALE,VERSION)
            SELECT SEQ_BZGF_ZDPZ_JYXQ_ID.NEXTVAL,'||JYJG_ID||',B.TBL_NAME,A.COL_NAME,A.REMARK,A.DATA_TYPE,A.DATA_LENGTH,A.DATA_SCALE,'''||BANBENHAO||'''
            FROM T_META_COLUMN A,T_META_TABLE B,T_META_DATASOURCE C
            WHERE A.TBL_ID = B.TBL_ID
            AND B.DS_VERSION=C.VERSION
            AND C.VERSION='''||BANBENHAO||'''
            AND (A.REMARK NOT IN (SELECT MBZDBZ FROM T_ZDPZ_BZGF_JYXQ WHERE ZDPZ_BZGF_JYJG_ID='||JYJG_ID||')
              OR A.COL_NAME NOT IN (SELECT MBZDMC FROM T_ZDPZ_BZGF_JYXQ WHERE ZDPZ_BZGF_JYJG_ID='||JYJG_ID||')
              OR A.REMARK IS NULL
              OR A.COL_NAME IS NULL)';
EXECUTE IMMEDIATE SQL1;
COMMIT;
ELSIF ZDPPGZ='4' THEN ----CODE匹配或名称匹配

<<KBSJ_LOOP>>
FOR KB IN KBSJ(BANBENHAO)
LOOP
MBSJYMC    :=KB.DS_NAME;
MBBMC      :=KB.TBL_NAME;
MBBMS      :=KB.TBL_DETAIL;
MBZDMC     :=KB.COL_NAME;
MBZDLX     :=KB.DATA_TYPE;
MBZDCD     :=KB.DATA_LENGTH;
MBZDBZ     :=KB.REMARK;
MBZDXSWS   :=KB.DATA_SCALE;
EXIT WHEN KBSJ%NOTFOUND;

   <<BZGF_LOOP>>
   FOR GF IN BZGF(CS_ID)
   LOOP
   BZGFID :=GF.GF;
   EXIT WHEN BZGF%NOTFOUND;
         <<BZGFSJ_LOOP>>
         FOR GFSJ IN BZGFSJ(BZGFID)
         LOOP
         BZGFMC     :=GFSJ.BZGFMC;
         SJYFLMC    :=GFSJ.SJYFLMC;
         JCSJYMC    :=GFSJ.SJYMC;
         JCSJYLX    :=GFSJ.DMBZ;
         JCSJYCD    :=GFSJ.CD;
         JCSJYXSWS  :=GFSJ.XSWS;
         JCSJYDM    :=GFSJ.SJYDM;
         SJYFLID    :=GFSJ.SJYFL_ID;
         JCSJYID    :=GFSJ.ID;
         EXIT WHEN BZGFSJ%NOTFOUND;

         IF MBZDMC = JCSJYDM OR MBZDBZ = JCSJYMC THEN 
            INSERT INTO T_ZDPZ_BZGF_JYXQ(ID,ZDPZ_BZGF_JYJG_ID,BZGFMC,SJYFLMC,JCSJYMC,MBSJYMC,MBBMC,MBBMS,MBZDMC,LXHGBS,CDHGBS,JCSJYLX,JCSJYCD,MBZDLX,MBZDCD,MBZDBZ,JYSJ,JCSJYXSWS,MBZDXSWS,VERSION,JCSJYDM,SJYFL_ID,JCSJY_ID)
            VALUES(SEQ_BZGF_ZDPZ_JYXQ_ID.NEXTVAL,JYJG_ID,BZGFMC,SJYFLMC,JCSJYMC,MBSJYMC,MBBMC,MBBMS,MBZDMC,NULL,NULL,JCSJYLX,JCSJYCD,MBZDLX,MBZDCD,MBZDBZ,DATATIME,JCSJYXSWS,MBZDXSWS,BANBENHAO,JCSJYDM,SJYFLID,JCSJYID);
            COMMIT;
         --EXIT BZGFSJ_LOOP;
         EXIT BZGF_LOOP;
         --EXIT BZGF_JYGZ_LOOP;
         --EXIT KBSJ_LOOP;
         END IF;
         END LOOP;
   END LOOP;
END LOOP;
-------插入未匹配字段
SQL1  :=   'INSERT INTO T_ZDPZ_BZGF_WPP(ID,ZDPZ_BZGF_JYJG_ID,TBL_NAME,COL_NAME,COL_REMARK,COL_TYPE,COL_LENGTH,COL_SCALE,VERSION)
            SELECT SEQ_BZGF_ZDPZ_JYXQ_ID.NEXTVAL,'||JYJG_ID||',B.TBL_NAME,A.COL_NAME,A.REMARK,A.DATA_TYPE,A.DATA_LENGTH,A.DATA_SCALE,'''||BANBENHAO||'''
            FROM T_META_COLUMN A,T_META_TABLE B,T_META_DATASOURCE C
            WHERE A.TBL_ID = B.TBL_ID
            AND B.DS_VERSION=C.VERSION
            AND C.VERSION='''||BANBENHAO||'''
            AND (A.REMARK NOT IN (SELECT MBZDBZ FROM T_ZDPZ_BZGF_JYXQ WHERE ZDPZ_BZGF_JYJG_ID='||JYJG_ID||')
              OR A.REMARK IS NULL)
            AND (A.COL_NAME NOT IN (SELECT MBZDMC FROM T_ZDPZ_BZGF_JYXQ WHERE ZDPZ_BZGF_JYJG_ID='||JYJG_ID||')
              OR A.COL_NAME IS NULL)';
EXECUTE IMMEDIATE SQL1;
COMMIT;

END IF;
END LOOP;

----打开游标
FOR GF IN BZGF(CS_ID)
LOOP
BZGFID :=GF.GF;
EXIT WHEN BZGF%NOTFOUND;
VBZGFMC :='select BZGFMC FROM T_BZGF WHERE ID='||BZGFID||'';
EXECUTE IMMEDIATE VBZGFMC INTO V_VBZGFMC;
COMMIT;
V_BZGFMC :=V_BZGFMC||','||V_VBZGFMC;----拼接标准规范名称
END LOOP;
----插入标准规范校验表
SQL3  :='INSERT INTO T_ZDPZ_BZGF_JYJG(ID,ZDPZ_BZGF_JY_ID,VERSION,ZDPZ_BZGFMC,ZDPPGZ,CDJYGZ)
        SELECT '||JYJG_ID||',ID,'''||BANBENHAO||''' ,substr('''||V_BZGFMC||''',2),'||ZDPPGZ||','||CDJYGZ||'
        FROM T_ZDPZ_BZGF_JY
        WHERE ID='||CS_ID||'';
EXECUTE IMMEDIATE SQL3;
COMMIT;
END;
COMMIT;


-----查询是否有匹配数据
SELECT COUNT(*) INTO PZ_NUM FROM T_ZDPZ_BZGF_JYXQ WHERE VERSION=BANBENHAO;
-------如果有匹配数据
IF PZ_NUM !=0 THEN

          BEGIN
          /********匹配相同字段*******/

            FOR XQ IN ZDPZ_BZGF_JYXQ(BANBENHAO)
             LOOP
              V_JCSJYCD    :=XQ.JCSJYCD;----基础数据源长度
              V_MBZDLX     :=XQ.MBZDLX;----目标字段类型
              V_MBZDCD     :=XQ.MBZDCD;----目标字段长度
              V_MBXSWSCD   :=XQ.MBZDXSWS;----目标字段小数长度
              V_JCSJYLX    :=XQ.JCSJYLX;----基础数据源类型
              V_XSWSCD     :=XQ.JCSJYXSWS;----基础数据源小数长度
              BZGF_ZDPZ_JYXQ_ID :=XQ.ID;----校验详情ID
              EXIT WHEN ZDPZ_BZGF_JYXQ%NOTFOUND;


               ---------如果是DATA类型，长度为NULL，赋值为0
              IF V_JCSJYCD IS NULL THEN
                 V_JCSJYCD :=0;
              END IF;

              ---------如果目标字段类型为DATA，赋值长度为null
              IF V_MBZDLX='DATE' THEN
                 V_MBZDCD :=0;
              END IF;
              ---------如果字段类型为number，判断是否有小数位
              IF V_MBXSWSCD IS NULL THEN
                 V_MBXSWSCD :=0;
              END IF;
              IF V_XSWSCD IS NULL THEN
                 V_XSWSCD :=0;
              END IF;



              /*******标准规范校验规则表循环********/

              BEGIN
               OPEN BZGF_JYGZ;
                LOOP
                  fetch BZGF_JYGZ into GZ;
                  JYGZ   :=GZ.JYGZ;
                  CDJYGZ :=GZ.CDJYGZ;
                  exit when BZGF_JYGZ%NOTFOUND;

                  BEGIN

                      IF JYGZ=1 THEN  --1表示类型需要校验
                         IF V_MBZDLX = V_JCSJYLX
                         THEN V_LXHGBS :='1';
                         ELSE V_LXHGBS :='0';
                         END IF;
                      ELSIF JYGZ=2 THEN  --2表示长度需要校验
                         IF CDJYGZ=1 THEN
                             IF TO_NUMBER(V_MBZDCD)-TO_NUMBER(V_MBXSWSCD) < TO_NUMBER(V_JCSJYCD)-TO_NUMBER(V_XSWSCD) AND TO_NUMBER(V_MBXSWSCD) >= TO_NUMBER(V_XSWSCD)
                             THEN V_CDHGBS :='1';
                             ELSE V_CDHGBS :='0';
                             END IF;
                         ELSIF CDJYGZ=2 THEN
                             IF TO_NUMBER(V_MBZDCD)-TO_NUMBER(V_MBXSWSCD) <= TO_NUMBER(V_JCSJYCD)-TO_NUMBER(V_XSWSCD) AND TO_NUMBER(V_MBXSWSCD) >= TO_NUMBER(V_XSWSCD)
                             THEN V_CDHGBS :='1';
                             ELSE V_CDHGBS :='0';
                             END IF;
                         ELSIF CDJYGZ=3 THEN
                             IF TO_NUMBER(V_MBZDCD)-TO_NUMBER(V_MBXSWSCD) = TO_NUMBER(V_JCSJYCD)-TO_NUMBER(V_XSWSCD) AND TO_NUMBER(V_MBXSWSCD) >= TO_NUMBER(V_XSWSCD)
                             THEN V_CDHGBS :='1';
                             ELSE V_CDHGBS :='0';
                             END IF;
                         ELSIF CDJYGZ=4 THEN
                             IF TO_NUMBER(V_MBZDCD)-TO_NUMBER(V_MBXSWSCD) > TO_NUMBER(V_JCSJYCD)-TO_NUMBER(V_XSWSCD) AND TO_NUMBER(V_MBXSWSCD) >= TO_NUMBER(V_XSWSCD)
                             THEN V_CDHGBS :='1';
                             ELSE V_CDHGBS :='0';
                             END IF;
                         ELSIF CDJYGZ=5 THEN
                             IF TO_NUMBER(V_MBZDCD)-TO_NUMBER(V_MBXSWSCD) >= TO_NUMBER(V_JCSJYCD)-TO_NUMBER(V_XSWSCD) AND TO_NUMBER(V_MBXSWSCD) >= TO_NUMBER(V_XSWSCD)
                             THEN V_CDHGBS :='1';
                             ELSE V_CDHGBS :='0';
                             END IF;
                         END IF;
                      END IF;

                   END;
                  END LOOP;
                 CLOSE BZGF_JYGZ;
                 COMMIT;
                END;
              -----------DATE类型的字段长度插入时赋值为null
              IF V_MBZDLX='DATE' AND V_MBZDCD =0 THEN
                 V_MBZDCD :=NULL;
              -----------如果目标字段为number，并且小数位不为null
              ELSIF V_MBZDLX='NUMBER' AND V_MBXSWSCD !=0 THEN
                 V_MBZDCD :='(' || V_MBZDCD || ',' || V_MBXSWSCD || ')';
              ELSIF V_MBZDLX='NUMBER' AND V_MBXSWSCD =0 THEN
                 V_MBZDCD :=V_MBZDCD;
              END IF;
              IF V_JCSJYLX='DATE' AND V_JCSJYCD=0 THEN
                 V_JCSJYCD :=NULL;
              -----------如果规范字段为number，并且小数位不为null
              ELSIF V_JCSJYLX='NUMBER' AND V_XSWSCD !=0 THEN
                 V_JCSJYCD :='(' || V_JCSJYCD || ',' || V_XSWSCD || ')';
              ELSIF V_JCSJYLX='NUMBER' AND V_XSWSCD =0 THEN
                 V_JCSJYCD :=V_JCSJYCD;
              END IF;

              UPDATE T_ZDPZ_BZGF_JYXQ
              SET LXHGBS=V_LXHGBS,CDHGBS=V_CDHGBS,MBZDCD=V_MBZDCD,JCSJYCD=V_JCSJYCD
              WHERE ID=BZGF_ZDPZ_JYXQ_ID;
              COMMIT;

        END LOOP;
        COMMIT;



            ------------打开游标计算校验详情，更新校验结果表
            OPEN BZGF_JYGZ;
            LOOP
              FETCH BZGF_JYGZ INTO GZ;
              JYGZ :=GZ.JYGZ;
              EXIT WHEN BZGF_JYGZ%NOTFOUND;

              IF JYGZ=1 THEN

                  A_LXHGBS :='SELECT COUNT(*)  FROM (SELECT * FROM T_ZDPZ_BZGF_JYXQ Y WHERE Y.LXHGBS=1 AND Y.ZDPZ_BZGF_JYJG_ID='||JYJG_ID||')';
                  execute immediate A_LXHGBS INTO Y_LXHGBS;
                  B_LXHGBS :='SELECT COUNT(*)  FROM (SELECT * FROM T_ZDPZ_BZGF_JYXQ N WHERE N.LXHGBS=0 AND N.ZDPZ_BZGF_JYJG_ID='||JYJG_ID||')';
                  execute immediate B_LXHGBS INTO N_LXHGBS;
                  A_QZ    :='SELECT QZ   FROM T_BZGF_JYGZ WHERE JYGZ=1';
                  execute immediate A_QZ INTO V1_QZ;
                  JG_LXHGBS := Y_LXHGBS/(Y_LXHGBS+N_LXHGBS);

              ELSIF JYGZ=2 THEN
                  A_CDHGBS :='SELECT COUNT(*)  FROM (SELECT * FROM T_ZDPZ_BZGF_JYXQ Y WHERE Y.CDHGBS=1 AND Y.ZDPZ_BZGF_JYJG_ID='||JYJG_ID||')';
                  execute immediate A_CDHGBS INTO Y_CDHGBS;
                  B_CDHGBS :='SELECT COUNT(*)  FROM (SELECT * FROM T_ZDPZ_BZGF_JYXQ N WHERE N.CDHGBS=0 AND N.ZDPZ_BZGF_JYJG_ID='||JYJG_ID||')';
                  execute immediate B_CDHGBS INTO N_CDHGBS;
                  B_QZ    :='SELECT QZ   FROM T_BZGF_JYGZ WHERE JYGZ=2';
                  execute immediate B_QZ INTO V2_QZ;
                  JG_CDHGBS := Y_CDHGBS/(Y_CDHGBS+N_CDHGBS);
             END IF;
            END LOOP;
             CLOSE BZGF_JYGZ;
             COMMIT;


            IF JG_LXHGBS IS NULL
             THEN JG_LXHGBS :=0;
            END IF;
            IF V1_QZ IS NULL
             THEN V1_QZ :=0;
            END IF;
            IF JG_CDHGBS IS NULL
             THEN JG_CDHGBS :=0;
            END IF;
            IF V2_QZ IS NULL
             THEN V2_QZ :=0;
            END IF;

            JG_ZHGL   := JG_LXHGBS*V1_QZ+JG_CDHGBS*V2_QZ;
            HGLFZ     :='SELECT QJHGL FROM T_BZGF_JYGZ WHERE ROWNUM<2';
            execute immediate HGLFZ INTO HG_HGLFZ;


            UPDATE T_ZDPZ_BZGF_JYJG T1
            SET LXHGL=JG_LXHGBS*100,CDHGL=JG_CDHGBS*100,ZHGL=JG_ZHGL,JYRQ=DATATIME,LXQZ=V1_QZ,CDQZ=V2_QZ,HGLFZ=HG_HGLFZ
            WHERE T1.ID=JYJG_ID;

     END;
    COMMIT;
ELSIF PZ_NUM =0 THEN
          BEGIN
            ------------打开游标计算校验详情，更新校验结果表
            OPEN BZGF_JYGZ;
            LOOP
              FETCH BZGF_JYGZ INTO GZ;
              JYGZ :=GZ.JYGZ;
              EXIT WHEN BZGF_JYGZ%NOTFOUND;

              IF JYGZ=1 THEN
                  A_QZ    :='SELECT QZ   FROM T_BZGF_JYGZ WHERE JYGZ=1';
                  execute immediate A_QZ INTO V1_QZ;
              ELSIF JYGZ=2 THEN
                  B_QZ    :='SELECT QZ   FROM T_BZGF_JYGZ WHERE JYGZ=2';
                  execute immediate B_QZ INTO V2_QZ;
             END IF;
            END LOOP;
             CLOSE BZGF_JYGZ;
             COMMIT;

            IF V1_QZ IS NULL
             THEN V1_QZ :=0;
            END IF;
            IF V2_QZ IS NULL
             THEN V2_QZ :=0;
            END IF;

            HGLFZ     :='SELECT QJHGL FROM T_BZGF_JYGZ WHERE ROWNUM<2';
            execute immediate HGLFZ INTO HG_HGLFZ;


            UPDATE T_ZDPZ_BZGF_JYJG T1
            SET JYRQ=DATATIME,LXQZ=V1_QZ,CDQZ=V2_QZ,HGLFZ=HG_HGLFZ
            WHERE T1.ID=JYJG_ID;
         END;
         COMMIT;

END IF;

COMMIT;
END;
/


create or replace procedure PRC_BZGF_ZH(dsId NUMBER) is

-----基线版本转换成标准规范

tblId       INTEGER;
bzgfId      INTEGER;
sjyflId     INTEGER;
DATATIME    DATE;

CURSOR T_TABLE IS
  SELECT TBL_ID,TBL_NAME,TBL_DETAIL FROM t_meta_table t,t_meta_datasource d WHERE d.DS_ID=t.DS_ID and d.DS_ID=dsId AND d.STAT=1;
tt T_TABLE%ROWTYPE;

CURSOR T_COLUMN(tblId NUMBER) IS
  SELECT COL_NAME,REMARK,DATA_TYPE,DATA_LENGTH,COL_SEQ,NULLABLE,DATA_SCALE FROM t_meta_column WHERE TBL_ID=tblId;
cc T_COLUMN%ROWTYPE;

begin
DATATIME :=SYSDATE;
/***取出数据源插入到标准规范***/
SELECT SEQ_BZGF_ID.NEXTVAL INTO bzgfId FROM DUAL;
INSERT INTO t_bzgf(ID,BZGFMC,BZGFDM,SSLB,BZGFMS,CJSJ,ZHXGSJ) 
SELECT bzgfId,DS_NAME,null,4,DS_DETAIL,DATATIME,DATATIME FROM T_META_DATASOURCE 
where DS_ID=dsId and STAT=1;
COMMIT;

IF dsId IS NOT NULL THEN
  ---循环数据表
  BEGIN
    OPEN T_TABLE;
      LOOP
        fetch T_TABLE into tt;
          tblId := tt.TBL_ID;
          SELECT SEQ_SJYFL_ID.NEXTVAL INTO sjyflId FROM DUAL;
          BEGIN
            INSERT INTO T_SJYFL(ID,BZGF_ID,SJYFLMC,SJYFLDM,CJSJ,ZHXGSJ)
            VALUES (sjyflId,bzgfId,tt.TBL_DETAIL,tt.TBL_NAME,DATATIME,DATATIME);
          END;
          COMMIT;
        exit when T_TABLE%NOTFOUND;
        ---循环表字段
        BEGIN
          FOR cc IN T_COLUMN(tblId)
          LOOP
            fetch T_COLUMN into cc;
              INSERT INTO T_JCSJY(ID,SJYFL_ID,SJYMC,SJYDM,SJYDY,ZWQP,YWMC,SJGS,CD,XSWS,SFWK,SFZJ) 
              SELECT SEQ_JCSJY_ID.NEXTVAL,sjyflId,REMARK,COL_NAME,REMARK,null,null,4,DATA_LENGTH,COL_SEQ,1,1 FROM T_META_COLUMN 
              where TBL_ID=tblId;
              COMMIT;
            exit when T_COLUMN%NOTFOUND;
          END LOOP;
        END;
      END LOOP;
      CLOSE T_TABLE;
    END; 
    
END IF;  

end PRC_BZGF_ZH;
/


create or replace procedure PRC_DMS_DATABASE_LINK(droplink in varchar2,
dlink varchar2) authid current_user
as

createSql varchar2(1000);
dropSql varchar2(500);

begin

begin

dropSql:=droplink;
execute immediate dropSql;
exception
when others then
dbms_output.put_line('删除链接出错，可能是因为不存在');

end;


begin

createSql:=dlink;
execute immediate createSql;
exception
when others then
dbms_output.put_line('创建链接出错，可能是因为存在相同的链接名');
end;



end;
/


CREATE OR REPLACE PROCEDURE PRC_KBTB(DSID IN NUMBER,VERSION OUT VARCHAR2) AS

------库表同步


SJY_DS_ID          VARCHAR2(20);
SJY_DS_VERSION     VARCHAR2(20);
SJY_VERSION        VARCHAR2(20);
SJY_CONNECT_USER   VARCHAR2(200);
SQL1               VARCHAR2(4000);
SQL1_ZS            VARCHAR2(4000);
SQL2               VARCHAR2(4000);
SQL2_ZS            VARCHAR2(4000);
SQL3               VARCHAR2(4000);

--------获取库表同步数据源信息
CURSOR DATASOURCE(DSID VARCHAR2) IS
SELECT
DS_ID
, TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') DS_VERSION
, VERSION
, CONNECT_USER
FROM T_META_DATASOURCE
WHERE DS_ID=DSID
AND STAT='1';
SJY DATASOURCE%ROWTYPE;

BEGIN
-----打开游标取出数据源信息
FOR SJY IN DATASOURCE(DSID)
LOOP
SJY_DS_ID         :=SJY.DS_ID;
SJY_DS_VERSION    :=SJY.DS_VERSION;
SJY_VERSION       :=SJY.VERSION;
SJY_CONNECT_USER  :=SJY.CONNECT_USER;
END LOOP;

-----判断版本号是否为初始版本1.0,是-update,否-插入新版本
IF SJY_VERSION = '1.0' THEN
    update t_meta_datasource
    set version=SJY_DS_VERSION
    where ds_id=SJY_DS_ID
    and stat='1';
ELSIF SJY_VERSION !='1.0' THEN
    INSERT INTO T_META_DATASOURCE
    (DS_ID,DS_NAME,DS_DETAIL,
    DS_BELONG,DS_TYPE,SYSTEM_ID,
    CONNECT_TYPE,CONNECT_IP,
    SID_NAME,CONNECT_PORT,
    CONNECT_USER,CONNECT_PWD,
    ODBC_NAME,JNDI_NAME,STAT,
    VERSION,MODIFY_USER,MAINTAIN_TYPE,USER_TYPE,RAC_SID_NAME)
    SELECT
      DS_ID
    , U.DS_NAME
    , U.DS_DETAIL
    , U.DS_BELONG
    , U.DS_TYPE
    , U.SYSTEM_ID
    , U.CONNECT_TYPE
    , U.CONNECT_IP
    , U.SID_NAME
    , U.CONNECT_PORT
    , U.CONNECT_USER
    , U.CONNECT_PWD
    , U.ODBC_NAME
    , U.JNDI_NAME
    , '0' STAT
    , SJY_DS_VERSION
    , U.MODIFY_USER
    , U.MAINTAIN_TYPE
    , U.USER_TYPE
    , U.RAC_SID_NAME
    FROM T_META_DATASOURCE U
    WHERE U.STAT='1'
    AND U.DS_ID=SJY_DS_ID;
END IF;

-----插入表结构数据
SQL1 :=  'INSERT INTO T_META_TABLE(TBL_ID,TBL_VERSION,DS_ID,DS_VERSION,TBL_NAME,TBL_DETAIL,CLASS_ID,SCHEMA,MODIFY_USER)
          SELECT SEQ_TBLID.NEXTVAL TBL_ID,TO_CHAR(SYSDATE,''YYYYMMDDHH24MISS'') TBL_VERSION
                ,'''||SJY_DS_ID||''' DS_ID,'''|| SJY_DS_VERSION ||''' DS_VERSION,A.TABLE_NAME TBL_NAME
                ,A.COMMENTS TBL_DETAIL,1 CLASS_ID,A.OWNER SCHEMA,NULL MODIFY_USER
          FROM ALL_TAB_COMMENTS@DB_LINK_'|| SJY_CONNECT_USER ||' A
          WHERE A.OWNER='''|| SJY_CONNECT_USER ||'''
          AND A.TABLE_TYPE=''TABLE''';
EXECUTE IMMEDIATE SQL1;
COMMIT;
SQL1_ZS :=  'INSERT INTO T_META_TABLE_ZS(TBL_ID,TBL_VERSION,DS_ID,DS_VERSION,TBL_NAME,TBL_DETAIL,CLASS_ID,SCHEMA,MODIFY_USER)
          SELECT TBL_ID,TBL_VERSION,DS_ID,DS_VERSION,TBL_NAME,TBL_DETAIL,CLASS_ID,SCHEMA,MODIFY_USER
          FROM T_META_TABLE
          WHERE DS_VERSION='''|| SJY_DS_VERSION ||'''
          AND DS_ID='||SJY_DS_ID||'';
EXECUTE IMMEDIATE SQL1_ZS;
COMMIT;
-----插入表字段结构数据
SQL2 :=  'INSERT INTO T_META_COLUMN(ID,COL_NAME,REMARK,DATA_TYPE,DATA_LENGTH,COL_SEQ,NULLABLE,TBL_ID,DATA_SCALE)
          SELECT SEQ_COLID.NEXTVAL ID,A.COLUMN_NAME COL_NAME,B.COMMENTS REMARK,A.DATA_TYPE DATA_TYPE
                 ,DECODE(A.DATA_PRECISION,NULL,A.DATA_LENGTH,A.DATA_PRECISION) DATA_LENGTH
                 ,A.COLUMN_ID COL_SEQ,A.NULLABLE NULLABLE,C.TBL_ID TBL_ID,A.DATA_SCALE DATA_SCALE
          FROM ALL_TAB_COLS@DB_LINK_'|| SJY_CONNECT_USER ||' A,ALL_COL_COMMENTS@DB_LINK_'|| SJY_CONNECT_USER ||' B,T_META_TABLE C
          WHERE A.OWNER='''||SJY_CONNECT_USER||'''
          AND A.COLUMN_NAME=B.COLUMN_NAME
          AND A.TABLE_NAME=B.TABLE_NAME
          AND A.OWNER=B.OWNER
          AND C.TBL_NAME=A.TABLE_NAME
          AND C.TBL_NAME=B.TABLE_NAME
          AND C.DS_VERSION='''|| SJY_DS_VERSION ||'''
          AND C.DS_ID='|| SJY_DS_ID ||'';
EXECUTE IMMEDIATE SQL2;
COMMIT;
SQL2_ZS :=  'INSERT INTO T_META_COLUMN_ZS(ID,COL_NAME,REMARK,DATA_TYPE,DATA_LENGTH,COL_SEQ,NULLABLE,TBL_ID,DATA_SCALE)
          SELECT A.ID,A.COL_NAME,A.REMARK,A.DATA_TYPE,A.DATA_LENGTH,A.COL_SEQ,A.NULLABLE,A.TBL_ID,A.DATA_SCALE
          FROM T_META_COLUMN A,T_META_TABLE B
          WHERE A.TBL_ID=B.TBL_ID
          AND B.DS_VERSION='''|| SJY_DS_VERSION ||'''
          AND B.DS_ID='|| SJY_DS_ID ||'';
EXECUTE IMMEDIATE SQL2_ZS;
COMMIT;
-----插入主外键数据
SQL3 :=  'INSERT INTO T_META_TBLRELATION(ID,DS_ID,DS_VERSION,RELATION_TYPE,REMARK,CONSTRAINT_NAME,FK_OWNER,FK_TABLE,FK_COLUMN,PK_OWNER,PK_TABLE,PK_COLUMN)
         SELECT SEQ_TBLRELATION_ID.NEXTVAL,'''||SJY_DS_ID||''','''|| SJY_DS_VERSION ||''',1,NULL,A.CONSTRAINT_NAME
                ,A.OWNER,A.TABLE_NAME,C.COLUMN_NAME,B.OWNER,B.TABLE_NAME,D.COLUMN_NAME
         FROM USER_CONSTRAINTS@DB_LINK_'|| SJY_CONNECT_USER ||' A,USER_CONSTRAINTS@DB_LINK_'|| SJY_CONNECT_USER ||' B
              ,USER_CONS_COLUMNS@DB_LINK_'|| SJY_CONNECT_USER ||' C,USER_CONS_COLUMNS@DB_LINK_'|| SJY_CONNECT_USER ||' D
         WHERE A.R_CONSTRAINT_NAME=B.CONSTRAINT_NAME
         AND A.CONSTRAINT_TYPE=''R''
         AND B.CONSTRAINT_TYPE=''P''
         AND A.R_OWNER=B.OWNER
         AND A.CONSTRAINT_NAME=C.CONSTRAINT_NAME
         AND B.CONSTRAINT_NAME=D.CONSTRAINT_NAME
         AND A.OWNER=C.OWNER
         AND A.TABLE_NAME=C.TABLE_NAME
         AND B.OWNER=D.OWNER
         AND B.TABLE_NAME=D.TABLE_NAME
         AND C.COLUMN_NAME = D.COLUMN_NAME
         AND A.OWNER='''||SJY_CONNECT_USER||'''';
EXECUTE IMMEDIATE SQL3;
COMMIT;
-----版本号输出赋值
VERSION :=SJY_DS_VERSION;

-----调用字段备注存储
BEGIN 
PRC_PXSL_ZDBZ(SJY_DS_ID,SJY_DS_VERSION);
END;

END;
/


CREATE OR REPLACE PROCEDURE PRC_PXSL_CHANGDU(PXSL_CSID VARCHAR2) AS
  ----------剖析实例
  ----------字段长度判断

  DS_ID        INTEGER;
  TABLE_NAME   VARCHAR2(200);
  CLM_NAME     VARCHAR2(200);
  SELECT_SQL   VARCHAR2(4000);
  ID           INTEGER;
  PXSL_ID      INTEGER;
  DB_LINK_NAME VARCHAR2(200);
  ERR0R_NUM    NUMBER;
  ERROR_MSG    VARCHAR2(2000);
  ERR0R_WZ     VARCHAR2(2000);
  count_num    VARCHAR2(2000);
  pxzl_num     VARCHAR2(2000);
  PXCSMIN      VARCHAR2(2000);
  PXCSMAX      VARCHAR2(2000);

  --把一个表的数据取出来
  CURSOR POUXI_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id ='7';

  R POUXI_PEIZHI_CURSOR%ROWTYPE;

  CURSOR POUXI_CS_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id ='7'
       and a.id=PXSL_CSID;

  R1 POUXI_CS_PEIZHI_CURSOR%ROWTYPE;
begin
IF PXSL_CSID ='KONG'
THEN
 BEGIN
  open POUXI_PEIZHI_CURSOR;
  loop

    fetch POUXI_PEIZHI_CURSOR
      into r;
    DS_ID        := R.DS_ID;
    TABLE_NAME   := R.TBL_NAME;
    CLM_NAME     := R.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R.ID;
    DB_LINK_NAME := R.CONNECT_USER;
    PXCSMIN     := R.PXCS_MIN;
    PXCSMAX     := R.PXCS_MAX;
    exit when POUXI_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

  BEGIN
    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,NULL,'0',SYSDATE,NULL);

    ELSIF pxzl_num !='0'
  THEN
    ------------
    IF PXCSMIN IS NOT NULL AND PXCSMAX IS NOT NULL
     THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where LENGTH('||CLM_NAME||') BETWEEN '''||PXCSMIN||''' AND '''||PXCSMAX||''') t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
    -----------
    ELSIF PXCSMIN IS NULL AND PXCSMAX IS NOT NULL
     THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where '''||PXCSMAX||''' >= LENGTH('||CLM_NAME||')) t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
    -----------
    ELSIF PXCSMIN IS NOT NULL AND PXCSMAX IS NULL
     THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where '''||PXCSMIN||''' <= LENGTH('||CLM_NAME||')) t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
    END IF;
  END IF;
    EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '7',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
       COMMIT;
       RAISE;-----重新抛出异常
    END;
    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_PEIZHI_CURSOR;
  COMMIT;
  END;

ELSIF PXSL_CSID IS NOT NULL
THEN

 BEGIN
  open POUXI_CS_PEIZHI_CURSOR;
  loop

    fetch POUXI_CS_PEIZHI_CURSOR
      into r1;
    DS_ID        := R1.DS_ID;
    TABLE_NAME   := R1.TBL_NAME;
    CLM_NAME     := R1.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R1.ID;
    DB_LINK_NAME := R1.CONNECT_USER;
    PXCSMIN      := R1.PXCS_MIN;
    PXCSMAX      := R1.PXCS_MAX;
    exit when POUXI_CS_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

  BEGIN
    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,NULL,'0',SYSDATE,NULL);

    ELSIF pxzl_num !='0'
  THEN
    ------------
    IF PXCSMIN IS NOT NULL AND PXCSMAX IS NOT NULL
     THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where LENGTH('||CLM_NAME||') BETWEEN '''||PXCSMIN||''' AND '''||PXCSMAX||''') t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
    -----------
    ELSIF PXCSMIN IS NULL AND PXCSMAX IS NOT NULL
     THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where '''||PXCSMAX||''' >= LENGTH('||CLM_NAME||')) t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
    -----------
    ELSIF PXCSMIN IS NOT NULL AND PXCSMAX IS NULL
     THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where '''||PXCSMIN||''' <= LENGTH('||CLM_NAME||')) t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
    END IF;
  END IF;
    EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '7',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
       COMMIT;
       RAISE;-----重新抛出异常
    END;
    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_CS_PEIZHI_CURSOR;
  COMMIT;
  END;

END IF;

END;
/


CREATE OR REPLACE PROCEDURE PRC_PXSL_CHANGDU_SFZ(PXSL_CSID VARCHAR2) AS
  ----------剖析实例
  ----------字段长度判断_身份证长度为15或18

  DS_ID        INTEGER;
  TABLE_NAME   VARCHAR2(200);
  CLM_NAME     VARCHAR2(200);
  SELECT_SQL   VARCHAR2(4000);
  ID           INTEGER;
  PXSL_ID      INTEGER;
  DB_LINK_NAME VARCHAR2(200);
  ERR0R_NUM    NUMBER;
  ERROR_MSG    VARCHAR2(2000);
  ERR0R_WZ     VARCHAR2(2000);
  count_num    VARCHAR2(2000);
  pxzl_num     VARCHAR2(2000);

  --把一个表的数据取出来
  CURSOR POUXI_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id ='10';

  R POUXI_PEIZHI_CURSOR%ROWTYPE;

  CURSOR POUXI_CS_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id ='10'
       and a.id=PXSL_CSID;

  R1 POUXI_CS_PEIZHI_CURSOR%ROWTYPE;
begin
IF PXSL_CSID ='KONG'
THEN
 BEGIN
  open POUXI_PEIZHI_CURSOR;
  loop

    fetch POUXI_PEIZHI_CURSOR
      into r;
    DS_ID        := R.DS_ID;
    TABLE_NAME   := R.TBL_NAME;
    CLM_NAME     := R.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R.ID;
    DB_LINK_NAME := R.CONNECT_USER;
    exit when POUXI_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

  BEGIN
    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,NULL,'0',SYSDATE,NULL);

    ELSIF pxzl_num !='0'
  THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where LENGTH('||CLM_NAME||') in (15,18)) t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
  END IF;
    EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '10',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
       COMMIT;
       RAISE;-----重新抛出异常
    END;
    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_PEIZHI_CURSOR;
  COMMIT;
  END;

ELSIF PXSL_CSID IS NOT NULL
THEN

 BEGIN
  open POUXI_CS_PEIZHI_CURSOR;
  loop

    fetch POUXI_CS_PEIZHI_CURSOR
      into r1;
    DS_ID        := R1.DS_ID;
    TABLE_NAME   := R1.TBL_NAME;
    CLM_NAME     := R1.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R1.ID;
    DB_LINK_NAME := R1.CONNECT_USER;
    exit when POUXI_CS_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

  BEGIN
    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,NULL,'0',SYSDATE,NULL);

    ELSIF pxzl_num !='0'
  THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where LENGTH('||CLM_NAME||') in (15,18)) t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
  END IF;
    EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '10',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
       COMMIT;
       RAISE;-----重新抛出异常
    END;
    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_CS_PEIZHI_CURSOR;
  COMMIT;
  END;

END IF;

END;
/


CREATE OR REPLACE PROCEDURE PRC_PXSL_CHANGDU_ZDZ(PXSL_CSID VARCHAR2) AS
  ----------剖析实例
  ----------字段长度判断_值区间

  DS_ID        INTEGER;
  TABLE_NAME   VARCHAR2(200);
  CLM_NAME     VARCHAR2(200);
  SELECT_SQL   VARCHAR2(4000);
  ID           INTEGER;
  PXSL_ID      INTEGER;
  DB_LINK_NAME VARCHAR2(200);
  ERR0R_NUM    NUMBER;
  ERROR_MSG    VARCHAR2(2000);
  ERR0R_WZ     VARCHAR2(2000);
  count_num    VARCHAR2(2000);
  pxzl_num     VARCHAR2(2000);
  PXCSMIN      VARCHAR2(2000);
  PXCSMAX      VARCHAR2(2000);

  --把一个表的数据取出来
  CURSOR POUXI_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id ='13';

  R POUXI_PEIZHI_CURSOR%ROWTYPE;

  CURSOR POUXI_CS_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id ='13'
       and a.id=PXSL_CSID;

  R1 POUXI_CS_PEIZHI_CURSOR%ROWTYPE;
begin
IF PXSL_CSID ='KONG'
THEN
 BEGIN
  open POUXI_PEIZHI_CURSOR;
  loop

    fetch POUXI_PEIZHI_CURSOR
      into r;
    DS_ID        := R.DS_ID;
    TABLE_NAME   := R.TBL_NAME;
    CLM_NAME     := R.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R.ID;
    DB_LINK_NAME := R.CONNECT_USER;
    PXCSMIN     := R.PXCS_MIN;
    PXCSMAX     := R.PXCS_MAX;
    exit when POUXI_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

  BEGIN
    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,null,'0',SYSDATE,null);

    ELSIF pxzl_num !='0'
  THEN
    ------------
    IF PXCSMIN IS NOT NULL AND PXCSMAX IS NOT NULL
     THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where '||CLM_NAME||' BETWEEN '''||PXCSMIN||''' AND '''||PXCSMAX||''') t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
    -----------
    ELSIF PXCSMIN IS NULL AND PXCSMAX IS NOT NULL
     THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where '''||PXCSMAX||''' >= '||CLM_NAME||') t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
    -----------
    ELSIF PXCSMIN IS NOT NULL AND PXCSMAX IS NULL
     THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where '''||PXCSMIN||''' <= '||CLM_NAME||') t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
    END IF;
  END IF;
    EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '13',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
       COMMIT;
       RAISE;-----重新抛出异常
    END;
    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_PEIZHI_CURSOR;
  COMMIT;
  END;

ELSIF PXSL_CSID IS NOT NULL
THEN

 BEGIN
  open POUXI_CS_PEIZHI_CURSOR;
  loop

    fetch POUXI_CS_PEIZHI_CURSOR
      into r1;
    DS_ID        := R1.DS_ID;
    TABLE_NAME   := R1.TBL_NAME;
    CLM_NAME     := R1.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R1.ID;
    DB_LINK_NAME := R1.CONNECT_USER;
    PXCSMIN      := R1.PXCS_MIN;
    PXCSMAX      := R1.PXCS_MAX;
    exit when POUXI_CS_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

  BEGIN
    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,null,'0',SYSDATE,null);

    ELSIF pxzl_num !='0'
  THEN
    ------------
    IF PXCSMIN IS NOT NULL AND PXCSMAX IS NOT NULL
     THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where '||CLM_NAME||' BETWEEN '''||PXCSMIN||''' AND '''||PXCSMAX||''') t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
    -----------
    ELSIF PXCSMIN IS NULL AND PXCSMAX IS NOT NULL
     THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where '''||PXCSMAX||''' >= '||CLM_NAME||') t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
    -----------
    ELSIF PXCSMIN IS NOT NULL AND PXCSMAX IS NULL
     THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where '''||PXCSMIN||''' <= '||CLM_NAME||') t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
    END IF;
  END IF;
    EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '13',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
       COMMIT;
       RAISE;-----重新抛出异常
    END;
    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_CS_PEIZHI_CURSOR;
  COMMIT;
  END;

END IF;

END;
/


CREATE OR REPLACE PROCEDURE PRC_PXSL_CHONGFU(PXSL_CSID VARCHAR2) AS
  ----------剖析实例
  ----------字段重复数剖析规则

  DS_ID        INTEGER;
  TABLE_NAME   VARCHAR2(200);
  CLM_NAME     VARCHAR2(200);
  SELECT_SQL   VARCHAR2(4000);
  ID           INTEGER;
  PXSL_ID      INTEGER;
  DB_LINK_NAME VARCHAR2(200);
  ERR0R_NUM    NUMBER;
  ERROR_MSG    VARCHAR2(2000);
  ERR0R_WZ     VARCHAR2(2000);
  count_num    VARCHAR2(2000);
  pxzl_num     VARCHAR2(2000);

  --把一个表的数据取出来
  CURSOR POUXI_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id ='3';

  R POUXI_PEIZHI_CURSOR%ROWTYPE;

  CURSOR POUXI_CS_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id ='3'
       and a.id=PXSL_CSID;

  R1 POUXI_CS_PEIZHI_CURSOR%ROWTYPE;
begin
IF PXSL_CSID ='KONG'
THEN
 BEGIN
  open POUXI_PEIZHI_CURSOR;
  loop

    fetch POUXI_PEIZHI_CURSOR
      into r;
    DS_ID        := R.DS_ID;
    TABLE_NAME   := R.TBL_NAME;
    CLM_NAME     := R.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R.ID;
    DB_LINK_NAME := R.CONNECT_USER;
    exit when POUXI_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

  BEGIN
    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,NULL,'0',SYSDATE,NULL);

    ELSIF pxzl_num !='0'
  THEN

    SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
    select t.*,(100-t.pxwtgl/t.pxzl*100) pxdbl from
(with a as(
select ' || CLM_NAME || ',count(*) num from ' ||
                  TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
group by ' || CLM_NAME || ')
select sum(case when num>1 then num else 0 end) pxwtgl
,sum(num) pxzl,' || ID || ',' || PXSL_ID || ',sysdate pxsj
from a) t';

    EXECUTE IMMEDIATE SELECT_SQL;
    COMMIT;
  END IF;
    EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '3',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
       COMMIT;
       RAISE;-----重新抛出异常
    END;
    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_PEIZHI_CURSOR;
  COMMIT;
  END;

ELSIF PXSL_CSID IS NOT NULL
THEN

 BEGIN
  open POUXI_CS_PEIZHI_CURSOR;
  loop

    fetch POUXI_CS_PEIZHI_CURSOR
      into r1;
    DS_ID        := R1.DS_ID;
    TABLE_NAME   := R1.TBL_NAME;
    CLM_NAME     := R1.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R1.ID;
    DB_LINK_NAME := R1.CONNECT_USER;
    exit when POUXI_CS_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

  BEGIN
    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,NULL,'0',SYSDATE,NULL);

    ELSIF pxzl_num !='0'
  THEN

    SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
    select t.*,(100-t.pxwtgl/t.pxzl*100) pxdbl from
(with a as(
select ' || CLM_NAME || ',count(*) num from ' ||
                  TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
group by ' || CLM_NAME || ')
select sum(case when num>1 then num else 0 end) pxwtgl
,sum(num) pxzl,' || ID || ',' || PXSL_ID || ',sysdate pxsj
from a) t';

    EXECUTE IMMEDIATE SELECT_SQL;
    COMMIT;
  END IF;
    EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '3',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
       COMMIT;
       RAISE;-----重新抛出异常
    END;
    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_CS_PEIZHI_CURSOR;
  COMMIT;
  END;

END IF;

END;
/


CREATE OR REPLACE PROCEDURE PRC_PXSL_DATE(PXSL_CSID VARCHAR2) AS
  ----------剖析实例
  ----------字段非日期数剖析规则

  DS_ID        INTEGER;
  TABLE_NAME   VARCHAR2(200);
  CLM_NAME     VARCHAR2(200);
  SELECT_SQL   VARCHAR2(4000);
  ID           INTEGER;
  PXSL_ID      INTEGER;
  DB_LINK_NAME VARCHAR2(200);
  ERR0R_NUM    NUMBER;
  ERROR_MSG    VARCHAR2(2000);
  ERR0R_WZ     VARCHAR2(2000);
  COLUMN_TYPE  VARCHAR2(2000);
  COL_TYPE     VARCHAR2(2000);

  --把一个表的数据取出来
  CURSOR POUXI_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id = '4';
  R POUXI_PEIZHI_CURSOR%ROWTYPE;

    CURSOR POUXI_CS_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id = '4'
       and a.id=PXSL_CSID;
  R1 POUXI_CS_PEIZHI_CURSOR%ROWTYPE;

begin
IF PXSL_CSID ='KONG'
THEN
BEGIN
  open POUXI_PEIZHI_CURSOR;
  loop

    fetch POUXI_PEIZHI_CURSOR
      into r;
    DS_ID        := R.DS_ID;
    TABLE_NAME   := R.TBL_NAME;
    CLM_NAME     := R.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R.ID;
    DB_LINK_NAME := R.CONNECT_USER;
    exit when POUXI_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

    BEGIN

     COLUMN_TYPE :='SELECT DATA_TYPE FROM USER_TAB_COLUMNS@DB_LINK_' || DB_LINK_NAME ||'
                  WHERE COLUMN_NAME='''||CLM_NAME||''' AND TABLE_NAME='''||TABLE_NAME||'''';
    EXECUTE IMMEDIATE COLUMN_TYPE INTO COL_TYPE;

  IF COL_TYPE LIKE 'DATE' OR COL_TYPE LIKE 'TIMESTAMP%'
  THEN

    SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
                  select t.*,(100-t.pxwtgl/t.pxzl*100) pxdbl from
                  (select ' || ID || ',' || PXSL_ID ||
                                    ',sum(case
                             when IS_DATE(TO_CHAR(' || CLM_NAME || ',''YYYYMMDDHH24MISS''))=1
                             then 0
                             else 1 end) pxwtgl,
                         count(*) pxzl,
                         sysdate pxsj
                  from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME ||
                                    ') t';

    EXECUTE IMMEDIATE SELECT_SQL;
    COMMIT;
  ELSIF COL_TYPE NOT LIKE 'DATE' AND COL_TYPE NOT LIKE 'TIMESTAMP%'
  THEN

      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
                  select t.*,(100-t.pxwtgl/t.pxzl*100) pxdbl from
                  (select ' || ID || ',' || PXSL_ID ||
                                    ',sum(case
                             when IS_DATE(' || CLM_NAME || ')=1
                             then 0
                             else 1 end) pxwtgl,
                         count(*) pxzl,
                         sysdate pxsj
                  from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME ||
                                    ') t';

    EXECUTE IMMEDIATE SELECT_SQL;
    COMMIT;

  END IF;

     EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '4',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
        COMMIT;
        RAISE;-----重新抛出异常
    END;




    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_PEIZHI_CURSOR;

  COMMIT;
END;

ELSIF PXSL_CSID IS NOT NULL
THEN
BEGIN
  open POUXI_CS_PEIZHI_CURSOR;
  loop

    fetch POUXI_CS_PEIZHI_CURSOR
      into r1;
    DS_ID        := R1.DS_ID;
    TABLE_NAME   := R1.TBL_NAME;
    CLM_NAME     := R1.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R1.ID;
    DB_LINK_NAME := R1.CONNECT_USER;
    exit when POUXI_CS_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

    BEGIN

       COLUMN_TYPE :='SELECT DATA_TYPE FROM USER_TAB_COLUMNS@DB_LINK_' || DB_LINK_NAME ||'
                  WHERE COLUMN_NAME='''||CLM_NAME||''' AND TABLE_NAME='''||TABLE_NAME||'''';
    EXECUTE IMMEDIATE COLUMN_TYPE INTO COL_TYPE;

  IF COL_TYPE LIKE 'DATE' OR COL_TYPE LIKE 'TIMESTAMP%'
  THEN

    SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
                  select t.*,(100-t.pxwtgl/t.pxzl*100) pxdbl from
                  (select ' || ID || ',' || PXSL_ID ||
                                    ',sum(case
                             when IS_DATE(TO_CHAR(' || CLM_NAME || ',''YYYYMMDDHH24MISS''))=1
                             then 0
                             else 1 end) pxwtgl,
                         count(*) pxzl,
                         sysdate pxsj
                  from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME ||
                                    ') t';

    EXECUTE IMMEDIATE SELECT_SQL;
    COMMIT;

    ELSIF COL_TYPE NOT LIKE 'DATE' AND COL_TYPE NOT LIKE 'TIMESTAMP%'
  THEN

      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
                  select t.*,(100-t.pxwtgl/t.pxzl*100) pxdbl from
                  (select ' || ID || ',' || PXSL_ID ||
                                    ',sum(case
                             when IS_DATE(' || CLM_NAME || ')=1
                             then 0
                             else 1 end) pxwtgl,
                         count(*) pxzl,
                         sysdate pxsj
                  from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME ||
                                    ') t';

    EXECUTE IMMEDIATE SELECT_SQL;
    COMMIT;

  END IF;


     EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '4',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
        COMMIT;
        RAISE;-----重新抛出异常
    END;




    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_CS_PEIZHI_CURSOR;

  COMMIT;
END;
END IF;


END;
/


CREATE OR REPLACE PROCEDURE PRC_PXSL_NULL(PXSL_CSID VARCHAR2) AS
  ----------剖析实例
  ----------字段空值数剖析规则

  DS_ID        INTEGER;
  TABLE_NAME   VARCHAR2(200);
  CLM_NAME     VARCHAR2(200);
  SELECT_SQL   VARCHAR2(4000);
  ID           INTEGER;
  PXSL_ID      INTEGER;
  DB_LINK_NAME VARCHAR2(200);
  ERR0R_NUM    NUMBER;
  ERROR_MSG    VARCHAR2(2000);
  ERR0R_WZ     VARCHAR2(2000);
  count_num    VARCHAR2(2000);
  pxzl_num     VARCHAR2(2000);


  --把一个表的数据取出来
  CURSOR POUXI_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id = '2';

  R POUXI_PEIZHI_CURSOR%ROWTYPE;

  CURSOR POUXI_CS_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id = '2'
       and a.id=PXSL_CSID;

  R1 POUXI_CS_PEIZHI_CURSOR%ROWTYPE;

begin
IF PXSL_CSID ='KONG'
THEN
 BEGIN
  open POUXI_PEIZHI_CURSOR;
  loop

    fetch POUXI_PEIZHI_CURSOR
      into r;
    DS_ID        := R.DS_ID;
    TABLE_NAME   := R.TBL_NAME;
    CLM_NAME     := R.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R.ID;
    DB_LINK_NAME := R.CONNECT_USER;
    exit when POUXI_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

    BEGIN

    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,null,'0',SYSDATE,null);

    ELSIF pxzl_num !='0'
  THEN
     SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
                        select t.*,(100-t.pxwtgl/t.pxzl*100) PXDBL from
                      (select ' || ID || ',' || PXSL_ID || ',
                      decode(sum(case when ' || CLM_NAME ||
                    ' is null then 1 else 0 end)
                          ,null
                          ,0
                          ,sum(case when ' || CLM_NAME ||
                    ' is null then 1 else 0 end)) PXWTGL
                      ,count(*) PXZL,
                      sysdate PXSJ
                      from ' || TABLE_NAME ||
                    '@DB_LINK_' || DB_LINK_NAME || ') t';

      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
   END IF;
    EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '2',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
        COMMIT;
        RAISE;-----重新抛出异常
    END;

    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_PEIZHI_CURSOR;

  COMMIT;
 END;
ELSIF PXSL_CSID IS NOT NULL
THEN
 BEGIN
  open POUXI_CS_PEIZHI_CURSOR;
  loop

    fetch POUXI_CS_PEIZHI_CURSOR
      into r1;
    DS_ID        := R1.DS_ID;
    TABLE_NAME   := R1.TBL_NAME;
    CLM_NAME     := R1.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R1.ID;
    DB_LINK_NAME := R1.CONNECT_USER;
    exit when POUXI_CS_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

    BEGIN

    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,null,'0',SYSDATE,null);

    ELSIF pxzl_num !='0'
  THEN

      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
                        select t.*,(100-t.pxwtgl/t.pxzl*100) PXDBL from
                      (select ' || ID || ',' || PXSL_ID || ',
                      decode(sum(case when ' || CLM_NAME ||
                    ' is null then 1 else 0 end)
                          ,null
                          ,0
                          ,sum(case when ' || CLM_NAME ||
                    ' is null then 1 else 0 end)) PXWTGL
                      ,count(*) PXZL,
                      sysdate PXSJ
                      from ' || TABLE_NAME ||
                    '@DB_LINK_' || DB_LINK_NAME || ') t';

      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
   END IF;
    EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '2',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
        COMMIT;
        RAISE;-----重新抛出异常
    END;

    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_CS_PEIZHI_CURSOR;

  COMMIT;
 END;
END IF;


END;
/


CREATE OR REPLACE PROCEDURE PRC_PXSL_NUMBER(PXSL_CSID VARCHAR2) AS
  ----------剖析实例
  ----------字段非数字剖析规则

  DS_ID        INTEGER;
  TABLE_NAME   VARCHAR2(200);
  CLM_NAME     VARCHAR2(200);
  SELECT_SQL   VARCHAR2(4000);
  ID           INTEGER;
  PXSL_ID      INTEGER;
  DB_LINK_NAME VARCHAR2(200);
  ERR0R_NUM NUMBER;
  ERROR_MSG VARCHAR2(2000);
  ERR0R_WZ VARCHAR2(2000);

  --把一个表的数据取出来
  CURSOR POUXI_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id = '5';
  R POUXI_PEIZHI_CURSOR%ROWTYPE;

  CURSOR POUXI_CS_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id = '5'
       and a.id=PXSL_CSID;
  R1 POUXI_CS_PEIZHI_CURSOR%ROWTYPE;

begin
IF PXSL_CSID ='KONG'
THEN
 BEGIN
  open POUXI_PEIZHI_CURSOR;
  loop

    fetch POUXI_PEIZHI_CURSOR
      into r;
    DS_ID        := R.DS_ID;
    TABLE_NAME   := R.TBL_NAME;
    CLM_NAME     := R.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R.ID;
    DB_LINK_NAME := R.CONNECT_USER;
    exit when POUXI_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

    BEGIN

    SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
                  select t.*,(100-t.pxwtgl/t.pxzl*100) pxdbl from
                  (select ' || ID || ',' || PXSL_ID ||
                                    ',sum(case
                             when IS_NUMBER(' || CLM_NAME || ')=1
                             then 0
                             else 1 end) pxwtgl,
                         count(*) pxzl,
                         sysdate pxsj
                  from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || ') t';

    EXECUTE IMMEDIATE SELECT_SQL;
    COMMIT;

     EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '5',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
        COMMIT;
        RAISE;-----重新抛出异常
    END;




    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_PEIZHI_CURSOR;
  COMMIT;
 END;

ELSIF PXSL_CSID IS NOT NULL
THEN

 BEGIN
  open POUXI_CS_PEIZHI_CURSOR;
  loop

    fetch POUXI_CS_PEIZHI_CURSOR
      into r1;
    DS_ID        := R1.DS_ID;
    TABLE_NAME   := R1.TBL_NAME;
    CLM_NAME     := R1.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R1.ID;
    DB_LINK_NAME := R1.CONNECT_USER;
    exit when POUXI_CS_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

    BEGIN

    SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
                  select t.*,(100-t.pxwtgl/t.pxzl*100) pxdbl from
                  (select ' || ID || ',' || PXSL_ID ||
                                    ',sum(case
                             when IS_NUMBER(' || CLM_NAME || ')=1
                             then 0
                             else 1 end) pxwtgl,
                         count(*) pxzl,
                         sysdate pxsj
                  from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || ') t';

    EXECUTE IMMEDIATE SELECT_SQL;
    COMMIT;

     EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '5',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
        COMMIT;
        RAISE;-----重新抛出异常
    END;




    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_CS_PEIZHI_CURSOR;
  COMMIT;
 END;
END IF;

END;
/


CREATE OR REPLACE PROCEDURE PRC_PXSL_RIQI(PXSL_CSID VARCHAR2) AS
  ----------剖析实例
  ----------字段日期区间

  DS_ID        INTEGER;
  TABLE_NAME   VARCHAR2(200);
  CLM_NAME     VARCHAR2(200);
  SELECT_SQL   VARCHAR2(4000);
  ID           INTEGER;
  PXSL_ID      INTEGER;
  DB_LINK_NAME VARCHAR2(200);
  ERR0R_NUM    NUMBER;
  ERROR_MSG    VARCHAR2(2000);
  ERR0R_WZ     VARCHAR2(2000);
  count_num    VARCHAR2(2000);
  pxzl_num     VARCHAR2(2000);
  PXCSMIN      VARCHAR2(2000);
  PXCSMAX      VARCHAR2(2000);

  --把一个表的数据取出来
  CURSOR POUXI_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id ='8';

  R POUXI_PEIZHI_CURSOR%ROWTYPE;

  CURSOR POUXI_CS_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id ='8'
       and a.id=PXSL_CSID;

  R1 POUXI_CS_PEIZHI_CURSOR%ROWTYPE;
begin
IF PXSL_CSID ='KONG'
THEN
 BEGIN
  open POUXI_PEIZHI_CURSOR;
  loop

    fetch POUXI_PEIZHI_CURSOR
      into r;
    DS_ID        := R.DS_ID;
    TABLE_NAME   := R.TBL_NAME;
    CLM_NAME     := R.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R.ID;
    DB_LINK_NAME := R.CONNECT_USER;
    PXCSMIN      := R.PXCS_MIN;
    PXCSMAX      := R.PXCS_MAX;
    exit when POUXI_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

  BEGIN
    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,NULL,'0',SYSDATE,NULL);

    ELSIF pxzl_num !='0'
  THEN
    ------------
    IF PXCSMIN IS NOT NULL AND PXCSMAX IS NOT NULL
     THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where TO_DATE('''||PXCSMIN||''',''YYYY-MM-DD'') <= TO_DATE(TO_CHAR('||CLM_NAME||',''YYYY-MM-DD''),''YYYY-MM-DD'')
                    AND    TO_DATE('''||PXCSMAX||''',''YYYY-MM-DD'') >= TO_DATE(TO_CHAR('||CLM_NAME||',''YYYY-MM-DD''),''YYYY-MM-DD'')) t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
    -----------
    ELSIF PXCSMIN IS NULL AND PXCSMAX IS NOT NULL
     THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where TO_DATE('''||PXCSMAX||''',''YYYY-MM-DD'') >= TO_DATE(TO_CHAR('||CLM_NAME||',''YYYY-MM-DD''),''YYYY-MM-DD'')) t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
    -----------
    ELSIF PXCSMIN IS NOT NULL AND PXCSMAX IS NULL
     THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where TO_DATE('''||PXCSMIN||''',''YYYY-MM-DD'') <= TO_DATE(TO_CHAR('||CLM_NAME||',''YYYY-MM-DD''),''YYYY-MM-DD'')) t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
    END IF;
  END IF;
    EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '8',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
       COMMIT;
       RAISE;-----重新抛出异常
    END;
    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_PEIZHI_CURSOR;
  COMMIT;
  END;

ELSIF PXSL_CSID IS NOT NULL
THEN

 BEGIN
  open POUXI_CS_PEIZHI_CURSOR;
  loop

    fetch POUXI_CS_PEIZHI_CURSOR
      into r1;
    DS_ID        := R1.DS_ID;
    TABLE_NAME   := R1.TBL_NAME;
    CLM_NAME     := R1.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R1.ID;
    DB_LINK_NAME := R1.CONNECT_USER;
    PXCSMIN      := R1.PXCS_MIN;
    PXCSMAX      := R1.PXCS_MAX;
    exit when POUXI_CS_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

  BEGIN
    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,NULL,'0',SYSDATE,NULL);

    ELSIF pxzl_num !='0'
  THEN
    ------------
    IF PXCSMIN IS NOT NULL AND PXCSMAX IS NOT NULL
     THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where TO_DATE('''||PXCSMIN||''',''YYYY-MM-DD'') <= TO_DATE(TO_CHAR('||CLM_NAME||',''YYYY-MM-DD''),''YYYY-MM-DD'')
                    AND    TO_DATE('''||PXCSMAX||''',''YYYY-MM-DD'') >= TO_DATE(TO_CHAR('||CLM_NAME||',''YYYY-MM-DD''),''YYYY-MM-DD'')) t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
    -----------
    ELSIF PXCSMIN IS NULL AND PXCSMAX IS NOT NULL
     THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where TO_DATE('''||PXCSMAX||''',''YYYY-MM-DD'') >= TO_DATE(TO_CHAR('||CLM_NAME||',''YYYY-MM-DD''),''YYYY-MM-DD'')) t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
    -----------
    ELSIF PXCSMIN IS NOT NULL AND PXCSMAX IS NULL
     THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where TO_DATE('''||PXCSMIN||''',''YYYY-MM-DD'') <= TO_DATE(TO_CHAR('||CLM_NAME||',''YYYY-MM-DD''),''YYYY-MM-DD'')) t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
    END IF;
  END IF;
    EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '8',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
       COMMIT;
       RAISE;-----重新抛出异常
    END;
    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_CS_PEIZHI_CURSOR;
  COMMIT;
  END;

END IF;

END;
/


CREATE OR REPLACE PROCEDURE PRC_PXSL_RIQI_DYJT(PXSL_CSID VARCHAR2) AS
  ----------剖析实例
  ----------字段日期大于当天

  DS_ID        INTEGER;
  TABLE_NAME   VARCHAR2(200);
  CLM_NAME     VARCHAR2(200);
  SELECT_SQL   VARCHAR2(4000);
  ID           INTEGER;
  PXSL_ID      INTEGER;
  DB_LINK_NAME VARCHAR2(200);
  ERR0R_NUM    NUMBER;
  ERROR_MSG    VARCHAR2(2000);
  ERR0R_WZ     VARCHAR2(2000);
  count_num    VARCHAR2(2000);
  pxzl_num     VARCHAR2(2000);

  --把一个表的数据取出来
  CURSOR POUXI_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id ='11';

  R POUXI_PEIZHI_CURSOR%ROWTYPE;

  CURSOR POUXI_CS_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id ='11'
       and a.id=PXSL_CSID;

  R1 POUXI_CS_PEIZHI_CURSOR%ROWTYPE;
begin
IF PXSL_CSID ='KONG'
THEN
 BEGIN
  open POUXI_PEIZHI_CURSOR;
  loop

    fetch POUXI_PEIZHI_CURSOR
      into r;
    DS_ID        := R.DS_ID;
    TABLE_NAME   := R.TBL_NAME;
    CLM_NAME     := R.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R.ID;
    DB_LINK_NAME := R.CONNECT_USER;
    exit when POUXI_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

  BEGIN
    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,NULL,'0',SYSDATE,NULL);

    ELSIF pxzl_num !='0'
  THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where TO_DATE(TO_CHAR(SYSDATE,''YYYY-MM-DD''),''YYYY-MM-DD'') < TO_DATE(TO_CHAR('||CLM_NAME||',''YYYY-MM-DD''),''YYYY-MM-DD'')) t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
  END IF;
    EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '11',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
       COMMIT;
       RAISE;-----重新抛出异常
    END;
    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_PEIZHI_CURSOR;
  COMMIT;
  END;

ELSIF PXSL_CSID IS NOT NULL
THEN

 BEGIN
  open POUXI_CS_PEIZHI_CURSOR;
  loop

    fetch POUXI_CS_PEIZHI_CURSOR
      into r1;
    DS_ID        := R1.DS_ID;
    TABLE_NAME   := R1.TBL_NAME;
    CLM_NAME     := R1.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R1.ID;
    DB_LINK_NAME := R1.CONNECT_USER;
    exit when POUXI_CS_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

  BEGIN
    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,NULL,'0',SYSDATE,NULL);

    ELSIF pxzl_num !='0'
  THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where TO_DATE(TO_CHAR(SYSDATE,''YYYY-MM-DD''),''YYYY-MM-DD'') < TO_DATE(TO_CHAR('||CLM_NAME||',''YYYY-MM-DD''),''YYYY-MM-DD'')) t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
  END IF;
    EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '11',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
       COMMIT;
       RAISE;-----重新抛出异常
    END;
    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_CS_PEIZHI_CURSOR;
  COMMIT;
  END;

END IF;

END;
/


CREATE OR REPLACE PROCEDURE PRC_PXSL_RIQI_DYZDSJ(PXSL_CSID VARCHAR2) AS
  ----------剖析实例
  ----------字段日期大于指定时间

  DS_ID        INTEGER;
  TABLE_NAME   VARCHAR2(200);
  CLM_NAME     VARCHAR2(200);
  SELECT_SQL   VARCHAR2(4000);
  ID           INTEGER;
  PXSL_ID      INTEGER;
  DB_LINK_NAME VARCHAR2(200);
  ERR0R_NUM    NUMBER;
  ERROR_MSG    VARCHAR2(2000);
  ERR0R_WZ     VARCHAR2(2000);
  count_num    VARCHAR2(2000);
  pxzl_num     VARCHAR2(2000);
  PXCSMIN      VARCHAR2(2000);

  --把一个表的数据取出来
  CURSOR POUXI_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id ='12';

  R POUXI_PEIZHI_CURSOR%ROWTYPE;

  CURSOR POUXI_CS_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id ='12'
       and a.id=PXSL_CSID;

  R1 POUXI_CS_PEIZHI_CURSOR%ROWTYPE;
begin
IF PXSL_CSID ='KONG'
THEN
 BEGIN
  open POUXI_PEIZHI_CURSOR;
  loop

    fetch POUXI_PEIZHI_CURSOR
      into r;
    DS_ID        := R.DS_ID;
    TABLE_NAME   := R.TBL_NAME;
    CLM_NAME     := R.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R.ID;
    DB_LINK_NAME := R.CONNECT_USER;
    PXCSMIN     := R.PXCS_MIN;
    exit when POUXI_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

  BEGIN
    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,NULL,'0',SYSDATE,NULL);

    ELSIF pxzl_num !='0'
  THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where TO_DATE(TO_CHAR(SYSDATE,''YYYY-MM-DD''),''YYYY-MM-DD'') > TO_DATE(TO_CHAR('||CLM_NAME||',''YYYY-MM-DD''),''YYYY-MM-DD'')+'||PXCSMIN||') t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
  END IF;
    EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '12',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
       COMMIT;
       RAISE;-----重新抛出异常
    END;
    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_PEIZHI_CURSOR;
  COMMIT;
  END;

ELSIF PXSL_CSID IS NOT NULL
THEN

 BEGIN
  open POUXI_CS_PEIZHI_CURSOR;
  loop

    fetch POUXI_CS_PEIZHI_CURSOR
      into r1;
    DS_ID        := R1.DS_ID;
    TABLE_NAME   := R1.TBL_NAME;
    CLM_NAME     := R1.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R1.ID;
    DB_LINK_NAME := R1.CONNECT_USER;
    PXCSMIN      := R1.PXCS_MIN;
    exit when POUXI_CS_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

  BEGIN
    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,NULL,'0',SYSDATE,NULL);

    ELSIF pxzl_num !='0'
  THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where TO_DATE(TO_CHAR(SYSDATE,''YYYY-MM-DD''),''YYYY-MM-DD'') > TO_DATE(TO_CHAR('||CLM_NAME||',''YYYY-MM-DD''),''YYYY-MM-DD'')+'||PXCSMIN||') t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
  END IF;
    EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '12',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
       COMMIT;
       RAISE;-----重新抛出异常
    END;
    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_CS_PEIZHI_CURSOR;
  COMMIT;
  END;

END IF;

END;
/


CREATE OR REPLACE PROCEDURE PRC_PXSL_TBLNULL(PXSL_CSID VARCHAR2) AS
  ----------剖析实例
  ----------表空值数剖析规则

  DS_ID        INTEGER;
  TABLE_NAME   VARCHAR2(200);
  CLM_NAME     VARCHAR2(200);
  COL_NUM      VARCHAR2(4000);
  ID           INTEGER;
  PXSL_ID      INTEGER;
  DB_LINK_NAME VARCHAR2(200);
  ERR0R_NUM    NUMBER;
  ERROR_MSG    VARCHAR2(2000);
  ERR0R_WZ     VARCHAR2(2000);
  return_cnt   NUMBER;
  sql_str      VARCHAR2(4000);
  cnt_tmp      VARCHAR2(4000);
  PX_COLS      VARCHAR2(4000);
  COLS         VARCHAR2(4000);
  NUM          VARCHAR2(4000);
  PXZL         VARCHAR2(4000);
  PXDBL        VARCHAR2(4000);
  count_num    VARCHAR2(4000);
  pxzl_num     VARCHAR2(4000);


  --把一个表的数据取出来
  CURSOR POUXI_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id = '1';

  R POUXI_PEIZHI_CURSOR%ROWTYPE;

  CURSOR POUXI_CS_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id = '1'
       AND A.ID=PXSL_CSID;

  R1 POUXI_CS_PEIZHI_CURSOR%ROWTYPE;

  cursor cur(tname varchar2) is
    select column_name from user_tab_columns where table_name = tname;

begin
IF PXSL_CSID ='KONG'
THEN
 BEGIN
  open POUXI_PEIZHI_CURSOR;

  loop

    fetch POUXI_PEIZHI_CURSOR
      into r;
    DS_ID        := R.DS_ID;
    TABLE_NAME   := R.TBL_NAME;
    CLM_NAME     := R.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R.ID;
    DB_LINK_NAME := R.CONNECT_USER;

    exit when POUXI_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

    begin
    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,'0','0',SYSDATE,'0');

    ELSIF pxzl_num !='0'
  THEN

      return_cnt := 0;
      for rec in cur(table_name) loop
        sql_str := 'select count(*) from ' || upper(table_name) || '@DB_LINK_' || DB_LINK_NAME || ' where ' || rec.column_name || ' is null';
        execute immediate sql_str
          into cnt_tmp;
        return_cnt := return_cnt + cnt_tmp;

      end loop;
        NUM   :=  'SELECT COUNT(*)  FROM ' || upper(table_name) || '@DB_LINK_' || DB_LINK_NAME || '';
        execute immediate NUM INTO COL_NUM;
        PX_COLS  := 'SELECT COUNT(1) FROM user_col_comments@DB_LINK_' || DB_LINK_NAME || '
                     where table_name ='''|| table_name ||'''';
        execute immediate PX_COLS INTO COLS;
        PXZL   := COLS*COL_NUM;
        PXDBL  := 100-return_cnt/(COLS*COL_NUM)*100;

      INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
      VALUES (ID,PXSL_ID,return_cnt,PXZL,SYSDATE,PXDBL);

      COMMIT;
   END IF;
        EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '1',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
        COMMIT;
        RAISE;-----重新抛出异常
    END;

    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_PEIZHI_CURSOR;
  COMMIT;
 END;

ELSIF PXSL_CSID IS NOT NULL
THEN
 BEGIN
  open POUXI_CS_PEIZHI_CURSOR;

  loop

    fetch POUXI_CS_PEIZHI_CURSOR
      into r1;
    DS_ID        := R1.DS_ID;
    TABLE_NAME   := R1.TBL_NAME;
    CLM_NAME     := R1.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R1.ID;
    DB_LINK_NAME := R1.CONNECT_USER;

    exit when POUXI_CS_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

    begin
    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,'0','0',SYSDATE,'0');

    ELSIF pxzl_num !='0'
  THEN

      return_cnt := 0;
      for rec in cur(table_name) loop
        sql_str := 'select count(*) from ' || upper(table_name) || '@DB_LINK_' || DB_LINK_NAME || ' where ' || rec.column_name || ' is null';
        execute immediate sql_str
          into cnt_tmp;
        return_cnt := return_cnt + cnt_tmp;

      end loop;
        NUM   :=  'SELECT COUNT(*)  FROM ' || upper(table_name) || '@DB_LINK_' || DB_LINK_NAME || '';
        execute immediate NUM INTO COL_NUM;
        PX_COLS  := 'SELECT COUNT(1) FROM user_col_comments@DB_LINK_' || DB_LINK_NAME || '
                     where table_name ='''|| table_name ||'''';
        execute immediate PX_COLS INTO COLS;
        PXZL   := COLS*COL_NUM;
        PXDBL  := 100-return_cnt/(COLS*COL_NUM)*100;

      INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
      VALUES (ID,PXSL_ID,return_cnt,PXZL,SYSDATE,PXDBL);

      COMMIT;
   END IF;
        EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '1',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
        COMMIT;
        RAISE;-----重新抛出异常
    END;

    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_CS_PEIZHI_CURSOR;
  COMMIT;
 END;

END IF;

END;
/


CREATE OR REPLACE PROCEDURE PRC_PXSL_ZDBZ(DSID VARCHAR2,DSVERSION VARCHAR2) AS
-----字段备注校验


----变量申明
TBLID           VARCHAR2(100);
TBLCOMMENTS     VARCHAR2(1000);
TBLNAME         VARCHAR2(1000);
TBL_UPDATE      VARCHAR2(1000);
COL_COMMENTS_Y  NUMBER;
COL_COMMENTS_N  NUMBER;

-----TBL表游标
CURSOR ZDBZ_TBL IS
  SELECT A.TBL_ID,A.TBL_DETAIL,A.TBL_NAME,
         (CASE WHEN A.TBL_DETAIL IS NULL THEN 0 ELSE 1 END) TBL_COMMENTS
  FROM T_META_TABLE_ZS A,T_META_DATASOURCE B
  WHERE A.DS_ID=B.DS_ID
  AND A.DS_VERSION=B.VERSION
  AND B.DS_ID=DSID
  AND A.DS_VERSION=DSVERSION;
TBL ZDBZ_TBL%ROWTYPE;

-----COL字段游标
CURSOR ZDBZ_COL(TBLID NUMBER) IS
  SELECT (T.NUM-T.NULL_NUM) TRUE_NUM,T.NULL_NUM
  FROM(SELECT COUNT(CASE WHEN
                         REMARK IS NULL
                         THEN 0
                         END) NULL_NUM,COUNT(*) NUM
       FROM T_META_COLUMN_ZS
       WHERE TBL_ID=TBLID) T;
COL ZDBZ_COL%ROWTYPE;

BEGIN
-----打开TBL表游标
OPEN ZDBZ_TBL;
  LOOP
    fetch ZDBZ_TBL into TBL;
       TBLID       :=TBL.TBL_ID;
       TBLCOMMENTS :=TBL.TBL_COMMENTS;
       TBLNAME     :=TBL.TBL_NAME;
    exit when ZDBZ_TBL%NOTFOUND;

          BEGIN
          -----打开COL字段游标
          FOR COL IN ZDBZ_COL(TBLID)
          LOOP
             COL_COMMENTS_Y :=COL.TRUE_NUM;
             COL_COMMENTS_N :=COL.NULL_NUM;
          END LOOP;
          COMMIT;
          END;
          -----结束游标

-----UPDATE表数据
TBL_UPDATE :='UPDATE T_META_TABLE_ZS
              SET TBL_COMMENTS = '||TBLCOMMENTS||'
                 ,COL_COMMENTS_Y='||COL_COMMENTS_Y||'
                 ,COL_COMMENTS_N='||COL_COMMENTS_N||'
              WHERE TBL_ID = '||TBLID||'';
EXECUTE IMMEDIATE TBL_UPDATE;
COMMIT;

  END LOOP;
CLOSE ZDBZ_TBL;
-----结束游标
END;
/


CREATE OR REPLACE PROCEDURE PRC_PXSL_ZY(PXSL_CSID VARCHAR2) AS
----------剖析实例
----------字段值域剖析规则


ZYLBID         NUMBER;
TBLNAME        VARCHAR2(4000);
COLNAME        VARCHAR2(4000);
DSID           NUMBER;
PXSL_ID        NUMBER;
DB_LINK_NAME   VARCHAR2(4000);
ID             NUMBER;
Y_NUM          VARCHAR2(4000);
COUNT_NUM      VARCHAR2(4000);
PXWTGL         VARCHAR2(4000);
V_PXWTGL       NUMBER;
PXDBL          VARCHAR2(4000);
V_PXDBL        NUMBER;
V_Y_NUM        NUMBER;
V_COUNT_NUM    NUMBER;
ERR0R_NUM      VARCHAR2(4000);
ERROR_MSG      VARCHAR2(4000);
ERR0R_WZ       VARCHAR2(4000);

----创建游标
CURSOR POUXI_PEIZHI_CURSOR IS
  SELECT a.*, b.connect_user
  FROM T_META_PXSL a, t_meta_datasource b
  where a.ds_id = b.ds_id
  and b.stat = '1'
  and a.kpi_id = '6';
R POUXI_PEIZHI_CURSOR%ROWTYPE;

CURSOR POUXI_CS_PEIZHI_CURSOR IS
  SELECT a.*, b.connect_user
  FROM T_META_PXSL a, t_meta_datasource b
  where a.ds_id = b.ds_id
  and b.stat = '1'
  and a.kpi_id = '6'
  AND a.id=PXSL_CSID;
R1 POUXI_PEIZHI_CURSOR%ROWTYPE;

BEGIN
-----IF没有参数传入
IF PXSL_CSID ='KONG' THEN
BEGIN
----打开游标
OPEN POUXI_PEIZHI_CURSOR;
 LOOP
  FETCH POUXI_PEIZHI_CURSOR
  INTO R;
   ZYLBID       :=R.ZYLB_ID;
   TBLNAME      :=R.TBL_NAME;
   COLNAME      :=R.COL_NAME;
   DSID         :=R.DS_ID;
   PXSL_ID      :=R.ID;
   DB_LINK_NAME :=R.CONNECT_USER;
   select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
  EXIT WHEN POUXI_PEIZHI_CURSOR%NOTFOUND;

   ----计算通过数
   BEGIN
   Y_NUM :='select count(*) from '||TBLNAME||'@DB_LINK_'||DB_LINK_NAME||' t,T_GGZY t1
            where to_char(t.'||COLNAME||') in t1.ZYBH
            and t1.ZYLB_ID='||ZYLBID||'';
   EXECUTE IMMEDIATE Y_NUM INTO V_Y_NUM;
   COMMIT;
   ----计算记录总数和未通过数
   COUNT_NUM  :='SELECT COUNT(*) FROM '||TBLNAME||'@DB_LINK_'||DB_LINK_NAME||'';
   EXECUTE IMMEDIATE COUNT_NUM INTO V_COUNT_NUM;
   PXWTGL :='SELECT '''||V_COUNT_NUM||'''-'''||V_Y_NUM||''' FROM DUAL';
   EXECUTE IMMEDIATE PXWTGL INTO V_PXWTGL;
   ----判断表是否为空
   IF V_COUNT_NUM !=0 THEN
     PXDBL  :='SELECT '||V_Y_NUM||'/'||V_COUNT_NUM||'*100 FROM DUAL';
     EXECUTE IMMEDIATE PXDBL INTO V_PXDBL;
   ELSIF V_COUNT_NUM =0 THEN
     V_PXDBL  :=null;
   END IF;
   IF V_PXWTGL =0 AND V_COUNT_NUM=0 THEN
      V_PXWTGL := NULL;
   END IF;
   ----结果插入到表
   INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
   VALUES(ID,PXSL_ID,V_PXWTGL,V_COUNT_NUM,SYSDATE,V_PXDBL);
   COMMIT;

   EXCEPTION
   WHEN OTHERS THEN
   ERR0R_NUM := SQLCODE;
   ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
   ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
   ROLLBACK;
   --插入一条失败记录
   INSERT INTO t_meta_pxsl_cwrz(ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
   VALUES(SEQ_pxsl_cwrz.NEXTVAL,sysdate,PXSL_ID,'6',ERR0R_NUM,ERROR_MSG,ERR0R_WZ);
   DBMS_OUTPUT.PUT_LINE('统计失败!');
   DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' || SQLERRM);
   COMMIT;
   RAISE;-----重新抛出异常
   END;

 ----关闭游标
 END LOOP;
CLOSE POUXI_PEIZHI_CURSOR;
COMMIT;
END;

------IF有参数传入
ELSIF PXSL_CSID IS NOT NULL THEN
BEGIN
----打开游标
OPEN POUXI_CS_PEIZHI_CURSOR;
 LOOP
  FETCH POUXI_CS_PEIZHI_CURSOR
  INTO R1;
   ZYLBID       :=R1.ZYLB_ID;
   TBLNAME      :=R1.TBL_NAME;
   COLNAME      :=R1.COL_NAME;
   DSID         :=R1.DS_ID;
   PXSL_ID      :=R1.ID;
   DB_LINK_NAME :=R1.CONNECT_USER;
   select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
  EXIT WHEN POUXI_CS_PEIZHI_CURSOR%NOTFOUND;

   ----计算通过数
   BEGIN
   Y_NUM :='select count(*) from '||TBLNAME||'@DB_LINK_'||DB_LINK_NAME||' t,T_GGZY t1
            where to_char(t.'||COLNAME||') in t1.ZYBH
            and t1.ZYLB_ID='||ZYLBID||'';
   EXECUTE IMMEDIATE Y_NUM INTO V_Y_NUM;
   COMMIT;
   ----计算记录总数和未通过数
   COUNT_NUM  :='SELECT COUNT(*) FROM '||TBLNAME||'@DB_LINK_'||DB_LINK_NAME||'';
   EXECUTE IMMEDIATE COUNT_NUM INTO V_COUNT_NUM;
   PXWTGL :='SELECT '''||V_COUNT_NUM||'''-'''||V_Y_NUM||''' FROM DUAL';
   EXECUTE IMMEDIATE PXWTGL INTO V_PXWTGL;
   ----判断表是否为空
   IF V_COUNT_NUM !=0 THEN
     PXDBL  :='SELECT '||V_Y_NUM||'/'||V_COUNT_NUM||'*100 FROM DUAL';
     EXECUTE IMMEDIATE PXDBL INTO V_PXDBL;
   ELSIF V_COUNT_NUM =0 THEN
     V_PXDBL  :=NULL;
   END IF;
   IF V_PXWTGL =0 AND V_COUNT_NUM=0 THEN
      V_PXWTGL := NULL;
   END IF;
   ----结果插入到表
   INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
   VALUES(ID,PXSL_ID,V_PXWTGL,V_COUNT_NUM,SYSDATE,V_PXDBL);
   COMMIT;

   EXCEPTION
   WHEN OTHERS THEN
   ERR0R_NUM := SQLCODE;
   ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
   ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
   ROLLBACK;
   --插入一条失败记录
   INSERT INTO t_meta_pxsl_cwrz(ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
   VALUES(SEQ_pxsl_cwrz.NEXTVAL,sysdate,PXSL_ID,'6',ERR0R_NUM,ERROR_MSG,ERR0R_WZ);
   DBMS_OUTPUT.PUT_LINE('统计失败!');
   DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' || SQLERRM);
   COMMIT;
   RAISE;-----重新抛出异常
   END;

 ----关闭游标
 END LOOP;
CLOSE POUXI_CS_PEIZHI_CURSOR;
COMMIT;
END;
END IF;

END;
/


CREATE OR REPLACE PROCEDURE PRC_PXSL_ZZBDS(PXSL_CSID VARCHAR2) AS
  ----------剖析实例
  ----------正则表达式剖析

  DS_ID        INTEGER;
  TABLE_NAME   VARCHAR2(200);
  CLM_NAME     VARCHAR2(200);
  SELECT_SQL   VARCHAR2(4000);
  ID           INTEGER;
  PXSL_ID      INTEGER;
  DB_LINK_NAME VARCHAR2(200);
  ERR0R_NUM    NUMBER;
  ERROR_MSG    VARCHAR2(2000);
  ERR0R_WZ     VARCHAR2(2000);
  count_num    VARCHAR2(2000);
  pxzl_num     VARCHAR2(2000);
  PXCSMIN      VARCHAR2(2000);

  --把一个表的数据取出来
  CURSOR POUXI_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id ='9';

  R POUXI_PEIZHI_CURSOR%ROWTYPE;

  CURSOR POUXI_CS_PEIZHI_CURSOR IS
    SELECT a.*, b.connect_user
      FROM T_META_PXSL a, t_meta_datasource b
     where a.ds_id = b.ds_id
       and b.stat = '1'
       and a.kpi_id ='9'
       and a.id=PXSL_CSID;

  R1 POUXI_CS_PEIZHI_CURSOR%ROWTYPE;
begin
IF PXSL_CSID ='KONG'
THEN
 BEGIN
  open POUXI_PEIZHI_CURSOR;
  loop

    fetch POUXI_PEIZHI_CURSOR
      into r;
    DS_ID        := R.DS_ID;
    TABLE_NAME   := R.TBL_NAME;
    CLM_NAME     := R.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R.ID;
    DB_LINK_NAME := R.CONNECT_USER;
    PXCSMIN     := R.PXCS_MIN;
    exit when POUXI_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

  BEGIN
    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,NULL,'0',SYSDATE,NULL);

    ELSIF pxzl_num !='0'
  THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where REGEXP_LIKE('||CLM_NAME||','''||PXCSMIN||''')) t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
  END IF;
    EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '9',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
       COMMIT;
       RAISE;-----重新抛出异常
    END;
    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_PEIZHI_CURSOR;
  COMMIT;
  END;

ELSIF PXSL_CSID IS NOT NULL
THEN

 BEGIN
  open POUXI_CS_PEIZHI_CURSOR;
  loop

    fetch POUXI_CS_PEIZHI_CURSOR
      into r1;
    DS_ID        := R1.DS_ID;
    TABLE_NAME   := R1.TBL_NAME;
    CLM_NAME     := R1.COL_NAME;
    select SEQ_PXSLJG_ID.NEXTVAL into ID from dual;
    --ID           := SEQ_PXSLJG_ID.NEXTVAL;
    PXSL_ID      := R1.ID;
    DB_LINK_NAME := R1.CONNECT_USER;
    PXCSMIN      := R1.PXCS_MIN;
    exit when POUXI_CS_PEIZHI_CURSOR%NOTFOUND;
    /*开始循环得到的表 子循环*/

  BEGIN
    count_num  :='select count(*) from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '';
    EXECUTE IMMEDIATE count_num into pxzl_num;

  if pxzl_num ='0'
    then

    INSERT INTO T_META_PXSL_ZXJG(ID,PXSL_ID,PXWTGL,PXZL,PXSJ,PXDBL)
    VALUES(ID,PXSL_ID,NULL,'0',SYSDATE,NULL);

    ELSIF pxzl_num !='0'
  THEN
      SELECT_SQL := 'INSERT INTO T_META_PXSL_ZXJG(PXWTGL,PXZL,ID,PXSL_ID,PXSJ,PXDBL)
                    select (t.pxzl-t.pxtgl) pxwtgl,t.pxzl,t.id,t.pxsl_id,t.pxsj,t.pxtgl/t.pxzl*100 pxdbl from
                    (select count(*) pxtgl
                    ,'||pxzl_num||' pxzl,' || ID || ' ID,' || PXSL_ID || ' PXSL_ID,sysdate pxsj
                    from ' || TABLE_NAME || '@DB_LINK_' || DB_LINK_NAME || '
                    where REGEXP_LIKE('||CLM_NAME||','''||PXCSMIN||''')) t';
      EXECUTE IMMEDIATE SELECT_SQL;
      COMMIT;
  END IF;
    EXCEPTION
      WHEN OTHERS THEN
        ERR0R_NUM := SQLCODE;
        ERROR_MSG := SUBSTR(SQLERRM, 1, 500);
        ERR0R_WZ  := SUBSTR(dbms_utility.format_error_backtrace, 1, 500);
        ROLLBACK;
        --插入一条失败记录
        INSERT INTO t_meta_pxsl_cwrz
          (ID, GXSJ, PXSL_ID, KPI_ID, ERROR_NUM, ERROR_MSG, ERROR_LINE)
        VALUES
          (SEQ_pxsl_cwrz.NEXTVAL,
           sysdate,
           PXSL_ID,
           '9',
           ERR0R_NUM,
           ERROR_MSG,
           ERR0R_WZ);

        DBMS_OUTPUT.PUT_LINE('统计失败!');
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
       COMMIT;
       RAISE;-----重新抛出异常
    END;
    /*开始循环得到的表 子循环结束*/
  END LOOP;
  CLOSE POUXI_CS_PEIZHI_CURSOR;
  COMMIT;
  END;

END IF;

END;
/


CREATE OR REPLACE PROCEDURE PRC_QBTJ_NUM AS
-------表记录数统计

TABLE_NAME  VARCHAR2(100);
DBLINK      VARCHAR2(100);
DS_ID       INTEGER;
ID          INTEGER;
V_JLS       VARCHAR2(100);
JLS         NUMBER;

  CURSOR QBTJ_NUM IS
    SELECT A.TBL_NAME,B.DS_ID,B.CONNECT_USER
      FROM T_META_TABLE A, T_META_DATASOURCE B
     WHERE A.DS_ID = B.DS_ID
       AND A.DS_VERSION = B.VERSION
       AND B.STAT='1';
  NUM QBTJ_NUM%ROWTYPE;

BEGIN

  OPEN QBTJ_NUM;
  LOOP

    FETCH QBTJ_NUM
      INTO NUM;
    TABLE_NAME := NUM.TBL_NAME;
    DBLINK     := NUM.CONNECT_USER;
    DS_ID      := NUM.DS_ID;
    select SEQ_QBTJ_NUM.NEXTVAL into ID from dual;
    --ID         := SEQ_QBTJ_NUM.NEXTVAL;
    exit when QBTJ_NUM%NOTFOUND;
   BEGIN
    V_JLS   :='SELECT COUNT(*) FROM '||TABLE_NAME||'@DB_LINK_'||DBLINK||'';
    execute immediate V_JLS INTO JLS;


    INSERT INTO T_META_QBTJ_NUM
    VALUES (ID,DS_ID,TABLE_NAME,JLS,SYSDATE);
    COMMIT;

    EXCEPTION
      WHEN OTHERS THEN
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('sqlcode = ' || SQLCODE || ' sqlerrm = ' ||
                             SQLERRM);
  RAISE;
  END;
  
  END LOOP;
  CLOSE QBTJ_NUM;

  END;
/


CREATE OR REPLACE PROCEDURE PRC_YSJJY_NEW(DS_ID VARCHAR2,CHECK_USER VARCHAR2) AS

------元数据校验

VERSION          VARCHAR2(200);
CHECK_ID         NUMBER;
TABLES_TBL_NAME  VARCHAR2(200);
TABLES_SCHEMA    VARCHAR2(200);
TABLES_TBL_ID    VARCHAR2(200);
LINE             VARCHAR2(200);
V_LINE           VARCHAR2(200);
NEW_DS_VERSION   VARCHAR2(200);
OLD_DS_VERSION   VARCHAR2(200);
DS_VERSION       VARCHAR2(200);
SQL1             VARCHAR2(200);
SQL2             VARCHAR2(200);


CURSOR CHECK_TBL(DSID VARCHAR2,OLD_DS_VERSION VARCHAR2,NEW_DS_VERSION VARCHAR2) IS
SELECT B.TBL_NAME,B.SCHEMA,B.TBL_ID
FROM (SELECT T2.COL_NAME,T1.TBL_NAME,T2.DATA_TYPE,T2.DATA_LENGTH,T2.NULLABLE FROM T_META_TABLE T1,T_META_COLUMN T2,T_META_TABLE TT1
      WHERE T1.TBL_ID=T2.TBL_ID
      AND T1.DS_ID=DSID
      AND T1.DS_VERSION=OLD_DS_VERSION
      AND TT1.DS_VERSION=NEW_DS_VERSION
      AND T1.TBL_NAME=TT1.TBL_NAME) A
FULL OUTER JOIN (SELECT T4.COL_NAME,T3.TBL_NAME,T4.DATA_TYPE,T4.DATA_LENGTH,T4.NULLABLE,T3.SCHEMA,TT2.TBL_ID FROM T_META_TABLE T3,T_META_COLUMN T4,T_META_TABLE TT2
                 WHERE T3.TBL_ID=T4.TBL_ID
                 AND T3.DS_ID=DSID
                 AND T3.DS_VERSION=NEW_DS_VERSION
                 AND TT2.DS_VERSION=OLD_DS_VERSION
                 AND T3.TBL_NAME=TT2.TBL_NAME) B
ON A.COL_NAME=B.COL_NAME
AND A.TBL_NAME=B.TBL_NAME
AND A.DATA_TYPE=B.DATA_TYPE
AND A.DATA_LENGTH=B.DATA_LENGTH
AND A.NULLABLE=B.NULLABLE
WHERE A.COL_NAME IS NULL
OR B.COL_NAME IS NULL
AND A.TBL_NAME =B.TBL_NAME
GROUP BY B.TBL_NAME,B.SCHEMA,B.TBL_ID;
TBL CHECK_TBL%ROWTYPE;





BEGIN
------进行库表同步
BEGIN
PRC_KBTB(DS_ID,VERSION);
DBMS_OUTPUT.put_line(VERSION);
END;
NEW_DS_VERSION  :=VERSION;

------取序列
SELECT SEQ_CHECK_ID.NEXTVAL INTO CHECK_ID FROM DUAL;
DS_VERSION  :='SELECT VERSION FROM T_META_DATASOURCE WHERE DS_ID='||DS_ID||' AND STAT=1';
EXECUTE IMMEDIATE DS_VERSION INTO OLD_DS_VERSION;


------数据源库表校验数据插入
INSERT INTO T_META_DSTBL_CHECK(CHECK_ID,CHECK_DATE,CHECK_USER,DS_ID,DS_VERSION)
VALUES(CHECK_ID,sysdate,CHECK_USER,DS_ID,OLD_DS_VERSION);
COMMIT;

---表插入
INSERT ALL
------目标表缺失
WHEN B_TBL_NAME IS NULL THEN
INTO T_META_CHECK_TABLE(TBL_NAME,SCHEMA,RESULT_TYPE,CHECK_ID,TBL_ID,CHECK_TBL_ID)
VALUES (A_TBL_NAME,A_SCHEMA,A_RESULT_TYPE,A_CHECK_ID,A_TBL_ID,SEQ_CHECK_TBL_ID.NEXTVAL)
------基线表缺失
WHEN A_TBL_NAME IS NULL THEN
INTO T_META_CHECK_TABLE(TBL_NAME,SCHEMA,RESULT_TYPE,CHECK_ID,TBL_ID,CHECK_TBL_ID)
VALUES (B_TBL_NAME,B_SCHEMA,B_RESULT_TYPE,B_CHECK_ID,null,SEQ_CHECK_TBL_ID.NEXTVAL)
------全外连接查询数据
SELECT A.TBL_NAME A_TBL_NAME,A.SCHEMA A_SCHEMA,'1' A_RESULT_TYPE,CHECK_ID A_CHECK_ID,A.TBL_ID A_TBL_ID
      ,B.TBL_NAME B_TBL_NAME,B.SCHEMA B_SCHEMA,'3' B_RESULT_TYPE,CHECK_ID B_CHECK_ID,B.TBL_ID B_TBL_ID
FROM (SELECT * FROM T_META_TABLE WHERE DS_ID=DS_ID AND DS_VERSION=OLD_DS_VERSION) A
FULL OUTER JOIN (SELECT * FROM T_META_TABLE WHERE DS_ID=DS_ID AND DS_VERSION=NEW_DS_VERSION) B
ON A.TBL_NAME=B.TBL_NAME AND A.SCHEMA=B.SCHEMA;
COMMIT;

---字段插入
INSERT INTO T_META_CHECK_COLUMN(ID,COL_NAME,REMARK,DATA_TYPE,DATA_LENGTH,COL_SEQ,NULLABLE,CHECK_TBL_ID,DATA_SCALE)
SELECT SEQ_CHECK_COL_ID.NEXTVAL ID,B.COL_NAME,B.REMARK,B.DATA_TYPE,B.DATA_LENGTH,B.COL_SEQ,B.NULLABLE,C.CHECK_TBL_ID,B.DATA_SCALE
FROM T_META_COLUMN B,T_META_CHECK_TABLE C,T_META_TABLE A
WHERE A.DS_ID=DS_ID
AND A.DS_VERSION=NEW_DS_VERSION
AND C.CHECK_ID=CHECK_ID
AND C.RESULT_TYPE='3'
AND A.TBL_NAME=C.TBL_NAME
AND B.TBL_ID=A.TBL_ID;
COMMIT;



------字段不同
BEGIN
FOR TBL IN CHECK_TBL(DS_ID,OLD_DS_VERSION,NEW_DS_VERSION)
LOOP
TABLES_TBL_NAME   :=TBL.TBL_NAME;
TABLES_SCHEMA     :=TBL.SCHEMA;
TABLES_TBL_ID     :=TBL.TBL_ID;
EXIT WHEN CHECK_TBL%NOTFOUND;

INSERT INTO T_META_CHECK_TABLE(CHECK_TBL_ID,CHECK_ID,TBL_NAME,SCHEMA,RESULT_TYPE,TBL_ID)
VALUES (SEQ_CHECK_TBL_ID.NEXTVAL,CHECK_ID,TABLES_TBL_NAME,TABLES_SCHEMA,'2',TABLES_TBL_ID);
COMMIT;

INSERT INTO T_META_CHECK_COLUMN(ID,COL_NAME,REMARK,DATA_TYPE,DATA_LENGTH,COL_SEQ,NULLABLE,CHECK_TBL_ID,DATA_SCALE)
SELECT SEQ_CHECK_COL_ID.NEXTVAL ID,B.COL_NAME,B.REMARK,B.DATA_TYPE,B.DATA_LENGTH,B.COL_SEQ,B.NULLABLE,C.CHECK_TBL_ID,B.DATA_SCALE
FROM T_META_COLUMN B,T_META_CHECK_TABLE C,T_META_TABLE A
WHERE A.TBL_NAME =TABLES_TBL_NAME
AND A.DS_VERSION=NEW_DS_VERSION
AND C.CHECK_ID=CHECK_ID
AND C.RESULT_TYPE='2'
AND A.TBL_ID=B.TBL_ID
AND A.TBL_NAME=C.TBL_NAME;
COMMIT;
END LOOP;
END;

LINE :='SELECT COUNT(*) FROM T_META_CHECK_TABLE WHERE CHECK_ID='||CHECK_ID||'';
EXECUTE IMMEDIATE LINE INTO V_LINE;

IF V_LINE = '0' THEN
SQL1 :='UPDATE T_META_DSTBL_CHECK A
        SET RESULT_STAT=1
        WHERE A.CHECK_ID='||CHECK_ID||'';
EXECUTE IMMEDIATE SQL1;
commit;
ELSIF V_LINE !='0' THEN
SQL2 :='UPDATE T_META_DSTBL_CHECK A
        SET RESULT_STAT=0
        WHERE A.CHECK_ID='||CHECK_ID||'';
EXECUTE IMMEDIATE SQL2;
COMMIT;
END IF;


END;
/


CREATE OR REPLACE PROCEDURE PRC_ZLPG_JGGX
AS
-------申明变量
-------质量评估结果计算
JBXXID     NUMBER;
JBXX_PGMC  VARCHAR2(2000);
JBXX_FZ    VARCHAR2(2000);
--PXSLID     VARCHAR2(2000);
--PXSLDBL    NUMBER(10,2);
PGFSJG     VARCHAR2(2000);
PGFS_JG    VARCHAR2(2000);
JG_ID      VARCHAR2(2000);
DATATIME   DATE;
--PXSLQZ     VARCHAR2(2000);

-------质量评估基本信息(配置)
CURSOR ZLPG_JBXX IS
  SELECT ID,PGMC,FZ
    FROM T_META_ZLPG_JBXX
  WHERE ID IN(SELECT ZLPG_ID FROM T_META_ZLPG_PXSL_GL);

R1 ZLPG_JBXX%ROWTYPE;

-------质量评估基本信息(未配置)
CURSOR V_ZLPG_JBXXX IS
  SELECT ID,PGMC,FZ
    FROM T_META_ZLPG_JBXX
  WHERE ID NOT IN(SELECT ZLPG_ID FROM T_META_ZLPG_PXSL_GL);

R2 V_ZLPG_JBXXX%ROWTYPE;

-------剖析实例执行结果表
/*CURSOR PPXSL_ZXJG(JBXXID NUMBER) IS
  SELECT T1.*,t2.qz FROM (select row_number() over(partition by t.pxsl_id  order by t.pxsj desc ) a,t.*
  from t_meta_pxsl_zxjg t) T1,T_META_ZLPG_PXSL_GL t2
WHERE T1.A=1
AND T1.PXSL_ID=t2.PXSL_ID
and t2.ZLPG_ID =JBXXID;

R3 PPXSL_ZXJG%ROWTYPE;*/

BEGIN
DATATIME :=SYSDATE;
------OPEN
OPEN ZLPG_JBXX;
 LOOP
  FETCH ZLPG_JBXX INTO R1;
   JBXXID    :=R1.ID;
   JBXX_PGMC :=R1.PGMC;
   JBXX_FZ   :=R1.FZ;
   SELECT SEQ_ZLPG_JG_ID.NEXTVAL INTO JG_ID FROM DUAL;
   --JG_ID   :=SEQ_ZLPG_JG_ID.NEXTVAL;
  EXIT WHEN ZLPG_JBXX%NOTFOUND;

PGFSJG :='SELECT SUM(T1.PXDBL*t2.qz)/100 FROM (select row_number() over(partition by t.pxsl_id  order by t.pxsj desc ) a,t.*
            from t_meta_pxsl_zxjg t) T1 LEFT JOIN T_META_ZLPG_PXSL_GL t2 ON T1.PXSL_ID=t2.PXSL_ID
          WHERE T1.A=1
          and t2.ZLPG_ID ='||JBXXID||'';
EXECUTE IMMEDIATE PGFSJG INTO PGFS_JG;

IF PGFS_JG IS NULL
THEN PGFS_JG :=0;
ELSIF PGFS_JG IS NOT NULL
THEN PGFS_JG :=PGFS_JG;
END IF;

INSERT INTO T_META_ZLPG_JG(ID,ZLPG_ID,PGMC,PGFS,FZ,PGSJ)
VALUES(JG_ID,JBXXID,JBXX_PGMC,PGFS_JG,JBXX_FZ,DATATIME);
commit;
END LOOP;
CLOSE ZLPG_JBXX;
-------END
-------OPEN
OPEN V_ZLPG_JBXXX;
 LOOP
 FETCH V_ZLPG_JBXXX INTO R2;
  JBXXID    :=R2.ID;
  JBXX_PGMC :=R2.pgmc;
  JBXX_FZ   :=R2.FZ;
  SELECT SEQ_ZLPG_JG_ID.NEXTVAL INTO JG_ID FROM DUAL;
  --JG_ID   :=SEQ_ZLPG_JG_ID.NEXTVAL;
 EXIT WHEN V_ZLPG_JBXXX%NOTFOUND;
INSERT INTO T_META_ZLPG_JG(ID,ZLPG_ID,PGMC,PGFS,FZ,PGSJ)
VALUES(JG_ID,JBXXID,JBXX_PGMC,'0',JBXX_FZ,DATATIME);

commit;
END LOOP;
CLOSE V_ZLPG_JBXXX;

END;
/

